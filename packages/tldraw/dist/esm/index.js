var Ca=Object.create;var en=Object.defineProperty,Pa=Object.defineProperties,va=Object.getOwnPropertyDescriptor,Da=Object.getOwnPropertyDescriptors,Ba=Object.getOwnPropertyNames,Ln=Object.getOwnPropertySymbols,ka=Object.getPrototypeOf,co=Object.prototype.hasOwnProperty,Bs=Object.prototype.propertyIsEnumerable;var ks=(s,e,t)=>e in s?en(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t,m=(s,e)=>{for(var t in e||(e={}))co.call(e,t)&&ks(s,t,e[t]);if(Ln)for(var t of Ln(e))Bs.call(e,t)&&ks(s,t,e[t]);return s},y=(s,e)=>Pa(s,Da(e)),Rs=s=>en(s,"__esModule",{value:!0});var Se=(s,e)=>{var t={};for(var n in s)co.call(s,n)&&e.indexOf(n)<0&&(t[n]=s[n]);if(s!=null&&Ln)for(var n of Ln(s))e.indexOf(n)<0&&Bs.call(s,n)&&(t[n]=s[n]);return t};var Ra=(s,e)=>()=>(e||s((e={exports:{}}).exports,e),e.exports),Ea=(s,e)=>{Rs(s);for(var t in e)en(s,t,{get:e[t],enumerable:!0})},tn=(s,e,t)=>{if(e&&typeof e=="object"||typeof e=="function")for(let n of Ba(e))!co.call(s,n)&&n!=="default"&&en(s,n,{get:()=>e[n],enumerable:!(t=va(e,n))||t.enumerable});return s},Es=s=>tn(Rs(en(s!=null?Ca(ka(s)):{},"default",s&&s.__esModule&&"default"in s?{get:()=>s.default,enumerable:!0}:{value:s,enumerable:!0})),s);var he=(s,e,t)=>new Promise((n,o)=>{var i=a=>{try{d(t.next(a))}catch(l){o(l)}},r=a=>{try{d(t.throw(a))}catch(l){o(l)}},d=a=>a.done?n(a.value):Promise.resolve(a.value).then(i,r);d((t=t.apply(s,e)).next())});var fo=Ra(ei=>{var Hs=Object.defineProperty,Aa=s=>Hs(s,"__esModule",{value:!0}),lt=(s,e)=>()=>s&&(e=s(s=0)),nt=(s,e)=>{Aa(s);for(var t in e)Hs(s,t,{get:e[t],enumerable:!0})},we=(s,e,t)=>new Promise((n,o)=>{var i=a=>{try{d(t.next(a))}catch(l){o(l)}},r=a=>{try{d(t.throw(a))}catch(l){o(l)}},d=a=>a.done?n(a.value):Promise.resolve(a.value).then(i,r);d((t=t.apply(s,e)).next())}),As={};nt(As,{default:()=>Os});var Os,Oa=lt(()=>{Os=(...s)=>we(void 0,[...s],function*(e={}){return new Promise((t,n)=>{let o=document.createElement("input");o.type="file";let i=[...e.mimeTypes?e.mimeTypes:[],e.extensions?e.extensions:[]].join();o.multiple=e.multiple||!1,o.accept=i||"";let r,d=()=>r(n);e.setupLegacyCleanupAndRejection?r=e.setupLegacyCleanupAndRejection(d):(r=a=>{window.removeEventListener("pointermove",d),window.removeEventListener("pointerdown",d),window.removeEventListener("keydown",d),a&&a(new DOMException("The user aborted a request.","AbortError"))},window.addEventListener("pointermove",d),window.addEventListener("pointerdown",d),window.addEventListener("keydown",d)),o.addEventListener("change",()=>{r(),t(o.multiple?Array.from(o.files):o.files[0])}),o.click()})})}),Fs={};nt(Fs,{default:()=>Us});var uo,Us,Fa=lt(()=>{uo=s=>we(void 0,null,function*(){let e=yield s.getFile();return e.handle=s,e}),Us=(...s)=>we(void 0,[...s],function*(e={}){let t=yield window.chooseFileSystemEntries({accepts:[{description:e.description||"",mimeTypes:e.mimeTypes||["*/*"],extensions:e.extensions||[""]}],multiple:e.multiple||!1});return e.multiple?Promise.all(t.map(uo)):uo(t)})}),zs={};nt(zs,{default:()=>Gs});var js,Gs,Ua=lt(()=>{js=s=>we(void 0,null,function*(){let e=yield s.getFile();return e.handle=s,e}),Gs=(...s)=>we(void 0,[...s],function*(e={}){let t={};e.mimeTypes?e.mimeTypes.map(i=>{t[i]=e.extensions||[]}):t["*/*"]=e.extensions||[];let n=yield window.showOpenFilePicker({types:[{description:e.description||"",accept:t}],multiple:e.multiple||!1}),o=yield Promise.all(n.map(js));return e.multiple?o:o[0]})}),$s={};nt($s,{default:()=>Ks});var Ks,za=lt(()=>{Ks=(...s)=>we(void 0,[...s],function*(e={}){return e.recursive=e.recursive||!1,new Promise((t,n)=>{let o=document.createElement("input");o.type="file",o.webkitdirectory=!0;let i,r=()=>i(n);e.setupLegacyCleanupAndRejection?i=e.setupLegacyCleanupAndRejection(r):(i=d=>{window.removeEventListener("pointermove",r),window.removeEventListener("pointerdown",r),window.removeEventListener("keydown",r),d&&d(new DOMException("The user aborted a request.","AbortError"))},window.addEventListener("pointermove",r),window.addEventListener("pointerdown",r),window.addEventListener("keydown",r)),o.addEventListener("change",()=>{i();let d=Array.from(o.files);e.recursive||(d=d.filter(a=>a.webkitRelativePath.split("/").length===2)),t(d)}),o.click()})})}),Vs={};nt(Vs,{default:()=>Ws});var mo,Ws,ja=lt(()=>{mo=(s,e,...t)=>we(void 0,[s,e,...t],function*(n,o,i=n.name){let r=[],d=[];for(let a of n.getEntries()){let l=`${i}/${a.name}`;a.isFile?d.push(yield a.getFile().then(p=>(p.directoryHandle=n,Object.defineProperty(p,"webkitRelativePath",{configurable:!0,enumerable:!0,get:()=>l})))):a.isDirectory&&o&&r.push(yield mo(a,o,l))}return[...(yield Promise.all(r)).flat(),...yield Promise.all(d)]}),Ws=(...s)=>we(void 0,[...s],function*(e={}){e.recursive=e.recursive||!1;let t=yield window.chooseFileSystemEntries({type:"open-directory"});return mo(t,e.recursive)})}),Ns={};nt(Ns,{default:()=>_s});var go,_s,Ga=lt(()=>{go=(s,e,...t)=>we(void 0,[s,e,...t],function*(n,o,i=n.name){let r=[],d=[];for(let a of n.values()){let l=`${i}/${a.name}`;a.kind==="file"?d.push(yield a.getFile().then(p=>(p.directoryHandle=n,Object.defineProperty(p,"webkitRelativePath",{configurable:!0,enumerable:!0,get:()=>l})))):a.kind==="directory"&&o&&r.push(yield go(a,o,l))}return[...(yield Promise.all(r)).flat(),...yield Promise.all(d)]}),_s=(...s)=>we(void 0,[...s],function*(e={}){e.recursive=e.recursive||!1;let t=yield window.showDirectoryPicker();return go(t,e.recursive)})}),Xs={};nt(Xs,{default:()=>Ys});var Ys,$a=lt(()=>{Ys=(s,...e)=>we(void 0,[s,...e],function*(t,n={}){let o=document.createElement("a");o.download=n.fileName||"Untitled",o.href=URL.createObjectURL(t),o.addEventListener("click",()=>{setTimeout(()=>URL.revokeObjectURL(o.href),30*1e3)}),o.click()})}),Zs={};nt(Zs,{default:()=>Js});var Js,Ka=lt(()=>{Js=(s,...e)=>we(void 0,[s,...e],function*(t,n={},o=null){n.fileName=n.fileName||"Untitled",o=o||(yield window.chooseFileSystemEntries({type:"save-file",accepts:[{description:n.description||"",mimeTypes:[t.type],extensions:n.extensions||[""]}]}));let i=yield o.createWritable();return yield i.write(t),yield i.close(),o})}),qs={};nt(qs,{default:()=>Qs});var Qs,Va=lt(()=>{Qs=(s,...e)=>we(void 0,[s,...e],function*(t,n={},o=null,i=!1){n.fileName=n.fileName||"Untitled";let r={};if(n.mimeTypes?(n.mimeTypes.push(t.type),n.mimeTypes.map(l=>{r[l]=n.extensions||[]})):r[t.type]=n.extensions||[],o)try{yield o.getFile()}catch(l){if(o=null,i)throw l}let d=o||(yield window.showSaveFilePicker({suggestedName:n.fileName,types:[{description:n.description||"",accept:r}]})),a=yield d.createWritable();return yield a.write(t),yield a.close(),d})});nt(ei,{directoryOpen:()=>Ya,fileOpen:()=>_a,fileSave:()=>Ja,supported:()=>kt});var Wa=(()=>{if("top"in self&&self!==top)try{top.location+""}catch(s){return!1}else{if("chooseFileSystemEntries"in self)return"chooseFileSystemEntries";if("showOpenFilePicker"in self)return"showOpenFilePicker"}return!1})(),kt=Wa,Na=kt?kt==="chooseFileSystemEntries"?Promise.resolve().then(()=>(Fa(),Fs)):Promise.resolve().then(()=>(Ua(),zs)):Promise.resolve().then(()=>(Oa(),As));function _a(...s){return we(this,null,function*(){return(yield Na).default(...s)})}var Xa=kt?kt==="chooseFileSystemEntries"?Promise.resolve().then(()=>(ja(),Vs)):Promise.resolve().then(()=>(Ga(),Ns)):Promise.resolve().then(()=>(za(),$s));function Ya(...s){return we(this,null,function*(){return(yield Xa).default(...s)})}var Za=kt?kt==="chooseFileSystemEntries"?Promise.resolve().then(()=>(Ka(),Zs)):Promise.resolve().then(()=>(Va(),qs)):Promise.resolve().then(()=>($a(),Xs));function Ja(...s){return we(this,null,function*(){return(yield Za).default(...s)})}});import{Fragment as xu,createElement as Ge,memo as wa,useCallback as wu,useEffect as Ht,useMemo as xa,useRef as Iu,useState as Ia}from"react";import{IdProvider as mu}from"@radix-ui/react-id";import{Renderer as gu}from"@tldraw/core";import{createStitches as La,defaultThemeMap as Ma}from"@stitches/react";var{styled:D,createTheme:Ha}=La({themeMap:m({},Ma),theme:{colors:{bounds:"rgba(65, 132, 244, 1.000)",boundsBg:"rgba(65, 132, 244, 0.05)",hover:"#ececec",overlay:"rgba(0, 0, 0, 0.15)",overlayContrast:"rgba(255, 255, 255, 0.15)",panel:"#fefefe",panelContrast:"#ffffff",selected:"rgba(66, 133, 244, 1.000)",selectedContrast:"#fefefe",sponsor:"#ec6cb9",sponsorContrast:"#ec6cb944",text:"#333333",tooltip:"#1d1d1d",tooltipContrast:"#ffffff",warn:"rgba(255, 100, 100, 1)"},shadows:{2:"0px 1px 1px rgba(0, 0, 0, 0.14)",3:"0px 2px 3px rgba(0, 0, 0, 0.14)",4:"0px 4px 5px -1px rgba(0, 0, 0, 0.14)",8:"0px 12px 17px rgba(0, 0, 0, 0.14)",12:"0px 12px 17px rgba(0, 0, 0, 0.14)",24:"0px 24px 38px rgba(0, 0, 0, 0.14)",key:"1px 1px rgba(0,0,0,1)",panel:`0px 0px 16px -1px rgba(0, 0, 0, 0.05), 
        0px 0px 16px -8px rgba(0, 0, 0, 0.05), 
        0px 0px 16px -12px rgba(0, 0, 0, 0.12),
        0px 0px 2px 0px rgba(0, 0, 0, 0.08)`},space:{0:"2px",1:"3px",2:"4px",3:"8px",4:"12px",5:"16px"},fontSizes:{0:"10px",1:"12px",2:"13px",3:"16px",4:"18px"},fonts:{ui:'"Recursive", system-ui, sans-serif',body:'"Recursive", system-ui, sans-serif',mono:'"Recursive Mono", monospace'},fontWeights:{},lineHeights:{},letterSpacings:{},sizes:{},borderWidths:{0:"$1"},borderStyles:{},radii:{0:"2px",1:"4px",2:"8px",3:"12px",4:"16px"},zIndices:{},transitions:{}},media:{micro:"(max-width: 370px)",sm:"(min-width: 640px)",md:"(min-width: 768px)",lg:"(min-width: 1024px)"},utils:{zStrokeWidth:()=>s=>Array.isArray(s)?{strokeWidth:`calc(${s[0]}px / var(--camera-zoom))`}:{strokeWidth:`calc(${s}px / var(--camera-zoom))`}}}),po=Ha({colors:{bounds:"rgba(38, 150, 255, 1.000)",boundsBg:"rgba(38, 150, 255, 0.05)",hover:"#444A50",overlay:"rgba(0, 0, 0, 0.15)",overlayContrast:"rgba(255, 255, 255, 0.15)",panel:"#363D44",panelContrast:"#49555f",selected:"rgba(38, 150, 255, 1.000)",selectedContrast:"#fefefe",text:"#f8f9fa",tooltip:"#1d1d1d",tooltipContrast:"#ffffff"},shadows:{2:"0px 1px 1px rgba(0, 0, 0, 0.24)",3:"0px 2px 3px rgba(0, 0, 0, 0.24)",4:"0px 4px 5px -1px rgba(0, 0, 0, 0.24)",8:"0px 12px 17px rgba(0, 0, 0, 0.24)",12:"0px 12px 17px rgba(0, 0, 0, 0.24)",24:"0px 24px 38px rgba(0, 0, 0, 0.24)",panel:`0px 0px 16px -1px rgba(0, 0, 0, 0.05), 
      0px 0px 16px -8px rgba(0, 0, 0, 0.09), 
      0px 0px 16px -12px rgba(0, 0, 0, 0.2)`}});var ho=class{},Ls;(function(o){o.Idle="idle",o.Connecting="connecting",o.Connected="connected",o.Disconnected="disconnected"})(Ls||(Ls={}));var H;(function(p){p.Transform="transform",p.Translate="translate",p.TransformSingle="transformSingle",p.Brush="brush",p.Arrow="arrow",p.Draw="draw",p.Erase="erase",p.Rotate="rotate",p.Handle="handle",p.Grid="grid"})(H||(H={}));var _;(function(h){h.Idle="idle",h.PointingHandle="pointingHandle",h.PointingBounds="pointingBounds",h.PointingBoundsHandle="pointingBoundsHandle",h.TranslatingHandle="translatingHandle",h.Translating="translating",h.Transforming="transforming",h.Rotating="rotating",h.Pinching="pinching",h.Brushing="brushing",h.Creating="creating",h.EditingText="editing-text"})(_||(_={}));var $e;(function(o){o.Backward="backward",o.Forward="forward",o.ToFront="toFront",o.ToBack="toBack"})($e||($e={}));var ne;(function(r){r.Top="top",r.CenterVertical="centerVertical",r.Bottom="bottom",r.Left="left",r.CenterHorizontal="centerHorizontal",r.Right="right"})(ne||(ne={}));var Ve;(function(t){t.Horizontal="horizontal",t.Vertical="vertical"})(Ve||(Ve={}));var We;(function(t){t.Horizontal="horizontal",t.Vertical="vertical"})(We||(We={}));var bt;(function(t){t.Horizontal="horizontal",t.Vertical="vertical"})(bt||(bt={}));var x;(function(l){l.Sticky="sticky",l.Ellipse="ellipse",l.Rectangle="rectangle",l.Draw="draw",l.Arrow="arrow",l.Line="line",l.Text="text",l.Group="group",l.Image="image"})(x||(x={}));var tt;(function(e){e.Arrow="arrow"})(tt||(tt={}));var X;(function(h){h.White="white",h.LightGray="lightGray",h.Gray="gray",h.Black="black",h.Green="green",h.Cyan="cyan",h.Blue="blue",h.Indigo="indigo",h.Violet="violet",h.Red="red",h.Orange="orange",h.Yellow="yellow"})(X||(X={}));var me;(function(n){n.Small="small",n.Medium="medium",n.Large="large"})(me||(me={}));var J;(function(o){o.Draw="draw",o.Solid="solid",o.Dashed="dashed",o.Dotted="dotted"})(J||(J={}));var Ms;(function(o){o.Small="small",o.Medium="medium",o.Large="large",o.ExtraLarge="extraLarge"})(Ms||(Ms={}));var N;(function(o){o.Start="start",o.Middle="middle",o.End="end",o.Justify="justify"})(N||(N={}));var ie;(function(o){o.Script="script",o.Sans="sans",o.Serif="erif",o.Mono="mono"})(ie||(ie={}));import{Vec as G}from"@tldraw/vec";import{Utils as ce}from"@tldraw/core";var At={};Ea(At,{loadFileHandle:()=>So,migrate:()=>dt,openFromFileSystem:()=>yo,saveFileHandle:()=>To,saveToFileSystem:()=>Hn});function dt(s,e){let{version:t=0}=s;return t===e||(t<14&&Object.values(s.pages).forEach(n=>{Object.values(n.shapes).filter(o=>o.type===x.Text).forEach(o=>o.style.font===ie.Script)}),t<=13&&Object.values(s.pages).forEach(n=>{Object.values(n.bindings).forEach(o=>{Object.assign(o,o.meta)}),Object.values(n.shapes).forEach(o=>{Object.entries(o.style).forEach(([i,r])=>{typeof r=="string"&&(o.style[i]=r.toLowerCase())}),o.type===x.Arrow&&o.decorations&&Object.entries(o.decorations).forEach(([i,r])=>{r==="Arrow"&&(o.decorations=y(m({},o.decorations),{[i]:tt.Arrow}))})})}),t<=13.1&&(s.name="New Document"),Object.values(s.pageStates).forEach(n=>{n.selectedIds=n.selectedIds.filter(o=>s.pages[n.id].shapes[o]!==void 0),n.bindingId=void 0,n.editingId=void 0,n.hoveredId=void 0,n.pointedId=void 0}),s.version=e),s}var Mn=Es(fo());import{get as qa,set as Qa}from"idb-keyval";var ti={mode:"readwrite"},ed=s=>he(void 0,null,function*(){return(yield s.queryPermission(ti))==="granted"||(yield s.requestPermission(ti))==="granted"});function So(){return he(this,null,function*(){let s=yield qa(`Tldraw_file_handle_${window.location.origin}`);return s||null})}function To(s){return he(this,null,function*(){return Qa(`Tldraw_file_handle_${window.location.origin}`,s)})}function Hn(s,e){return he(this,null,function*(){let t={name:s.name||"New Document",fileHandle:e!=null?e:null,document:s,assets:{}},n=JSON.stringify(t,null,2),o=new Blob([n],{type:"application/vnd.Tldraw+json"});if(e&&!(yield ed(e)))return null;let i=yield(0,Mn.fileSave)(o,{fileName:`${t.name}.tldr`,description:"Tldraw File",extensions:[".tldr"]},e);return yield To(i),i})}function yo(){return he(this,null,function*(){var o;let s=yield(0,Mn.fileOpen)({description:"Tldraw File",extensions:[".tldr"],multiple:!1});if(!s)return null;let e=yield new Promise(i=>{let r=new FileReader;r.onloadend=()=>{r.readyState===FileReader.DONE&&i(r.result)},r.readAsText(s,"utf8")}),t=JSON.parse(e),n=(o=s.handle)!=null?o:null;return yield To(n),{fileHandle:n,document:t.document}})}tn(At,Es(fo()));import{Utils as ot}from"@tldraw/core";import{Vec as xt}from"@tldraw/vec";import{createElement as Me}from"react";import{Utils as Kt,SVGContainer as li}from"@tldraw/core";import{Vec as xe}from"@tldraw/vec";import{getStroke as md,getStrokePoints as gd}from"perfect-freehand";var ct=8,ee=24,Fe=32,nn=128,Ot=5;var Ft=10;var ge=.3,It=3,Gu=Math.PI*2,Rt={linear:s=>s,easeInQuad:s=>s*s,easeOutQuad:s=>s*(2-s),easeInOutQuad:s=>s<.5?2*s*s:-1+(4-2*s)*s,easeInCubic:s=>s*s*s,easeOutCubic:s=>--s*s*s+1,easeInOutCubic:s=>s<.5?4*s*s*s:(s-1)*(2*s-2)*(2*s-2)+1,easeInQuart:s=>s*s*s*s,easeOutQuart:s=>1- --s*s*s*s,easeInOutQuart:s=>s<.5?8*s*s*s*s:1-8*--s*s*s*s,easeInQuint:s=>s*s*s*s*s,easeOutQuint:s=>1+--s*s*s*s*s,easeInOutQuint:s=>s<.5?16*s*s*s*s*s:1+16*--s*s*s*s*s,easeInSine:s=>1-Math.cos(s*Math.PI/2),easeOutSine:s=>Math.sin(s*Math.PI/2),easeInOutSine:s=>-(Math.cos(Math.PI*s)-1)/2,easeInExpo:s=>s<=0?0:Math.pow(2,10*s-10),easeOutExpo:s=>s>=1?1:1-Math.pow(2,-10*s),easeInOutExpo:s=>s<=0?0:s>=1?1:s<.5?Math.pow(2,20*s-10)/2:(2-Math.pow(2,-20*s+10))/2};var bo=["#EC5E41","#F2555A","#F04F88","#E34BA9","#BD54C6","#9D5BD2","#7B66DC","#02B1CC","#11B3A3","#39B178","#55B467","#FF802B"];import{Utils as pt,TLShapeUtil as td}from"@tldraw/core";import{intersectLineSegmentBounds as nd,intersectLineSegmentPolyline as od,intersectRayBounds as sd}from"@tldraw/intersect";import{Vec as Ne}from"@tldraw/vec";import{createRef as id}from"react";var Y=class extends td{constructor(){super(...arguments);this.canBind=!1;this.canEdit=!1;this.canClone=!1;this.isAspectRatioLocked=!1;this.hideResizeHandles=!1;this.hitTestPoint=(e,t)=>pt.pointInBounds(t,this.getRotatedBounds(e));this.hitTestLineSegment=(e,t,n)=>{let o=pt.getBoundsFromPoints([t,n]),i=this.getBounds(e);return pt.boundsContain(i,o)||e.rotation?od(t,n,pt.getRotatedCorners(this.getBounds(e))).didIntersect:nd(t,n,this.getBounds(e)).length>0};this.create=e=>(this.refMap.set(e.id,id()),this.getShape(e));this.getCenter=e=>pt.getBoundsCenter(this.getBounds(e));this.getBindingPoint=(e,t,n,o,i,r,d)=>{let a,l,p=this.getBounds(e),c=pt.expandBounds(p,r);if(!!pt.pointInBounds(n,c)){if(d)Ne.dist(n,this.getCenter(e))<12?a=[.5,.5]:a=Ne.divV(Ne.sub(n,[c.minX,c.minY]),[c.width,c.height]),l=0;else{let h=sd(o,i,c).filter(f=>f.didIntersect).map(f=>f.points[0]).sort((f,g)=>Ne.dist(g,o)-Ne.dist(f,o))[0],u=Ne.med(n,h);Ne.distanceToLineSegment(n,u,this.getCenter(e))<12?a=[.5,.5]:a=Ne.divV(Ne.sub(u,[c.minX,c.minY]),[c.width,c.height]),pt.pointInBounds(n,p)?l=16:l=Math.max(16,pt.getBoundsSides(p).map(f=>Ne.distanceToLineSegment(f[1][0],f[1][1],n)).sort((f,g)=>f-g)[0])}return{point:Ne.clampV(a,0,1),distance:l}}};this.mutate=(e,t)=>t;this.transform=(e,t,n)=>y(m({},e),{point:[t.minX,t.minY]});this.transformSingle=(e,t,n)=>this.transform(e,t,n);this.getSvgElement=e=>{var t;return(t=document.getElementById(e.id+"_svg"))==null?void 0:t.cloneNode(!0)}}};import{Utils as ni}from"@tldraw/core";function Ut(s,e){let t=ni.getFromCache(e,s,()=>{let[n,o]=s.size;return{minX:0,maxX:n,minY:0,maxY:o,width:n,height:o}});return ni.translateBounds(t,s.point)}import on from"@tldraw/vec";function oi(s,e,{initialShape:t,transformOrigin:n,scaleX:o,scaleY:i}){if(s.rotation||t.isAspectRatioLocked){let r=on.toFixed(on.mul(t.size,Math.min(Math.abs(o),Math.abs(i)))),d=on.toFixed([e.minX+(e.width-s.size[0])*(o<0?1-n[0]:n[0]),e.minY+(e.height-s.size[1])*(i<0?1-n[1]:n[1])]),a=o<0&&i>=0||i<0&&o>=0?t.rotation?-t.rotation:0:t.rotation;return{size:r,point:d,rotation:a}}else return{point:on.toFixed([e.minX,e.minY]),size:on.toFixed([e.width,e.height])}}import si from"@tldraw/vec";function ii(s,e){return{size:si.toFixed([e.width,e.height]),point:si.toFixed([e.minX,e.minY])}}var ri="  ",Te=class{static insertTextFirefox(e,t){e.setRangeText(t,e.selectionStart||0,e.selectionEnd||0,"end"),e.dispatchEvent(new InputEvent("input",{data:t,inputType:"insertText",isComposing:!1}))}static insert(e,t){let n=e.ownerDocument,o=n.activeElement;o!==e&&e.focus(),n.execCommand("insertText",!1,t)||Te.insertTextFirefox(e,t),o===n.body?e.blur():o instanceof HTMLElement&&o!==e&&o.focus()}static set(e,t){e.select(),Te.insert(e,t)}static getSelection(e){let{selectionStart:t,selectionEnd:n}=e;return e.value.slice(t||void 0,n||void 0)}static wrapSelection(e,t,n){let{selectionStart:o,selectionEnd:i}=e,r=Te.getSelection(e);Te.insert(e,t+r+(n!=null?n:t)),e.selectionStart=(o||0)+t.length,e.selectionEnd=(i||0)+t.length}static replace(e,t,n){let o=0;e.value.replace(t,(...i)=>{let r=o+i[i.length-2],d=i[0].length;e.selectionStart=r,e.selectionEnd=r+d;let a=typeof n=="string"?n:n(...i);return Te.insert(e,a),e.selectionStart=r,o+=a.length-d,a})}static findLineEnd(e,t){let n=e.lastIndexOf(`
`,t-1)+1;return e.charAt(n)!=="	"?t:n+1}static indent(e){var d;let{selectionStart:t,selectionEnd:n,value:o}=e,i=o.slice(t,n),r=(d=/\n/g.exec(i))==null?void 0:d.length;if(r&&r>0){let a=o.lastIndexOf(`
`,t-1)+1,l=e.value.slice(a,n-1),p=l.replace(/^|\n/g,`$&${ri}`),c=p.length-l.length;e.setSelectionRange(a,n-1),Te.insert(e,p),e.setSelectionRange(t+1,n+c)}else Te.insert(e,ri)}static unindent(e){let{selectionStart:t,selectionEnd:n,value:o}=e,i=o.lastIndexOf(`
`,t-1)+1,r=Te.findLineEnd(o,n),d=e.value.slice(i,r),a=d.replace(/(^|\n)(\t| {1,2})/g,"$1"),l=d.length-a.length;e.setSelectionRange(i,r),Te.insert(e,a);let p=/\t| {1,2}/.exec(o.slice(i,t)),c=p?p[0].length:0,h=t-c;e.setSelectionRange(t-c,Math.max(h,n-l))}};import{Utils as zt}from"@tldraw/core";var ai="#fafafa",Io="#343d45",jt={[X.White]:"#f0f1f3",[X.LightGray]:"#c6cbd1",[X.Gray]:"#788492",[X.Black]:"#1d1d1d",[X.Green]:"#36b24d",[X.Cyan]:"#0e98ad",[X.Blue]:"#1c7ed6",[X.Indigo]:"#4263eb",[X.Violet]:"#7746f1",[X.Red]:"#ff2133",[X.Orange]:"#ff9433",[X.Yellow]:"#ffc936"},rd={light:y(m({},Object.fromEntries(Object.entries(jt).map(([s,e])=>[s,zt.lerpColor(e,ai,.45)]))),{[X.White]:"#ffffff",[X.Black]:"#3d3d3d"}),dark:y(m({},Object.fromEntries(Object.entries(jt).map(([s,e])=>[s,zt.lerpColor(zt.lerpColor(e,"#999999",.3),Io,.4)]))),{[X.White]:"#1d1d1d",[X.Black]:"#bbbbbb"})},Gt={light:y(m({},jt),{[X.White]:"#1d1d1d"}),dark:y(m({},Object.fromEntries(Object.entries(jt).map(([s,e])=>[s,zt.lerpColor(e,Io,.1)]))),{[X.White]:"#cecece",[X.Black]:"#cecece"})},An={light:y(m({},Object.fromEntries(Object.entries(jt).map(([s,e])=>[s,zt.lerpColor(e,ai,.82)]))),{[X.White]:"#fefefe",[X.Black]:"#4d4d4d"}),dark:y(m({},Object.fromEntries(Object.entries(jt).map(([s,e])=>[s,zt.lerpColor(e,Io,.618)]))),{[X.White]:"rgb(30,33,37)",[X.Black]:"#1e1e1f"})},ad={[me.Small]:2,[me.Medium]:3.5,[me.Large]:5},dd={[me.Small]:28,[me.Medium]:48,[me.Large]:96,auto:"auto"},ld={[ie.Script]:'"Caveat Brush"',[ie.Sans]:'"Source Sans Pro", sans-serif',[ie.Serif]:'"Source Serif Pro", serif',[ie.Mono]:'"Source Code Pro", monospace'},cd={[ie.Script]:1,[ie.Sans]:1,[ie.Serif]:1,[ie.Mono]:1},pd={[me.Small]:24,[me.Medium]:36,[me.Large]:48,auto:"auto"};function hd(s){return ad[s]}function wo(s,e=ie.Script){return dd[s]*cd[e]}function On(s=ie.Script){return ld[s]}function ud(s){return pd[s]}function xo(s){let e=wo(s.size,s.font),t=On(s.font),{scale:n=1}=s;return`${e*n}px/1.3 ${t}`}function di(s){let e=ud(s.size),t=On(s.font),{scale:n=1}=s;return`${e*n}px/1.3 ${t}`}function Co(s,e=!1){let{color:t}=s,n=e?"dark":"light",o=t===X.White||t===X.Black?X.Yellow:t;return{fill:rd[n][o],stroke:Gt[n][o],color:e?"#1d1d1d":"#0d0d0d"}}function oe(s,e){let{color:t,size:n,isFilled:o}=s,i=hd(n),r=e?"dark":"light";return{stroke:Gt[r][t],fill:o?An[r][t]:"none",strokeWidth:i}}var Be={color:X.Black,size:me.Small,isFilled:!1,dash:J.Draw,scale:1},$t=y(m({},Be),{font:ie.Script,textAlign:N.Start});var Po=class extends Y{constructor(){super(...arguments);this.type=x.Rectangle;this.canBind=!0;this.canClone=!0;this.getShape=e=>Kt.deepMerge({id:"id",type:x.Rectangle,name:"Rectangle",parentId:"page",childIndex:1,point:[0,0],size:[1,1],rotation:0,style:Be},e);this.Component=Y.Component(({shape:e,isBinding:t,isSelected:n,isGhost:o,meta:i,events:r},d)=>{let{id:a,size:l,style:p}=e,c=oe(p,i.isDarkMode),{strokeWidth:h}=c;if(p.dash===J.Draw){let S=Sd(e),w=pi(e);return Me(li,m({ref:d,id:e.id+"_svg"},r),t&&Me("rect",{className:"tl-binding-indicator",x:h/2-ee,y:h/2-ee,width:Math.max(0,l[0]-h/2)+ee*2,height:Math.max(0,l[1]-h/2)+ee*2}),Me("path",{className:n?"tl-fill-hitarea":"tl-stroke-hitarea",d:w}),Me("path",{d:w,fill:p.isFilled?c.fill:"none",pointerEvents:"none"}),Me("path",{d:S,fill:c.stroke,stroke:c.stroke,strokeWidth:c.strokeWidth,pointerEvents:"none",opacity:o?ge:1}))}let u=1+h*1.618,f=Math.max(0,l[0]-u/2),g=Math.max(0,l[1]-u/2),P=[[[u/2,u/2],[f,u/2],f-u/2],[[f,u/2],[f,g],g-u/2],[[f,g],[u/2,g],f-u/2],[[u/2,g],[u/2,u/2],g-u/2]].map(([S,w,v],T)=>{let{strokeDasharray:C,strokeDashoffset:R}=Kt.getPerfectDashProps(v,h*1.618,e.style.dash);return Me("line",{key:a+"_"+T,x1:S[0],y1:S[1],x2:w[0],y2:w[1],strokeDasharray:C,strokeDashoffset:R})});return Me(li,m({ref:d,id:e.id+"_svg"},r),Me("g",{opacity:o?ge:1},t&&Me("rect",{className:"tl-binding-indicator",x:u/2-32,y:u/2-32,width:f+64,height:g+64}),Me("rect",{className:n?"tl-fill-hitarea":"tl-stroke-hitarea",x:u/2,y:u/2,width:f,height:g}),p.isFilled&&Me("rect",{x:u/2,y:u/2,width:f,height:g,fill:c.fill,pointerEvents:"none"}),Me("g",{pointerEvents:"none",stroke:c.stroke,strokeWidth:u,strokeLinecap:"round"},P)))});this.Indicator=Y.Indicator(({shape:e})=>{let{style:t,size:[n,o]}=e,r=oe(t,!1).strokeWidth;return t.dash===J.Draw?Me("path",{d:pi(e)}):Me("rect",{x:r,y:r,rx:1,ry:1,width:Math.max(1,n-r*2),height:Math.max(1,o-r*2)})});this.getBounds=e=>Ut(e,this.boundsCache);this.shouldRender=(e,t)=>t.size!==e.size||t.style!==e.style;this.transform=oi;this.transformSingle=ii}};function fd(s){let e=oe(s.style),t=Kt.rng(s.id),n=e.strokeWidth,o=Math.max(0,s.size[0]),i=Math.max(0,s.size[1]),r=Array.from(Array(4)).map(()=>[t()*n*.75,t()*n*.75]),d=xe.add([n/2,n/2],r[0]),a=xe.add([o-n/2,n/2],r[1]),l=xe.add([o-n/2,i-n/2],r[2]),p=xe.add([n/2,i-n/2],r[3]),c=Math.round(Math.abs(t()*2*4)),h=Math.min(o/2,n*2),u=Math.min(i/2,n*2),f=Math.max(8,Math.floor(o/16)),g=Math.max(8,Math.floor(i/16)),b=Kt.rotateArray([xe.pointsBetween(xe.add(d,[h,0]),xe.sub(a,[h,0]),f),xe.pointsBetween(xe.add(a,[0,u]),xe.sub(l,[0,u]),g),xe.pointsBetween(xe.sub(l,[h,0]),xe.add(p,[h,0]),f),xe.pointsBetween(xe.sub(p,[0,u]),xe.add(d,[0,u]),g)],c);return{points:[...b.flat(),...b[0]].slice(5,Math.floor((c%2==0?f:g)/-2)+3)}}function ci(s){let{points:e}=fd(s),{strokeWidth:t}=oe(s.style);return{points:e,options:{size:t,thinning:.65,streamline:.3,smoothing:1,simulatePressure:!1,last:!0}}}function Sd(s){let{points:e,options:t}=ci(s),n=md(e,t);return Kt.getSvgPathFromStroke(n)}function pi(s){let{points:e,options:t}=ci(s),n=gd(e,t);return Kt.getSvgPathFromStroke(n.map(o=>o.point.slice(0,2)),!1)}import{createElement as Xe}from"react";import{Utils as _e,SVGContainer as mi}from"@tldraw/core";import{Vec as ke}from"@tldraw/vec";import{intersectEllipseBounds as Id,intersectLineSegmentEllipse as Do,intersectRayEllipse as wd}from"@tldraw/intersect";import{Utils as Vt}from"@tldraw/core";import Td from"@tldraw/vec";import{getStrokeOutlinePoints as yd,getStrokePoints as bd}from"perfect-freehand";function hi(s,e){let{id:t,radius:[n,o],point:i,style:r}=s,{strokeWidth:d}=oe(r),a=Vt.rng(t),l=Td.sub(e,i),p=n+a()*d*2,c=o+a()*d*2,h=Vt.perimeterOfEllipse(p,c),u=[],f=Math.PI+Math.PI*a(),g=Math.abs(a()),b=Math.max(16,h/10);for(let P=0;P<b;P++){let S=Rt.easeInOutSine(P/(b+1)),w=f*2+Math.PI*(2+g)*S,v=Math.cos(w),T=Math.sin(w);u.push([p*v+l[0],c*T+l[1],S+.5+a()/2])}return bd(u,{size:1+d*2,thinning:.618,end:{taper:h/8},start:{taper:h/12},streamline:0,simulatePressure:!0})}function ui(s,e){let{id:t,radius:[n,o],style:i}=s,{strokeWidth:r}=oe(i),d=Vt.rng(t),a=n+d()*r*2,l=o+d()*r*2,p=Vt.perimeterOfEllipse(a,l);return Vt.getSvgPathFromStroke(yd(hi(s,e),{size:1+r*2,thinning:.618,end:{taper:p/8},start:{taper:p/12},streamline:0,simulatePressure:!0}))}function vo(s,e){return Vt.getSvgPathFromStroke(hi(s,e).map(t=>t.point.slice(0,2)),!1)}var Bo=class extends Y{constructor(){super(...arguments);this.type=x.Ellipse;this.canBind=!0;this.getShape=e=>_e.deepMerge({id:"id",type:x.Ellipse,name:"Ellipse",parentId:"page",childIndex:1,point:[0,0],radius:[1,1],rotation:0,style:Be},e);this.Component=Y.Component(({shape:e,isGhost:t,isSelected:n,isBinding:o,meta:i,events:r},d)=>{let{radius:[a,l],style:p}=e,c=oe(p,i.isDarkMode),h=c.strokeWidth,u=1+h*1.618,f=Math.max(0,a-u/2),g=Math.max(0,l-u/2);if(p.dash===J.Draw){let v=ui(e,this.getCenter(e));return Xe(mi,m({ref:d,id:e.id+"_svg"},r),o&&Xe("ellipse",{className:"tl-binding-indicator",cx:a,cy:l,rx:f+2,ry:g+2}),Xe("ellipse",{className:n?"tl-fill-hitarea":"tl-stroke-hitarea",cx:a,cy:l,rx:a,ry:l}),Xe("path",{d:vo(e,this.getCenter(e)),stroke:"none",fill:p.isFilled?c.fill:"none",pointerEvents:"none"}),Xe("path",{d:v,fill:c.stroke,stroke:c.stroke,strokeWidth:c.strokeWidth,pointerEvents:"none",strokeLinecap:"round",strokeLinejoin:"round",opacity:t?ge:1}))}let b=Math.pow(f-g,2)/Math.pow(f+g,2),P=Math.PI*(f+g)*(1+3*b/(10+Math.sqrt(4-3*b))),{strokeDasharray:S,strokeDashoffset:w}=_e.getPerfectDashProps(P<64?P*2:P,h*1.618,e.style.dash,4);return Xe(mi,m({ref:d,id:e.id+"_svg"},r),o&&Xe("ellipse",{className:"tl-binding-indicator",cx:a,cy:l,rx:f+32,ry:g+32}),Xe("ellipse",{className:n?"tl-fill-hitarea":"tl-stroke-hitarea",cx:a,cy:l,rx:a,ry:l}),Xe("ellipse",{cx:a,cy:l,rx:a,ry:l,fill:c.fill,stroke:c.stroke,strokeWidth:u,strokeDasharray:S,strokeDashoffset:w,pointerEvents:"none",strokeLinecap:"round",strokeLinejoin:"round"}))});this.Indicator=Y.Indicator(({shape:e})=>{let{radius:[t,n],style:{dash:o}}=e;return o===J.Draw?Xe("path",{d:vo(e,this.getCenter(e))}):Xe("ellipse",{cx:t,cy:n,rx:t,ry:n})});this.hitTestPoint=(e,t)=>_e.pointInBounds(t,this.getRotatedBounds(e))&&_e.pointInEllipse(t,this.getCenter(e),e.radius[0],e.radius[1],e.rotation||0);this.hitTestLineSegment=(e,t,n)=>Do(t,n,this.getCenter(e),e.radius[0],e.radius[1],e.rotation||0).didIntersect;this.getBounds=e=>_e.getFromCache(this.boundsCache,e,()=>_e.getRotatedEllipseBounds(e.point[0],e.point[1],e.radius[0],e.radius[1],0));this.getRotatedBounds=e=>_e.getRotatedEllipseBounds(e.point[0],e.point[1],e.radius[0],e.radius[1],e.rotation);this.hitTestBounds=(e,t)=>{let n=this.getBounds(e);return _e.boundsContained(n,t)||Id(this.getCenter(e),e.radius[0],e.radius[1],e.rotation||0,t).length>0};this.shouldRender=(e,t)=>t.radius!==e.radius||t.style!==e.style;this.getCenter=e=>ke.add(e.point,e.radius);this.getBindingPoint=(e,t,n,o,i,r,d)=>{{let a=this.getBounds(e),l=_e.expandBounds(a,r),p=this.getCenter(e),c,h;if(!_e.pointInEllipse(n,p,e.radius[0]+ee,e.radius[1]+ee))return;if(d)ke.dist(n,this.getCenter(e))<12?c=[.5,.5]:c=ke.divV(ke.sub(n,[l.minX,l.minY]),[l.width,l.height]),h=0;else{let u=wd(o,i,p,e.radius[0],e.radius[1],e.rotation||0).points.sort((g,b)=>ke.dist(g,o)-ke.dist(b,o))[0];if(u||(u=Do(n,p,p,e.radius[0],e.radius[1],e.rotation||0).points.sort((g,b)=>ke.dist(g,n)-ke.dist(b,n))[0]),!u)return;let f=ke.med(n,u);if(ke.distanceToLineSegment(n,f,this.getCenter(e))<12?c=[.5,.5]:c=ke.divV(ke.sub(f,[l.minX,l.minY]),[l.width,l.height]),_e.pointInEllipse(n,p,e.radius[0],e.radius[1],e.rotation||0))h=ee/2;else{let g=Do(n,p,p,e.radius[0],e.radius[1],e.rotation||0).points[0];if(!g)return;h=Math.max(ee/2,ke.dist(n,g))}}return{point:c,distance:h}}};this.transform=(e,t,{scaleX:n,scaleY:o,initialShape:i})=>{let{rotation:r=0}=i;return{point:[t.minX,t.minY],radius:[t.width/2,t.height/2],rotation:n<0&&o>=0||o<0&&n>=0?-(r||0):r||0}};this.transformSingle=(e,t)=>({point:ke.toFixed([t.minX,t.minY]),radius:ke.div([t.width,t.height],2)})}};import{Fragment as Gn,createElement as Ee}from"react";import{Utils as Re,SVGContainer as vd}from"@tldraw/core";import{Vec as L}from"@tldraw/vec";import{intersectArcBounds as Dd,intersectLineSegmentBounds as Bd,intersectLineSegmentLineSegment as kd,intersectRayBounds as xi,intersectRayEllipse as Rd}from"@tldraw/intersect";import{Utils as ht}from"@tldraw/core";import{intersectCircleCircle as xd,intersectCircleLineSegment as Cd}from"@tldraw/intersect";import Z from"@tldraw/vec";import gi from"perfect-freehand";function fi(s,e,t,n){return["M",s.point[0],s.point[1],"A",t[2],t[2],0,0,n<0?0:1,e.point[0],e.point[1]].join(" ")}function Fn(s,e){let{start:t,end:n}=s,o=Z.dist(t.point,n.point),i=Z.med(t.point,n.point),r=o/2*e,d=Z.uni(Z.vec(t.point,n.point));return Z.toFixed(Math.abs(r)<10?i:Z.add(i,Z.mul(Z.per(d),r)))}function Si(s){var c,h;let{style:e,id:t}=s,{start:n,end:o}=s.handles,i=ht.rng(t),r=oe(e).strokeWidth,d=((c=s.decorations)==null?void 0:c.start)?Z.nudge(n.point,o.point,r):n.point,a=((h=s.decorations)==null?void 0:h.end)?Z.nudge(o.point,n.point,r):o.point,l=gi([d,a],{size:r,thinning:.618+i()*.2,easing:Rt.easeOutQuad,simulatePressure:!0,streamline:0,last:!0});return ht.getSvgPathFromStroke(l)}function Ti(s,e,t,n){var v,T;let{style:o,id:i}=s,{start:r,end:d}=s.handles,a=ht.rng(i),l=oe(o).strokeWidth,p=[e[0],e[1]],c=e[2],h=((v=s.decorations)==null?void 0:v.start)?Z.rotWith(r.point,p,l/t):r.point,u=((T=s.decorations)==null?void 0:T.end)?Z.rotWith(d.point,p,-(l/t)):d.point,f=Z.angle(p,h),g=Z.angle(p,u),b=[],P=8+Math.floor(Math.abs(t)/20*1+a()/2);for(let C=0;C<P;C++){let R=n(C/P),B=ht.lerpAngles(f,g,R);b.push(Z.toFixed(Z.nudgeAtAngle(p,B,c)))}let S=gi([h,...b,u],{size:1+l,thinning:.618+a()*.2,easing:Rt.easeOutQuad,simulatePressure:!1,streamline:0,last:!0});return ht.getSvgPathFromStroke(S)}function ko(s){let{start:e,end:t,bend:n}=s.handles;return ht.circleFromThreePoints(e.point,t.point,n.point)}function Un(s){let{start:e,end:t,bend:n}=s.handles,[o,i,r]=ht.circleFromThreePoints(e.point,t.point,n.point),d=[o,i],a=Pd(d,r,e.point,t.point);return{center:d,radius:r,length:a}}function zn(s,e,t,n,o){let i=xd(s,e*.618,t,n).points;if(!i)return I.warn("Could not find an intersection for the arrow head."),{left:s,right:s};let r=o?i[0]:i[1],d=r?Z.nudge(Z.rotWith(r,s,Math.PI/6),s,e*-.382):s,a=r?Z.nudge(Z.rotWith(r,s,-Math.PI/6),s,e*-.382):s;return{left:d,right:a}}function jn(s,e,t){let n=Cd(s,t,s,e).points;if(!n)return I.warn("Could not find an intersection for the arrow head."),{left:s,right:s};let o=n[0],i=o?Z.rotWith(o,s,Math.PI/6):s,r=o?Z.rotWith(o,s,-Math.PI/6):s;return{left:i,right:r}}function yi(s,e,t,n,o){let{left:i,right:r}=zn(s,e,t,n,o);return`M ${i} L ${s} ${r}`}function bi(s,e,t){let{left:n,right:o}=jn(s,e,t);return`M ${n} L ${s} ${o}`}function Ii(s){let{decorations:e,handles:{start:t,end:n,bend:o},style:i}=s,{strokeWidth:r}=oe(i,!1),d=Z.dist(t.point,n.point),a=Math.min(d/3,r*8),l=[];if(Z.dist(o.point,Z.toFixed(Z.med(t.point,n.point)))<1)l.push(`M ${t.point} L ${n.point}`),(e==null?void 0:e.start)&&l.push(bi(t.point,n.point,a)),(e==null?void 0:e.end)&&l.push(bi(n.point,t.point,a));else{let{center:c,radius:h,length:u}=Un(s);l.push(`M ${t.point} A ${h} ${h} 0 0 ${u>0?"1":"0"} ${n.point}`),(e==null?void 0:e.start)&&l.push(yi(t.point,a,c,h,u<0)),(e==null?void 0:e.end)&&l.push(yi(n.point,a,c,h,u>=0))}return l.join(" ")}function sn(s){let{start:e,bend:t,end:n}=s.handles;if(Z.dist2(t.point,Z.med(e.point,n.point))>4){let o=[],{center:i,radius:r}=Un(s),d=Z.angle(i,e.point),a=Z.angle(i,n.point);for(let l=1/20;l<1;l+=1/20){let p=ht.lerpAngles(d,a,l);o.push(Z.nudgeAtAngle(i,p,r))}return o}else return[e.point,n.point]}function wi(s,e,t){if(t===s||t===e)return!0;let n=Math.PI*2,o=(e-s+n)%n,i=(t-s+n)%n;return o<=Math.PI!=i>o}function Pd(s,e,t,n){let o=ht.getSweep(s,t,n);return e*(2*Math.PI)*(o/(2*Math.PI))}var Ro=class extends Y{constructor(){super(...arguments);this.type=x.Arrow;this.hideBounds=!0;this.pathCache=new WeakMap;this.getShape=e=>{var t,n,o,i;return m({id:"id",type:x.Arrow,name:"Arrow",parentId:"page",childIndex:1,point:[0,0],rotation:0,bend:0,handles:{start:m({id:"start",index:0,point:[0,0],canBind:!0},(t=e.handles)==null?void 0:t.start),end:m({id:"end",index:1,point:[1,1],canBind:!0},(n=e.handles)==null?void 0:n.end),bend:m({id:"bend",index:2,point:[.5,.5]},(o=e.handles)==null?void 0:o.bend)},decorations:(i=e.decorations)!=null?i:{end:tt.Arrow},style:m(y(m({},Be),{isFilled:!1}),e.style)},e)};this.Component=Y.Component(({shape:e,isGhost:t,meta:n,events:o},i)=>{let{handles:{start:r,bend:d,end:a},decorations:l={},style:p}=e,c=p.dash===J.Draw,h=L.dist(d.point,L.toFixed(L.med(r.point,a.point)))<1,u=oe(p,n.isDarkMode),{strokeWidth:f}=u,g=L.dist(r.point,a.point),b=Math.min(g/3,f*8),P=1+f*1.618,S,w,v,T=Re.rng(e.id),C=Rt[T()>0?"easeInOutSine":"easeInOutCubic"];if(h){let R=c?Si(e):"M"+L.toFixed(r.point)+"L"+L.toFixed(a.point),{strokeDasharray:B,strokeDashoffset:O}=Re.getPerfectDashProps(g,f*1.618,e.style.dash,2,!1);l.start&&(w=jn(r.point,a.point,b)),l.end&&(v=jn(a.point,r.point,b)),S=g>2?Ee(Gn,null,Ee("path",{className:"tl-stroke-hitarea",d:R}),Ee("path",{d:R,fill:u.stroke,stroke:u.stroke,strokeWidth:c?P/2:P,strokeDasharray:B,strokeDashoffset:O,strokeLinecap:"round",strokeLinejoin:"round",pointerEvents:"stroke"})):null}else{let R=ko(e),{center:B,radius:O,length:j}=Un(e),E=c?Ti(e,R,j,C):fi(r,a,R,e.bend),{strokeDasharray:De,strokeDashoffset:et}=Re.getPerfectDashProps(Math.abs(j),P,e.style.dash,2,!1);l.start&&(w=zn(r.point,b,B,O,j<0)),l.end&&(v=zn(a.point,b,B,O,j>=0)),S=Ee(Gn,null,Ee("path",{className:"tl-stroke-hitarea",d:E}),Ee("path",{d:E,fill:c?u.stroke:"none",stroke:u.stroke,strokeWidth:c?0:P,strokeDasharray:De,strokeDashoffset:et,strokeLinecap:"round",strokeLinejoin:"round",pointerEvents:"none"}))}return Ee(vd,m({ref:i,id:e.id+"_svg"},o),Ee("g",{pointerEvents:"none",opacity:t?ge:1},S,w&&Ee(Gn,null,Ee("path",{className:"tl-stroke-hitarea",d:`M ${w.left} L ${r.point} ${w.right}`}),Ee("path",{d:`M ${w.left} L ${r.point} ${w.right}`,fill:"none",stroke:u.stroke,strokeWidth:P,strokeLinecap:"round",strokeLinejoin:"round",pointerEvents:"none"})),v&&Ee(Gn,null,Ee("path",{className:"tl-stroke-hitarea",d:`M ${v.left} L ${a.point} ${v.right}`}),Ee("path",{d:`M ${v.left} L ${a.point} ${v.right}`,fill:"none",stroke:u.stroke,strokeWidth:P,strokeLinecap:"round",strokeLinejoin:"round",pointerEvents:"none"}))))});this.Indicator=Y.Indicator(({shape:e})=>Ee("path",{d:Ii(e)}));this.getBounds=e=>{let t=Re.getFromCache(this.boundsCache,e,()=>Re.getBoundsFromPoints(sn(e)));return Re.translateBounds(t,e.point)};this.getRotatedBounds=e=>{let t=sn(e),{minX:n,minY:o,maxX:i,maxY:r}=Re.getBoundsFromPoints(t);return e.rotation!==0&&(t=t.map(d=>L.rotWith(d,[(n+i)/2,(o+r)/2],e.rotation||0))),Re.translateBounds(Re.getBoundsFromPoints(t),e.point)};this.getCenter=e=>{let{start:t,end:n}=e.handles;return L.add(e.point,L.med(t.point,n.point))};this.shouldRender=(e,t)=>t.decorations!==e.decorations||t.handles!==e.handles||t.style!==e.style;this.hitTestPoint=(e,t)=>{let n=L.sub(t,e.point),o=sn(e);for(let i=1;i<o.length;i++)if(L.distanceToLineSegment(o[i-1],o[i],n)<1)return!0;return!1};this.hitTestLineSegment=(e,t,n)=>{let o=L.sub(t,e.point),i=L.sub(n,e.point),r=sn(e);for(let d=1;d<r.length;d++)if(kd(r[d-1],r[d],o,i).didIntersect)return!0;return!1};this.hitTestBounds=(e,t)=>{let{start:n,end:o,bend:i}=e.handles,r=L.add(e.point,n.point),d=L.add(e.point,o.point);if(Re.pointInBounds(r,t)||Re.pointInBounds(d,t))return!0;if(L.isEqual(L.med(n.point,o.point),i.point))return Bd(r,d,t).length>0;{let[a,l,p]=ko(e),c=L.add(e.point,[a,l]);return Dd(c,p,r,d,t).length>0}};this.transform=(e,t,{initialShape:n,scaleX:o,scaleY:i})=>{let r=this.getBounds(n),d=["start","end"],a=m({},n.handles);d.forEach(P=>{let[S,w]=a[P].point,v=S/r.width,T=w/r.height;a[P]=y(m({},a[P]),{point:[t.width*(o<0?1-v:v),t.height*(i<0?1-T:T)]})});let{start:l,bend:p,end:c}=a,h=L.dist(l.point,c.point),u=L.med(l.point,c.point),f=h/2*n.bend,g=L.uni(L.vec(l.point,c.point)),b=L.add(u,L.mul(L.per(g),f));return a.bend=y(m({},p),{point:L.toFixed(Math.abs(f)<10?u:b)}),{point:L.toFixed([t.minX,t.minY]),handles:a}};this.onDoubleClickHandle=(e,t)=>{var n,o;switch(t){case"bend":return{bend:0,handles:y(m({},e.handles),{bend:y(m({},e.handles.bend),{point:Fn(e.handles,e.bend)})})};case"start":return{decorations:y(m({},e.decorations),{start:((n=e.decorations)==null?void 0:n.start)?void 0:tt.Arrow})};case"end":return{decorations:y(m({},e.decorations),{end:((o=e.decorations)==null?void 0:o.end)?void 0:tt.Arrow})}}return this};this.onBindingChange=(e,t,n,o,i)=>{let r=e.handles[t.handleId],d=Re.expandBounds(o,ee),a=L.sub(L.add([d.minX,d.minY],L.mulV([d.width,d.height],L.rotWith(t.point,[.5,.5],n.rotation||0))),e.point),l=a;if(t.distance){let p=Re.expandBounds(o,t.distance),c=L.add(e.point,e.handles[r.id==="start"?"end":"start"].point),h=L.uni(L.sub(L.add(a,e.point),c));if(n.type===x.Ellipse){let u=Rd(c,h,i,n.radius[0]+t.distance,n.radius[1]+t.distance,n.rotation||0).points.sort((f,g)=>L.dist(f,c)-L.dist(g,c));u[0]&&(l=L.sub(u[0],e.point))}else{let u=xi(c,h,p,n.rotation).filter(f=>f.didIntersect).map(f=>f.points[0]).sort((f,g)=>L.dist(f,c)-L.dist(g,c));u.length<2&&(u=xi(c,L.neg(h),p).filter(f=>f.didIntersect).map(f=>f.points[0]).sort((f,g)=>L.dist(f,c)-L.dist(g,c))),u[0]&&(l=L.sub(u[0],e.point))}}return this.onHandleChange(e,{[r.id]:y(m({},r),{point:L.toFixed(l)})})};this.onHandleChange=(e,t)=>{let n=Re.deepMerge(e.handles,t),o=e.bend;if(n=y(m({},n),{start:y(m({},n.start),{point:L.toFixed(n.start.point)}),end:y(m({},n.end),{point:L.toFixed(n.end.point)})}),"bend"in t){let{start:l,end:p,bend:c}=n,h=L.dist(l.point,p.point),u=L.med(l.point,p.point),f=L.angle(l.point,p.point),g=L.uni(L.vec(l.point,p.point)),b=L.add(u,L.mul(L.per(g),h/2)),P=L.sub(u,L.mul(L.per(g),h/2)),S=L.nearestPointOnLineSegment(b,P,c.point,!0),w=L.dist(u,S);o=Re.clamp(w/(h/2),-.99,.99);let v=L.angle(l.point,S);L.isEqual(u,Fn(n,o))?o=0:wi(f,f+Math.PI,v)&&(o*=-1)}let i={point:e.point,bend:o,handles:y(m({},n),{bend:y(m({},n.bend),{point:Fn(n,o)})})},r=e.point,d=this.getBounds(m({},i)),a=L.sub([d.minX,d.minY],r);return L.isEqual(a,[0,0])||(Object.values(i.handles).forEach(l=>{l.point=L.toFixed(L.sub(l.point,a))}),i.point=L.toFixed(L.add(i.point,a))),i}}};import{createElement as wt}from"react";import{Utils as Ed,SVGContainer as Ld}from"@tldraw/core";var Eo=class extends Y{constructor(){super(...arguments);this.type=x.Group;this.canBind=!0;this.getShape=e=>Ed.deepMerge({id:"id",type:x.Group,name:"Group",parentId:"page",childIndex:1,point:[0,0],size:[100,100],rotation:0,children:[],style:Be},e);this.Component=Y.Component(({shape:e,isBinding:t,isGhost:n,isHovered:o,isSelected:i,events:r},d)=>{let{id:a,size:l}=e,p=2,c=Math.max(0,l[0]-p/2),h=Math.max(0,l[1]-p/2),f=[[[p/2,p/2],[c,p/2],c-p/2],[[c,p/2],[c,h],h-p/2],[[c,h],[p/2,h],c-p/2],[[p/2,h],[p/2,p/2],h-p/2]].map(([g,b],P)=>wt("line",{key:a+"_"+P,x1:g[0],y1:g[1],x2:b[0],y2:b[1]}));return wt(Ld,m({ref:d},r),t&&wt("rect",{className:"tl-binding-indicator",x:-ee,y:-ee,width:l[0]+ee*2,height:l[1]+ee*2}),wt("g",{opacity:n?ge:1},wt("rect",{x:0,y:0,width:l[0],height:l[1],fill:"transparent",pointerEvents:"all"}),wt(Ci,{stroke:X.Black,opacity:o||i?1:0,strokeLinecap:"round",pointerEvents:"stroke"},f)))});this.Indicator=Y.Indicator(({shape:e})=>{let{id:t,size:n}=e,o=2,i=Math.max(0,n[0]-o/2),r=Math.max(0,n[1]-o/2),a=[[[o/2,o/2],[i,o/2],i-o/2],[[i,o/2],[i,r],r-o/2],[[i,r],[o/2,r],i-o/2],[[o/2,r],[o/2,o/2],r-o/2]].map(([l,p],c)=>wt("line",{key:t+"_"+c,x1:l[0],y1:l[1],x2:p[0],y2:p[1]}));return wt(Ci,{strokeLinecap:"round",pointerEvents:"stroke"},a)});this.getBounds=e=>Ut(e,this.boundsCache);this.shouldRender=(e,t)=>t.size!==e.size||t.style!==e.style}},Ci=D("g",{strokeWidth:"calc(1.5px * var(--tl-scale))",strokeDasharray:"calc(1px * var(--tl-scale)), calc(3px * var(--tl-scale))"});import{createElement as an,useCallback as rn,useEffect as vi,useRef as Vn}from"react";import{Utils as Hd,HTMLContainer as Ad}from"@tldraw/core";import{Vec as Od}from"@tldraw/vec";var Md={[N.Start]:"left",[N.Middle]:"center",[N.End]:"right",[N.Justify]:"justify"};function $n(s=N.Start){return Md[s]}function Kn(s,e){let{text:t,style:n}=s,o=wo(s.style.size,s.style.font),i=document.createElementNS("http://www.w3.org/2000/svg","g"),r=o*1.3,d=t.split(`
`).map((a,l)=>{let p=document.createElementNS("http://www.w3.org/2000/svg","text");return p.textContent=a,p.setAttribute("font-family",On(n.font)),p.setAttribute("font-size",o+"px"),p.setAttribute("text-anchor","start"),p.setAttribute("alignment-baseline","central"),p.setAttribute("text-align",$n(n.textAlign)),p.setAttribute("y",r*(.5+l)+""),i.appendChild(p),p});return n.textAlign===N.Middle?d.forEach(a=>{a.setAttribute("x",e.width/2+""),a.setAttribute("text-align","center"),a.setAttribute("text-anchor","middle")}):n.textAlign===N.End&&d.forEach(a=>{a.setAttribute("x",e.width+""),a.setAttribute("text-align","right"),a.setAttribute("text-anchor","end")}),i}var Wt=s=>s.stopPropagation();var Lo=class extends Y{constructor(){super(...arguments);this.type=x.Sticky;this.canBind=!0;this.canEdit=!0;this.canClone=!0;this.hideResizeHandles=!0;this.showCloneHandles=!0;this.getShape=e=>Hd.deepMerge({id:"id",type:x.Sticky,name:"Sticky",parentId:"page",childIndex:1,point:[0,0],size:[200,200],text:"",rotation:0,style:$t},e);this.Component=Y.Component(({shape:e,meta:t,events:n,isGhost:o,isEditing:i,onShapeBlur:r,onShapeChange:d},a)=>{let l=di(e.style),{color:p,fill:c}=Co(e.style,t.isDarkMode),h=Vn(null),u=Vn(null),f=Vn(null),g=Vn(!1),b=rn(C=>{C.stopPropagation()},[]),P=rn(C=>{d==null||d({id:e.id,type:e.type,text:I.normalizeText(C.currentTarget.value)})},[d]),S=rn(C=>{if(C.key!=="Escape"){if(C.key==="Tab"&&e.text.length===0){C.preventDefault();return}if(!(C.key==="Meta"||C.metaKey))C.stopPropagation();else if(C.key==="z"&&C.metaKey){C.shiftKey?document.execCommand("redo",!1):document.execCommand("undo",!1),C.stopPropagation(),C.preventDefault();return}C.key==="Tab"&&(C.preventDefault(),C.shiftKey?Te.unindent(C.currentTarget):Te.indent(C.currentTarget),d==null||d(y(m({},e),{text:I.normalizeText(C.currentTarget.value)})))}},[e,d]),w=rn(C=>{C.currentTarget.setSelectionRange(0,0),r==null||r()},[]),v=rn(C=>{!i||!g.current||C.currentTarget.select()},[i]);vi(()=>{if(i){g.current=!0;let C=u.current;C.focus(),C.select()}},[i]),vi(()=>{let C=f.current,{size:R}=e,{offsetHeight:B}=C,O=Mo-Et*2,j=R[1]-Et*2;if(B===j)return;if(B>O){d==null||d({id:e.id,size:[R[0],B+Et*2]});return}if(B<O&&R[1]>Mo){d==null||d({id:e.id,size:[R[0],Mo]});return}let E=u.current;E==null||E.focus()},[e.text,e.size[1],e.style]);let T={font:l,color:p,textShadow:t.isDarkMode?"0.5px 0.5px 2px rgba(255, 255, 255,.25)":"0.5px 0.5px 2px rgba(255, 255, 255,.5)"};return an(Ad,m({ref:a},n),an(Fd,{ref:h,isDarkMode:t.isDarkMode,isGhost:o,style:m({backgroundColor:c},T)},an(Ud,{ref:f,isEditing:i,alignment:e.style.textAlign},e.text,"\u200B"),i&&an(zd,{ref:u,onPointerDown:b,value:e.text,onChange:P,onKeyDown:S,onFocus:v,onBlur:w,tabIndex:-1,autoComplete:"false",autoCapitalize:"false",autoCorrect:"false",autoSave:"false",autoFocus:!0,spellCheck:!0,alignment:e.style.textAlign,onContextMenu:Wt})))});this.Indicator=Y.Indicator(({shape:e})=>{let{size:[t,n]}=e;return an("rect",{x:0,y:0,rx:3,ry:3,width:Math.max(1,t),height:Math.max(1,n)})});this.getBounds=e=>Ut(e,this.boundsCache);this.shouldRender=(e,t)=>t.size!==e.size||t.style!==e.style||t.text!==e.text;this.transform=(e,t,{scaleX:n,scaleY:o,transformOrigin:i})=>({point:Od.toFixed([t.minX+(t.width-e.size[0])*(n<0?1-i[0]:i[0]),t.minY+(t.height-e.size[1])*(o<0?1-i[1]:i[1])])});this.transformSingle=e=>e;this.getSvgElement=e=>{let t=this.getBounds(e),n=Kn(e,t),o=Co(e.style);n.setAttribute("fill",o.color);let i=document.createElementNS("http://www.w3.org/2000/svg","g"),r=document.createElementNS("http://www.w3.org/2000/svg","rect");return r.setAttribute("width",t.width+""),r.setAttribute("height",t.height+""),r.setAttribute("fill",o.fill),i.appendChild(r),i.appendChild(n),i}}},Et=16,Mo=200,Fd=D("div",{pointerEvents:"all",position:"relative",backgroundColor:"rgba(255, 220, 100)",fontFamily:"sans-serif",height:"100%",width:"100%",padding:Et+"px",borderRadius:"3px",perspective:"800px",variants:{isGhost:{false:{opacity:1},true:{transition:"opacity .2s",opacity:ge}},isDarkMode:{true:{boxShadow:"2px 3px 12px -2px rgba(0,0,0,.3), 1px 1px 4px rgba(0,0,0,.3), 1px 1px 2px rgba(0,0,0,.3)"},false:{boxShadow:"2px 3px 12px -2px rgba(0,0,0,.2), 1px 1px 4px rgba(0,0,0,.16),  1px 1px 2px rgba(0,0,0,.16)"}}}}),Pi={whiteSpace:"pre-wrap",overflowWrap:"break-word"},Ud=D("div",m({position:"absolute",top:Et,left:Et,width:`calc(100% - ${Et*2}px)`,height:"fit-content",font:"inherit",pointerEvents:"none",userSelect:"none",variants:{isEditing:{true:{opacity:1},false:{opacity:1}},alignment:{[N.Start]:{textAlign:"left"},[N.Middle]:{textAlign:"center"},[N.End]:{textAlign:"right"},[N.Justify]:{textAlign:"justify"}}}},Pi)),zd=D("textarea",y(m({width:"100%",height:"100%",border:"none",overflow:"hidden",background:"none",outline:"none",textAlign:"left",font:"inherit",padding:0,color:"transparent",verticalAlign:"top",resize:"none",caretColor:"black"},Pi),{variants:{alignment:{[N.Start]:{textAlign:"left"},[N.Middle]:{textAlign:"center"},[N.End]:{textAlign:"right"},[N.Justify]:{textAlign:"justify"}}}}));import{createElement as Xt,useCallback as dn,useEffect as Wd,useRef as ki}from"react";import{Utils as Ho,HTMLContainer as jd}from"@tldraw/core";import{Vec as Nt}from"@tldraw/vec";var Ao=class extends Y{constructor(){super(...arguments);this.type=x.Text;this.isAspectRatioLocked=!0;this.canEdit=!0;this.canBind=!0;this.canClone=!0;this.getShape=e=>Ho.deepMerge({id:"id",type:x.Text,name:"Text",parentId:"page",childIndex:1,point:[0,0],rotation:0,text:" ",style:$t},e);this.Component=Y.Component(({shape:e,isBinding:t,isGhost:n,isEditing:o,onShapeBlur:i,onShapeChange:r,meta:d,events:a},l)=>{let p=ki(null),{text:c,style:h}=e,u=oe(h,d.isDarkMode),f=xo(e.style),g=ki(!1),b=dn(T=>{let C=[0,0],R=this.getBounds(e);switch(e.style.textAlign){case N.Start:break;case N.Middle:{let B=this.getBounds(y(m({},e),{text:I.normalizeText(T.currentTarget.value)}));C=Nt.div([B.width-R.width,0],2);break}case N.End:{C=[this.getBounds(y(m({},e),{text:I.normalizeText(T.currentTarget.value)})).width-R.width,0];break}}r==null||r(y(m({},e),{point:Nt.sub(e.point,C),text:I.normalizeText(T.currentTarget.value)}))},[e]),P=dn(T=>{if(!(T.key==="Meta"||T.metaKey))T.stopPropagation();else if(T.key==="z"&&T.metaKey){T.shiftKey?document.execCommand("redo",!1):document.execCommand("undo",!1),T.stopPropagation(),T.preventDefault();return}if(T.key==="Escape"||T.key==="Enter"&&(T.ctrlKey||T.metaKey)){T.currentTarget.blur();return}T.key==="Tab"&&(T.preventDefault(),T.shiftKey?Te.unindent(T.currentTarget):Te.indent(T.currentTarget),r==null||r(y(m({},e),{text:I.normalizeText(T.currentTarget.value)})))},[e,r]),S=dn(T=>{T.currentTarget.setSelectionRange(0,0),i==null||i()},[]),w=dn(T=>{!o||!g.current||document.activeElement===T.currentTarget&&T.currentTarget.select()},[o]),v=dn(T=>{o&&T.stopPropagation()},[o]);return Wd(()=>{o?requestAnimationFrame(()=>{g.current=!0;let T=p.current;T&&(T.focus(),T.select())}):i==null||i()},[o]),Xt(jd,m({ref:l},a),Xt($d,{isGhost:n,isEditing:o,onPointerDown:v},Xt(Kd,{style:{font:f,color:u.stroke,textAlign:$n(h.textAlign)}},t&&Xt("div",{className:"tl-binding-indicator",style:{position:"absolute",top:-ee,left:-ee,width:`calc(100% + ${ee*2}px)`,height:`calc(100% + ${ee*2}px)`,backgroundColor:"var(--tl-selectFill)"}}),o?Xt(Vd,{ref:p,style:{font:f,color:u.stroke,textAlign:"inherit"},name:"text",defaultValue:c,tabIndex:-1,autoComplete:"false",autoCapitalize:"false",autoCorrect:"false",autoSave:"false",autoFocus:!0,placeholder:"",color:u.stroke,onFocus:w,onChange:b,onKeyDown:P,onBlur:S,onPointerDown:v,spellCheck:"true",wrap:"off",dir:"auto",datatype:"wysiwyg",onContextMenu:Wt}):c,"\u200B")))});this.Indicator=Y.Indicator(({shape:e})=>{let{width:t,height:n}=this.getBounds(e);return Xt("rect",{x:0,y:0,width:t,height:n})});this.getBounds=e=>{let t=Ho.getFromCache(this.boundsCache,e,()=>{if(!_t)return{minX:0,minY:0,maxX:10,maxY:10,width:10,height:10};_t.innerHTML=`${e.text}&zwj;`,_t.style.font=xo(e.style);let n=_t.offsetWidth||1,o=_t.offsetHeight||1;return{minX:0,maxX:n,minY:0,maxY:o,width:n,height:o}});return Ho.translateBounds(t,e.point)};this.shouldRender=(e,t)=>t.text!==e.text||t.style.scale!==e.style.scale||t.style!==e.style;this.transform=(e,t,{initialShape:n,scaleX:o,scaleY:i})=>{let{rotation:r=0,style:{scale:d=1}}=n,a=d*Math.abs(Math.min(o,i));return{point:[t.minX,t.minY],rotation:o<0&&i>=0||i<0&&o>=0?-(r||0):r,style:y(m({},n.style),{scale:a})}};this.transformSingle=(e,t,{initialShape:n,scaleX:o,scaleY:i})=>{let{style:{scale:r=1}}=n;return{point:Nt.toFixed([t.minX,t.minY]),style:y(m({},n.style),{scale:r*Math.max(Math.abs(i),Math.abs(o))})}};this.onDoubleClickBoundsHandle=e=>{let t=this.getCenter(e),n=this.getCenter(y(m({},e),{style:y(m({},e.style),{scale:1})}));return{style:y(m({},e.style),{scale:1}),point:Nt.toFixed(Nt.add(e.point,Nt.sub(t,n)))}};this.getSvgElement=e=>{let t=this.getBounds(e),n=Kn(e,t);return n.setAttribute("fill",oe(e.style).stroke),n}}},Di=-1.5,_t;function Gd(){var e;(e=document.getElementById("__textMeasure"))==null||e.remove();let s=document.createElement("pre");return s.id="__textMeasure",Object.assign(s.style,{whiteSpace:"pre",width:"auto",border:"1px solid transparent",padding:"4px",margin:"0px",letterSpacing:`${Di}px`,opacity:"0",position:"absolute",top:"-500px",left:"0px",zIndex:"9999",pointerEvents:"none",userSelect:"none",alignmentBaseline:"mathematical",dominantBaseline:"mathematical"}),s.tabIndex=-1,document.body.appendChild(s),s}typeof window!="undefined"&&(_t=Gd());var $d=D("div",{width:"100%",height:"100%",variants:{isGhost:{false:{opacity:1},true:{transition:"opacity .2s",opacity:ge}},isEditing:{false:{pointerEvents:"all",userSelect:"all"},true:{pointerEvents:"none",userSelect:"none"}}}}),Bi={whiteSpace:"pre-wrap",overflowWrap:"break-word"},Kd=D("div",m({position:"absolute",top:"var(--tl-padding)",left:"var(--tl-padding)",width:"calc(100% - (var(--tl-padding) * 2))",height:"calc(100% - (var(--tl-padding) * 2))",padding:"4px",zIndex:1,minHeight:1,minWidth:1,lineHeight:1.4,letterSpacing:Di,outline:0,fontWeight:"500",backfaceVisibility:"hidden",userSelect:"none",pointerEvents:"none",WebkitUserSelect:"none",WebkitTouchCallout:"none",isEditing:{false:{},true:{pointerEvents:"all",background:"$boundsBg",userSelect:"text",WebkitUserSelect:"text"}}},Bi)),Vd=D("textarea",m({position:"absolute",top:0,left:0,zIndex:1,width:"100%",height:"100%",border:"none",padding:"4px",resize:"none",minHeight:"inherit",minWidth:"inherit",lineHeight:"inherit",letterSpacing:"inherit",outline:0,fontWeight:"inherit",overflow:"hidden",backfaceVisibility:"hidden",display:"inline-block",pointerEvents:"all",background:"$boundsBg",userSelect:"text",WebkitUserSelect:"text"},Bi));import{createElement as He,useMemo as Go}from"react";import{Utils as Ce,SVGContainer as zo}from"@tldraw/core";import{Vec as ut}from"@tldraw/vec";import{intersectBoundsBounds as Yd,intersectBoundsPolyline as Hi,intersectLineSegmentBounds as Zd,intersectLineSegmentLineSegment as Jd}from"@tldraw/intersect";import{Utils as Oo}from"@tldraw/core";import{getStrokeOutlinePoints as Nd,getStrokePoints as Ri}from"perfect-freehand";var _d={easing:s=>Math.sin(s*Math.PI/2),simulatePressure:!0},Xd={easing:s=>s*s,simulatePressure:!1};function Fo(s){let e=oe(s.style);return y(m({size:1+e.strokeWidth*1.5,thinning:.65,streamline:.65,smoothing:.65},s.points[1][2]===.5?_d:Xd),{last:s.isComplete})}function Ei(s){return s.points.length<2?"":Oo.getSvgPathFromStroke(Ri(s.points,Fo(s)).map(e=>e.point))}function Li(s,e){return Ri(s.points,e)}function Mi(s){if(s.points.length<2)return"";let e=Fo(s),t=Li(s,e),n=Nd(t,e);return Oo.getSvgPathFromStroke(n)}function Uo(s){let{points:e}=s;if(e.length<2)return"M 0 0 L 0 0";let t=Fo(s),n=Li(s,t).map(i=>i.point.slice(0,2));return Oo.getSvgPathFromStroke(n,!1)}var jo=class extends Y{constructor(){super(...arguments);this.type=x.Draw;this.pointsBoundsCache=new WeakMap([]);this.shapeBoundsCache=new Map;this.rotatedCache=new WeakMap([]);this.pointCache={};this.canClone=!0;this.getShape=e=>Ce.deepMerge({id:"id",type:x.Draw,name:"Draw",parentId:"page",childIndex:1,point:[0,0],rotation:0,style:Be,points:[],isComplete:!1},e);this.Component=Y.Component(({shape:e,meta:t,isSelected:n,isGhost:o,events:i},r)=>{let{points:d,style:a,isComplete:l}=e,p=Go(()=>Ei(e),[d,a.size]),c=Go(()=>a.dash===J.Draw?Mi(e):Uo(e),[d,a.size,a.dash,l]),h=oe(a,t.isDarkMode),{stroke:u,fill:f,strokeWidth:g}=h,b=this.getBounds(e);if(b.width<=g/2&&b.height<=g/2){let C=1+g;return He(zo,m({ref:r,id:e.id+"_svg"},i),He("circle",{r:C,fill:u,stroke:u,pointerEvents:"all",opacity:o?ge:1}))}let S=a.isFilled&&d.length>3&&ut.dist(d[0],d[d.length-1])<g*2;if(e.style.dash===J.Draw)return He(zo,m({ref:r,id:e.id+"_svg"},i),He("g",{opacity:o?ge:1},He("path",{className:S&&n?"tl-fill-hitarea":"tl-stroke-hitarea",d:c}),S&&He("path",{d:p,stroke:"none",fill:f,strokeLinejoin:"round",strokeLinecap:"round",pointerEvents:"none"}),He("path",{d:c,fill:u,stroke:u,strokeWidth:g/2,strokeLinejoin:"round",strokeLinecap:"round",pointerEvents:"none"})));let w={[J.Draw]:"none",[J.Solid]:"none",[J.Dotted]:`0.1 ${g*4}`,[J.Dashed]:`${g*4} ${g*4}`}[a.dash],v={[J.Draw]:"none",[J.Solid]:"none",[J.Dotted]:"0",[J.Dashed]:"0"}[a.dash],T=1+g*1.5;return He(zo,m({ref:r,id:e.id+"_svg"},i),He("g",{opacity:o?ge:1},He("path",{className:S&&n?"tl-fill-hitarea":"tl-stroke-hitarea",d:c}),He("path",{d:c,fill:S?f:"none",stroke:"none",strokeWidth:Math.min(4,g*2),strokeLinejoin:"round",strokeLinecap:"round",pointerEvents:"none"}),He("path",{d:c,fill:"none",stroke:u,strokeWidth:T,strokeDasharray:w,strokeDashoffset:v,strokeLinejoin:"round",strokeLinecap:"round",pointerEvents:"none"})))});this.Indicator=Y.Indicator(({shape:e})=>{let{points:t}=e,n=Go(()=>Uo(e),[t]),o=this.getBounds(e);return o.width<4&&o.height<4?He("circle",{x:o.width/2,y:o.height/2,r:1}):He("path",{d:n})});this.transform=(e,t,{initialShape:n,scaleX:o,scaleY:i})=>{let r=Ce.getFromCache(this.boundsCache,n,()=>Ce.getBoundsFromPoints(n.points)),d=n.points.map(([p,c,h])=>[t.width*(o<0?1-p/r.width:p/r.width),t.height*(i<0?1-c/r.height:c/r.height),h]),a=Ce.getBoundsFromPoints(e.points),l=ut.sub([t.minX,t.minY],[a.minX,a.minY]);return{points:d,point:l}};this.getBounds=e=>{let t=!this.pointsBoundsCache.has(e.points),n=this.pointCache[e.id]!==e.point;if(t){let o=Ce.getBoundsFromPoints(e.points);this.pointsBoundsCache.set(e.points,o),this.shapeBoundsCache.set(e.id,Ce.translateBounds(o,e.point)),this.pointCache[e.id]=e.point}else n&&!t&&(this.pointCache[e.id]=e.point,this.shapeBoundsCache.set(e.id,Ce.translateBounds(this.pointsBoundsCache.get(e.points),e.point)));return this.shapeBoundsCache.get(e.id)};this.shouldRender=(e,t)=>t.points!==e.points||t.style!==e.style||t.isComplete!==e.isComplete;this.hitTestPoint=(e,t)=>{let n=ut.sub(t,e.point);return Ce.pointInPolyline(n,e.points)};this.hitTestLineSegment=(e,t,n)=>{let{points:o,point:i}=e,r=ut.sub(t,i),d=ut.sub(n,i),a=this.getBounds(e);if(o.length<=2)return ut.distanceToLineSegment(t,n,e.point)<4;if(Zd(r,d,a)){for(let l=1;l<o.length;l++)if(Jd(o[l-1],o[l],r,d).didIntersect)return!0}return!1};this.hitTestBounds=(e,t)=>{if(!e.rotation){let i=this.getBounds(e);return Ce.boundsContain(t,i)||(Ce.boundsContain(i,t)||Yd(i,t).length>0)&&Hi(Ce.translateBounds(t,ut.neg(e.point)),e.points).length>0}let n=this.getRotatedBounds(e),o=Ce.getFromCache(this.rotatedCache,e,()=>{let i=Ce.getBoundsCenter(Ce.getBoundsFromPoints(e.points));return e.points.map(r=>ut.rotWith(r,i,e.rotation||0))});return Ce.boundsContain(t,n)||Hi(Ce.translateBounds(t,ut.neg(e.point)),o).length>0}}};import{Utils as Wn}from"@tldraw/core";import{intersectLineSegmentBounds as nl}from"@tldraw/intersect";var Ai=(s=21)=>{let e="",t=crypto.getRandomValues(new Uint8Array(s));for(;s--;){let n=t[s]&63;n<36?e+=n.toString(36):n<62?e+=(n-26).toString(36).toUpperCase():n<63?e+="_":e+="-"}return e};import{createElement as Fi}from"react";import{TLShapeUtil as qd,SVGContainer as Qd}from"@tldraw/core";var Oi=qd.Component(({shape:s,events:e,isGhost:t,meta:n},o)=>{let i=n.isDarkMode?"white":"black";return Fi(Qd,m({fr:void 0,ref:o},e),Fi("image",{href:s.url,width:s.size[0],height:s.size[1],stroke:i,strokeWidth:3,strokeLinejoin:"round",fill:"none",rx:4,opacity:t?.3:1,pointerEvents:"all"}))});import{createElement as tl}from"react";import{TLShapeUtil as el}from"@tldraw/core";var Ui=el.Indicator(({shape:s})=>tl("rect",{pointerEvents:"none",width:s.size[0],height:s.size[1],fill:"none",stroke:"tl-selectedStroke",strokeWidth:1,rx:4}));var $o=class extends Y{constructor(){super(...arguments);this.type=x.Image;this.Component=Oi;this.Indicator=Ui;this.getBounds=e=>{let t=Wn.getFromCache(this.boundsCache,e,()=>{let[n,o]=e.size;return{minX:0,maxX:n,minY:0,maxY:o,width:n,height:o}});return Wn.translateBounds(t,e.point)};this.canBind=!0;this.getShape=e=>m({id:Ai(),type:x.Image,name:"Image",parentId:"page1",point:[0,0],size:[100,100],childIndex:1,style:Be},e);this.getCenter=e=>Wn.getBoundsCenter(this.getBounds(e));this.hitTestPoint=(e,t)=>Wn.pointInBounds(t,this.getBounds(e));this.hitTestLineSegment=(e,t,n)=>nl(t,n,this.getBounds(e)).length>0}};var Ko=new Po,Vo=new Bo,Wo=new jo,ln=new Ro,ol=new Ao,sl=new Eo,Nn=new Lo,il=new $o,mt={[x.Rectangle]:Ko,[x.Ellipse]:Vo,[x.Draw]:Wo,[x.Arrow]:ln,[x.Text]:ol,[x.Group]:sl,[x.Sticky]:Nn,[x.Image]:il},zi=s=>typeof s=="string"?mt[s]:mt[s.type];var ji=!1,A=class{static getShapeUtil(e){return zi(e)}static getSelectedShapes(e,t){let n=A.getPage(e,t);return A.getSelectedIds(e,t).map(i=>n.shapes[i])}static screenToWorld(e,t){let n=A.getPageState(e,e.appState.currentPageId).camera;return xt.sub(xt.div(t,n.zoom),n.point)}static getCameraZoom(e){return ot.clamp(e,.1,5)}static getPage(e,t){return e.document.pages[t]}static getPageState(e,t){return e.document.pageStates[t]}static getSelectedIds(e,t){return A.getPageState(e,t).selectedIds}static getShapes(e,t){return Object.values(A.getPage(e,t).shapes)}static getCamera(e,t){return A.getPageState(e,t).camera}static getShape(e,t,n){return A.getPage(e,n).shapes[t]}static getCenter(e){return A.getShapeUtil(e).getCenter(e)}static getBounds(e){return A.getShapeUtil(e).getBounds(e)}static getRotatedBounds(e){return A.getShapeUtil(e).getRotatedBounds(e)}static getSelectedBounds(e){return ot.getCommonBounds(A.getSelectedShapes(e,e.appState.currentPageId).map(t=>A.getShapeUtil(t).getBounds(t)))}static getParentId(e,t,n){return A.getShape(e,t,n).parentId}static getDocumentBranch(e,t,n){let o=A.getShape(e,t,n);return o.children===void 0?[t]:[t,...o.children.flatMap(i=>A.getDocumentBranch(e,i,n))]}static getSelectedBranchSnapshot(e,t,n){let o=A.getPage(e,t),i=A.getSelectedIds(e,t).flatMap(r=>A.getDocumentBranch(e,r,t).map(d=>o.shapes[d])).filter(r=>!r.isLocked).map(ot.deepClone);return n!==void 0?i.map(r=>m({id:r.id},n(r))):i}static getSelectedShapeSnapshot(e,t,n){let o=A.getSelectedShapes(e,t).filter(i=>!i.isLocked).map(ot.deepClone);return n!==void 0?o.map(i=>m({id:i.id},n(i))):o}static getAllEffectedShapeIds(e,t,n){let o=A.getPage(e,n),i=new Set(t);return t.forEach(r=>{let d=o.shapes[r];function a(p){p.children!==void 0&&p.children.filter(c=>!i.has(c)).forEach(c=>{i.add(c),a(o.shapes[c])})}a(d);function l(p){let c=p.parentId;c!==o.id&&(i.has(c)||(i.add(c),l(o.shapes[c])))}l(d),i.forEach(p=>{Object.values(o.bindings).filter(c=>c.fromId===p||c.toId===p).forEach(c=>i.add(c.fromId===p?c.toId:c.fromId))})}),Array.from(i.values())}static updateBindings(e,t,n={},o={},i){let r=m({},A.getPage(e,i));return Object.values(r.bindings).filter(d=>d.fromId===t||d.toId===t).reduce((d,a)=>(n[a.fromId]||(n[a.fromId]=ot.deepClone(A.getShape(d,a.fromId,i))),n[a.toId]||(n[a.toId]=ot.deepClone(A.getShape(d,a.toId,i))),A.onBindingChange(A.getShape(d,a.fromId,i),a,A.getShape(d,a.toId,i)),o[a.fromId]=ot.deepClone(A.getShape(d,a.fromId,i)),o[a.toId]=ot.deepClone(A.getShape(d,a.toId,i)),d),e)}static getLinkedShapeIds(e,t,n,o=!0){let i=A.getSelectedIds(e,t),r=A.getPage(e,t),d=new Set(i),a=new Set,l=[...i],p=new Set(Object.values(r.shapes).filter(c=>{var h;return c.type===x.Arrow&&(c.handles.start.bindingId||((h=c.handles)==null?void 0:h.end.bindingId))}));for(;l.length;){let c=l.pop();if(!(c&&p.size))break;a.has(c)||(a.add(c),p.forEach(h=>{var S,w;let{handles:{start:{bindingId:u},end:{bindingId:f}}}=h,g=u?r.bindings[u]:null,b=f?r.bindings[f]:null,P=!1;g&&g.toId===c?(n==="center"?P=!0:((S=h.decorations)==null?void 0:S.start)&&b?P=n==="left":P=n==="right",P&&(o&&d.add(h.id),d.add(c),b&&(d.add(b.toId),l.push(b.toId)))):b&&b.toId===c&&(n==="center"?P=!0:((w=h.decorations)==null?void 0:w.end)&&g?P=n==="left":P=n==="right",P&&(o&&d.add(h.id),d.add(c),g&&(d.add(g.toId),l.push(g.toId)))),(!g||d.has(g.toId))&&(!b||d.has(b.toId))&&p.delete(h)}))}return Array.from(d.values())}static getChildIndexAbove(e,t,n){let o=e.document.pages[n],i=o.shapes[t],r;if(i.parentId===o.id)r=Object.values(o.shapes).filter(l=>l.parentId===o.id).sort((l,p)=>l.childIndex-p.childIndex);else{let l=o.shapes[i.parentId];if(!l.children)throw Error("No children in parent!");r=l.children.map(p=>o.shapes[p]).sort((p,c)=>p.childIndex-c.childIndex)}let d=r.indexOf(i),a=r[d+1];return a?a.childIndex:i.childIndex+1}static getBeforeShape(e,t){return Object.fromEntries(Object.keys(t).map(n=>[n,e[n]]))}static mutateShapes(e,t,n,o){let i={},r={};t.forEach((l,p)=>{let c=A.getShape(e,l,o);if(c.isLocked)return;let h=n(c,p);h&&(i[l]=A.getBeforeShape(c,h),r[l]=h)});let d=ot.deepMerge(e,{document:{pages:{[e.appState.currentPageId]:{shapes:r}}}}),a=t.reduce((l,p)=>A.updateBindings(l,p,i,r,o),d);return{before:i,after:r,data:a}}static createShapes(e,t,n){let o={document:{pages:{[n]:{shapes:m({},Object.fromEntries(t.flatMap(r=>{let d=[[r.id,void 0]];if(r.parentId!==n){let a=A.getShape(e,r.parentId,n);if(!a.children)throw Error("No children in parent!");d.push([a.id,{children:a.children}])}return d})))}}}},i={document:{pages:{[n]:{shapes:{shapes:m({},Object.fromEntries(t.flatMap(r=>{let d=[[r.id,r]];if(r.parentId!==n){let a=A.getShape(e,r.parentId,n);if(!a.children)throw Error("No children in parent!");d.push([a.id,{children:[...a.children,r.id]}])}return d})))}}}}};return{before:o,after:i}}static deleteShapes(e,t,n){n=n||e.appState.currentPageId;let o=A.getPage(e,n),i=typeof t[0]=="string"?t:t.map(a=>a.id),r={document:{pages:{[n]:{shapes:m({},Object.fromEntries(i.flatMap(a=>{let l=o.shapes[a],p=[[l.id,l]];if(l.parentId!==n){let c=o.shapes[l.parentId];if(!c.children)throw Error("No children in parent!");p.push([c.id,{children:c.children}])}return p}))),bindings:m({},Object.fromEntries(Object.values(o.bindings).filter(a=>i.includes(a.fromId)||i.includes(a.toId)).map(a=>[a.id,a])))}}}},d={document:{pages:{[n]:{shapes:m({},Object.fromEntries(i.flatMap(a=>{let l=o.shapes[a],p=[[l.id,void 0]];if(l.parentId!==o.id){let c=o.shapes[l.parentId];if(!c.children)throw Error("No children in parent!");p.push([c.id,{children:c.children.filter(h=>h!==l.id)}])}return p})))}}}};return{before:r,after:d}}static onSessionComplete(e){var n,o;let t=(o=(n=A.getShapeUtil(e)).onSessionComplete)==null?void 0:o.call(n,e);return t?m(m({},e),t):e}static onChildrenChange(e,t,n){var i,r;if(!t.children)return;let o=(r=(i=A.getShapeUtil(t)).onChildrenChange)==null?void 0:r.call(i,t,t.children.map(d=>A.getShape(e,d,n)));return o?m(m({},t),o):t}static onBindingChange(e,t,n){var i,r;let o=(r=(i=A.getShapeUtil(e)).onBindingChange)==null?void 0:r.call(i,e,t,n,A.getShapeUtil(n).getBounds(n),A.getShapeUtil(n).getCenter(n));return o?m(m({},e),o):e}static transform(e,t,n){let o=A.getShapeUtil(e).transform(e,t,n);return o?m(m({},e),o):e}static transformSingle(e,t,n){let o=A.getShapeUtil(e).transformSingle(e,t,n);return o?m(m({},e),o):e}static getRotatedShapeMutation(e,t,n,o){var l,p;let i=xt.sub(t,e.point),r=xt.rotWith(t,n,o),d=xt.toFixed(xt.sub(r,i));if(e.handles!==void 0)return(p=(l=this.getShapeUtil(e)).onHandleChange)==null?void 0:p.call(l,y(m({},e),{point:d}),Object.fromEntries(Object.entries(e.handles).map(([h,u])=>{let f=xt.toFixed(xt.rotWith(u.point,i,o));return[h,y(m({},u),{point:f})]})),{shiftKey:!1});let a=ot.clampRadians((e.rotation||0)+o);return{point:d,rotation:a}}static updateParents(e,t,n){let o=A.getPage(e,t);if(n.length===0)return;let{shapes:i}=A.getPage(e,t),r=Array.from(new Set(n.map(d=>i[d].parentId).values())).filter(d=>d!==o.id);for(let d of r){let a=i[d];if(!a.children)throw Error("A shape is parented to a shape without a children array.");A.onChildrenChange(e,a,t)}A.updateParents(e,t,r)}static getBinding(e,t,n){return A.getPage(e,n).bindings[t]}static getBindings(e,t){let n=A.getPage(e,t);return Object.values(n.bindings)}static getBindableShapeIds(e){return A.getShapes(e,e.appState.currentPageId).filter(t=>A.getShapeUtil(t).canBind).sort((t,n)=>n.childIndex-t.childIndex).map(t=>t.id)}static getBindingsWithShapeIds(e,t,n){return Array.from(new Set(A.getBindings(e,n).filter(o=>t.includes(o.toId)||t.includes(o.fromId))).values())}static getRelatedBindings(e,t,n){let o=new Set(t),i=A.getPage(e,n),r=Object.values(i.bindings),d=new Set(r.filter(p=>o.has(p.toId)||o.has(p.fromId))),a=d.size,l=-1;for(;l!==0;)d.forEach(p=>{let c=p.fromId;for(let h of r)h.fromId===c&&d.add(h),h.toId===c&&d.add(h)}),l=d.size-a,a=d.size;return Array.from(d.values())}static normalizeText(e){return e.replace(A.fixNewLines,`
`)}static assertShapeHasProperty(e,t){if(e[t]===void 0)throw new Error}static warn(e){ji&&console.warn(e)}static error(e){ji&&console.error(e)}},I=A;I.copyStringToClipboard=e=>{try{navigator.clipboard.writeText(e)}catch(t){let n=document.createElement("textarea");n.setAttribute("position","fixed"),n.setAttribute("top","0"),n.setAttribute("readonly","true"),n.setAttribute("contenteditable","true"),n.style.position="fixed",n.value=e,document.body.appendChild(n),n.focus(),n.select();try{let o=document.createRange();o.selectNodeContents(n);let i=window.getSelection();i&&(i.removeAllRanges(),i.addRange(o),n.setSelectionRange(0,n.value.length))}catch(o){}finally{document.body.removeChild(n)}}},I.flattenShape=(e,t)=>{var n;return[t,...((n=t.children)!=null?n:[]).map(o=>A.getShape(e,o,e.appState.currentPageId)).sort((o,i)=>o.childIndex-i.childIndex).flatMap(o=>A.flattenShape(e,o))]},I.flattenPage=(e,t)=>Object.values(e.document.pages[t].shapes).sort((n,o)=>n.childIndex-o.childIndex).reduce((n,o)=>[...n,...A.flattenShape(e,o)],[]),I.getTopChildIndex=(e,t)=>{let n=A.getShapes(e,t);return n.length===0?1:n.filter(o=>o.parentId===t).sort((o,i)=>i.childIndex-o.childIndex)[0].childIndex+1},I.fixNewLines=/\r?\n|\r/g;import{Vec as Gi}from"@tldraw/vec";import{Utils as rl}from"@tldraw/core";function $i(s,e,t){let{currentPageId:n}=s,o=e.map(h=>s.getShape(h)),i=o.map(h=>({id:h.id,point:[...h.point],bounds:I.getBounds(h)})),r=rl.getCommonBounds(i.map(({bounds:h})=>h)),d=r.minX+r.width/2,a=r.minY+r.height/2,l=Object.fromEntries(i.map(({id:h,point:u,bounds:f})=>[h,{prev:u,next:{[ne.CenterVertical]:[u[0],a-f.height/2],[ne.CenterHorizontal]:[d-f.width/2,u[1]],[ne.Top]:[u[0],r.minY],[ne.Bottom]:[u[0],r.maxY-f.height],[ne.Left]:[r.minX,u[1]],[ne.Right]:[r.maxX-f.width,u[1]]}[t]}])),{before:p,after:c}=I.mutateShapes(s.state,e,h=>l[h.id]?{point:l[h.id].next}:h,n);return o.forEach(h=>{if(h.type===x.Group){let u=Gi.sub(c[h.id].point,p[h.id].point);h.children.forEach(f=>{let g=s.getShape(f);p[g.id]={point:g.point},c[g.id]={point:Gi.add(g.point,u)}}),delete p[h.id],delete c[h.id]}}),{id:"align",before:{document:{pages:{[n]:{shapes:p}},pageStates:{[n]:{selectedIds:e}}}},after:{document:{pages:{[n]:{shapes:c}},pageStates:{[n]:{selectedIds:e}}}}}}function Ki(s,e){return{id:"change_page",before:{appState:{currentPageId:s.currentPageId}},after:{appState:{currentPageId:e}}}}import{Utils as al}from"@tldraw/core";function Vi(s,e,t=al.uniqueId()){let{currentPageId:n}=s,o=Object.values(s.state.document.pages).sort((l,p)=>(p.childIndex||0)-(l.childIndex||0))[0],i=(o==null?void 0:o.childIndex)?(o==null?void 0:o.childIndex)+1:1,d={id:t,name:"New Page",childIndex:i,shapes:{},bindings:{}},a={id:t,selectedIds:[],camera:{point:e,zoom:1},editingId:void 0,bindingId:void 0,hoveredId:void 0,pointedId:void 0};return{id:"create_page",before:{appState:{currentPageId:n},document:{pages:{[t]:void 0},pageStates:{[t]:void 0}}},after:{appState:{currentPageId:d.id},document:{pages:{[t]:d},pageStates:{[t]:a}}}}}function No(s,e,t=[]){let{currentPageId:n}=s,o={},i={};e.forEach(a=>{o[a.id]=void 0,i[a.id]=a});let r={},d={};return t.forEach(a=>{r[a.id]=void 0,d[a.id]=a}),{id:"create",before:{document:{pages:{[n]:{shapes:o,bindings:r}},pageStates:{[n]:{selectedIds:[...s.selectedIds]}}}},after:{document:{pages:{[n]:{shapes:i,bindings:d}},pageStates:{[n]:{selectedIds:e.map(a=>a.id)}}}}}}function Wi(s,e){let{currentPageId:t,document:{pages:n,pageStates:o}}=s,i=Object.values(n).sort((a,l)=>(a.childIndex||0)-(l.childIndex||0)),r=i.findIndex(a=>a.id===e),d;return e===t?r===i.length-1?d=i[i.length-2].id:d=i[r+1].id:d=t,{id:"delete_page",before:{appState:{currentPageId:e},document:{pages:{[e]:m({},n[e])},pageStates:{[e]:m({},o[e])}}},after:{appState:{currentPageId:d},document:{pages:{[e]:void 0},pageStates:{[e]:void 0}}}}}function Ni(s,e,t){let n={shapes:{},bindings:{}},o={shapes:{},bindings:{}},i=[],r=new Set;e.filter(a=>!I.getShape(s,a,t).isLocked).forEach(a=>{r.add(a);let l=I.getShape(s,a,t);n.shapes[a]=l,o.shapes[a]=void 0,l.children!==void 0&&l.children.forEach(p=>{r.add(p);let c=I.getShape(s,p,t);n.shapes[p]=c,o.shapes[p]=void 0}),l.parentId!==t&&i.push(I.getShape(s,l.parentId,t))}),i.forEach(a=>{var l;e.includes(a.id)||(r.add(a.id),n.shapes[a.id]={children:a.children},o.shapes[a.id]={children:a.children.filter(p=>!e.includes(p))},((l=o.shapes[a.id])==null?void 0:l.children.length)===0&&(o.shapes[a.id]=void 0,n.shapes[a.id]=I.getShape(s,a.id,t)))});let d=I.getPage(s,t);return Object.values(d.bindings).filter(a=>r.has(a.fromId)||r.has(a.toId)).forEach(a=>{for(let l of[a.toId,a.fromId])if(o.shapes[l]===void 0){n.bindings[a.id]=a,o.bindings[a.id]=void 0;let p=d.shapes[l];p&&p.handles&&Object.values(p.handles).filter(c=>c.bindingId===a.id).forEach(c=>{var h,u,f,g,b,P;n.shapes[l]=y(m({},n.shapes[l]),{handles:y(m({},(h=n.shapes[l])==null?void 0:h.handles),{[c.id]:y(m({},(f=(u=n.shapes[l])==null?void 0:u.handles)==null?void 0:f[c.id]),{bindingId:a.id})})}),r.has(l)||(o.shapes[l]=y(m({},o.shapes[l]),{handles:y(m({},(g=o.shapes[l])==null?void 0:g.handles),{[c.id]:y(m({},(P=(b=o.shapes[l])==null?void 0:b.handles)==null?void 0:P[c.id]),{bindingId:void 0})})}))})}}),{before:n,after:o}}function _o(s,e,t=s.currentPageId){let{pageState:n,selectedIds:o}=s,{before:i,after:r}=Ni(s.state,e,t);return{id:"delete",before:{document:{pages:{[t]:i},pageStates:{[t]:{selectedIds:[...s.selectedIds]}}}},after:{document:{pages:{[t]:r},pageStates:{[t]:{selectedIds:o.filter(d=>!e.includes(d)),hoveredId:n.hoveredId&&e.includes(n.hoveredId)?void 0:n.hoveredId}}}}}}import{Utils as dl}from"@tldraw/core";import _i from"@tldraw/vec";function Xi(s,e,t){let{currentPageId:n}=s,o=e.map(a=>s.getShape(a)),i=Object.fromEntries(ll(o,t).map(a=>[a.id,a])),{before:r,after:d}=I.mutateShapes(s.state,e.filter(a=>i[a]!==void 0),a=>({point:i[a.id].next}),n);return o.forEach(a=>{if(a.type===x.Group){let l=_i.sub(d[a.id].point,r[a.id].point);a.children.forEach(p=>{let c=s.getShape(p);r[c.id]={point:c.point},d[c.id]={point:_i.add(c.point,l)}}),delete r[a.id],delete d[a.id]}}),{id:"distribute",before:{document:{pages:{[n]:{shapes:r}},pageStates:{[n]:{selectedIds:e}}}},after:{document:{pages:{[n]:{shapes:d}},pageStates:{[n]:{selectedIds:e}}}}}}function ll(s,e){let t=s.map(r=>{let d=I.getShapeUtil(r);return{id:r.id,point:[...r.point],bounds:d.getBounds(r),center:d.getCenter(r)}}),n=t.length,o=dl.getCommonBounds(t.map(({bounds:r})=>r)),i=[];switch(e){case We.Horizontal:{let r=t.reduce((d,a)=>d+a.bounds.width,0);if(r>o.width){let d=t.sort((h,u)=>h.bounds.minX-u.bounds.minX)[0],a=t.sort((h,u)=>u.bounds.maxX-h.bounds.maxX)[0],l=t.filter(h=>h!==d&&h!==a).sort((h,u)=>h.center[0]-u.center[0]),p=(a.center[0]-d.center[0])/(n-1),c=d.center[0]+p;l.forEach(({id:h,point:u,bounds:f},g)=>{i.push({id:h,prev:u,next:[c+p*g-f.width/2,f.minY]})})}else{let d=t.sort((p,c)=>p.center[0]-c.center[0]),a=o.minX,l=(o.width-r)/(n-1);d.forEach(({id:p,point:c,bounds:h})=>{i.push({id:p,prev:c,next:[a,h.minY]}),a+=h.width+l})}break}case We.Vertical:{let r=t.reduce((d,a)=>d+a.bounds.height,0);if(r>o.height){let d=t.sort((h,u)=>h.bounds.minY-u.bounds.minY)[0],a=t.sort((h,u)=>u.bounds.maxY-h.bounds.maxY)[0],l=t.filter(h=>h!==d&&h!==a).sort((h,u)=>h.center[1]-u.center[1]),p=(a.center[1]-d.center[1])/(n-1),c=d.center[1]+p;l.forEach(({id:h,point:u,bounds:f},g)=>{i.push({id:h,prev:u,next:[f.minX,c+p*g-f.height/2]})})}else{let d=t.sort((p,c)=>p.center[1]-c.center[1]),a=o.minY,l=(o.height-r)/(n-1);d.forEach(({id:p,point:c,bounds:h})=>{i.push({id:p,prev:c,next:[h.minX,a]}),a+=h.height+l})}break}}return i}import{Utils as cl}from"@tldraw/core";function Yi(s,e){let t=cl.uniqueId(),{currentPageId:n,page:o,pageState:{camera:i}}=s,r=y(m({},o),{id:t,name:o.name+" Copy",shapes:Object.fromEntries(Object.entries(o.shapes).map(([d,a])=>[d,y(m({},a),{parentId:a.parentId===e?t:a.parentId})]))});return{id:"duplicate_page",before:{appState:{currentPageId:n},document:{pages:{[t]:void 0},pageStates:{[t]:void 0}}},after:{appState:{currentPageId:t},document:{pages:{[t]:r},pageStates:{[t]:y(m({},o),{id:t,selectedIds:[],camera:m({},i),editingId:void 0,bindingId:void 0,hoveredId:void 0,pointedId:void 0})}}}}}import{Utils as Ct}from"@tldraw/core";import{Vec as Xo}from"@tldraw/vec";function Zi(s,e,t){let{selectedIds:n,currentPageId:o,page:i,shapes:r}=s,d={shapes:{},bindings:{}},a={shapes:{},bindings:{}},l={},p=e.map(u=>s.getShape(u)).filter(u=>!e.includes(u.parentId));p.forEach(u=>{let f=Ct.uniqueId();if(d.shapes[f]=void 0,a.shapes[f]=y(m({},Ct.deepClone(u)),{id:f,childIndex:I.getChildIndexAbove(s.state,u.id,o)}),u.children&&(a.shapes[f].children=[]),u.parentId!==o){let g=s.getShape(u.parentId);d.shapes[g.id]=y(m({},d.shapes[g.id]),{children:g.children}),a.shapes[g.id]=y(m({},a.shapes[g.id]),{children:[...(a.shapes[g.id]||g).children,f]})}l[u.id]=f}),p.forEach(u=>{u.children&&u.children.forEach(f=>{var S,w;let g=s.getShape(f),b=Ct.uniqueId(),P=l[u.id];d.shapes[b]=void 0,a.shapes[b]=y(m({},Ct.deepClone(g)),{id:b,parentId:P,childIndex:I.getChildIndexAbove(s.state,g.id,o)}),l[f]=b,(w=(S=a.shapes[l[u.id]])==null?void 0:S.children)==null||w.push(b)})});let c=new Set(Object.keys(l));Object.values(i.bindings).filter(u=>c.has(u.fromId)||c.has(u.toId)).forEach(u=>{if(c.has(u.fromId))if(c.has(u.toId)){let f=Ct.uniqueId(),g=y(m({},Ct.deepClone(u)),{id:f,fromId:l[u.fromId],toId:l[u.toId]});d.bindings[f]=void 0,a.bindings[f]=g;let b=a.shapes[g.fromId];Object.values(b.handles).forEach(P=>{P.bindingId===u.id&&(P.bindingId=f)})}else{let f=a.shapes[l[u.fromId]];Object.values(f.handles).forEach(g=>{g.bindingId===u.id&&(g.bindingId=void 0)})}});let h=Object.values(a.shapes);if(t){let u=Ct.getCommonBounds(h.map(g=>I.getBounds(g))),f=Ct.getBoundsCenter(u);h.forEach(g=>{!g.point||(g.point=Xo.sub(t,Xo.sub(f,g.point)))})}else{let u=[16,16];h.forEach(f=>{!f.point||(f.point=Xo.add(f.point,u))})}return h.forEach(u=>{u.isLocked&&(u.isLocked=!1)}),{id:"duplicate",before:{document:{pages:{[o]:d},pageStates:{[o]:{selectedIds:n}}}},after:{document:{pages:{[o]:a},pageStates:{[o]:{selectedIds:Array.from(c.values()).map(u=>l[u])}}}}}}import{TLBoundsCorner as Ji,Utils as Yo}from"@tldraw/core";function Zo(s,e,t){let{selectedIds:n,currentPageId:o,shapes:i}=s,r=i.map(p=>I.getBounds(p)),d=Yo.getCommonBounds(r),{before:a,after:l}=I.mutateShapes(s.state,e,p=>{let c=I.getBounds(p);switch(t){case bt.Horizontal:{let h=Yo.getRelativeTransformedBoundingBox(d,d,c,!0,!1);return I.getShapeUtil(p).transform(p,h,{type:Ji.TopLeft,scaleX:-1,scaleY:1,initialShape:p,transformOrigin:[.5,.5]})}case bt.Vertical:{let h=Yo.getRelativeTransformedBoundingBox(d,d,c,!1,!0);return I.getShapeUtil(p).transform(p,h,{type:Ji.TopLeft,scaleX:1,scaleY:-1,initialShape:p,transformOrigin:[.5,.5]})}}},o);return{id:"flip",before:{document:{pages:{[o]:{shapes:a}},pageStates:{[o]:{selectedIds:n}}}},after:{document:{pages:{[o]:{shapes:l}},pageStates:{[o]:{selectedIds:e}}}}}}import{Utils as pl}from"@tldraw/core";function qi(s,e,t,n){var w,v;let o={},i={},r={},d={},a=[...e],l=[],p=[],c=[];for(let T of e){let C=s.getShape(T);if(!C.isLocked)if(C.children===void 0)l.push(C);else{let R=C.children.filter(B=>!s.getShape(B).isLocked);c.push(C),a.push(...R),l.push(...R.map(B=>s.getShape(B)))}}if(l.every(T=>T.parentId===l[0].parentId)&&l[0].parentId!==n&&((w=s.getShape(l[0].parentId).children)==null?void 0:w.length)===a.length)return;let h=I.flattenPage(s.state,n),u=Object.fromEntries(l.map(T=>[T.id,h.indexOf(T)])),f=l.sort((T,C)=>u[T.id]-u[C.id]),g=n,b=(f.filter(T=>T.parentId===n)[0]||f[0]).childIndex,P=pl.getCommonBounds(l.map(T=>I.getBounds(T)));for(o[t]=void 0,i[t]=I.getShapeUtil(x.Group).create({id:t,childIndex:b,parentId:g,point:[P.minX,P.minY],size:[P.width,P.height],children:f.map(T=>T.id)}),f.forEach((T,C)=>{if(T.parentId!==n){let R=s.getShape(T.parentId);c.push(R)}o[T.id]=y(m({},o[T.id]),{parentId:T.parentId,childIndex:T.childIndex}),i[T.id]=y(m({},i[T.id]),{parentId:t,childIndex:C+1})});c.length>0;){let T=c.pop();if(!T)break;let C=(((v=o[T.id])==null?void 0:v.children)||T.children).filter(R=>R&&!(a.includes(R)||p.includes(R)));C.length===0?(o[T.id]=T,i[T.id]=void 0,T.parentId!==n&&(p.push(T.id),c.push(s.getShape(T.parentId)))):(o[T.id]=y(m({},o[T.id]),{children:T.children}),i[T.id]=y(m({},i[T.id]),{children:C}))}let{bindings:S}=s;return S.forEach(T=>{for(let C of[T.toId,T.fromId])if(i[C]===void 0){r[T.id]=T,d[T.id]=void 0;let R=s.getShape(C);R.handles&&Object.values(R.handles).filter(B=>B.bindingId===T.id).forEach(B=>{var O,j;o[C]=y(m({},o[C]),{handles:y(m({},(O=o[C])==null?void 0:O.handles),{[B.id]:{bindingId:T.id}})}),p.includes(C)||(i[C]=y(m({},i[C]),{handles:y(m({},(j=i[C])==null?void 0:j.handles),{[B.id]:{bindingId:void 0}})}))})}}),{id:"group",before:{document:{pages:{[n]:{shapes:o,bindings:r}},pageStates:{[n]:{selectedIds:e}}}},after:{document:{pages:{[n]:{shapes:i,bindings:r}},pageStates:{[n]:{selectedIds:[t]}}}}}}import{Utils as hl}from"@tldraw/core";import{Vec as Qi}from"@tldraw/vec";function er(s,e,t,n,o){let{page:i}=s,r={before:{shapes:{},bindings:{}},after:{shapes:{},bindings:{}}},d={before:{shapes:{},bindings:{}},after:{shapes:{},bindings:{}}},a=new Set,l=new Set;e.map(S=>s.getShape(S,n)).filter(S=>!S.isLocked).forEach(S=>{a.add(S.id),l.add(S),S.children!==void 0&&S.children.forEach(w=>{a.add(w),l.add(s.getShape(w,n))})});let p=I.getTopChildIndex(s.state,o),c=Array.from(l.values());c.forEach((S,w)=>{if(r.before.shapes[S.id]=S,r.after.shapes[S.id]=void 0,d.before.shapes[S.id]=void 0,d.after.shapes[S.id]=S,!a.has(S.parentId)&&(d.after.shapes[S.id]=y(m({},S),{parentId:o,childIndex:p+w}),S.parentId!==n)){let v=s.getShape(S.parentId,n);r.before.shapes[v.id]={children:v.children},r.after.shapes[v.id]={children:v.children.filter(T=>T!==S.id)}}}),Object.values(i.bindings).filter(S=>a.has(S.fromId)||a.has(S.toId)).forEach(S=>{r.before.bindings[S.id]=S,r.after.bindings[S.id]=void 0;let w=s.getShape(S.fromId,n);if(a.has(S.fromId)&&a.has(S.toId))d.before.bindings[S.id]=void 0,d.after.bindings[S.id]=S;else if(a.has(S.fromId)){let T=s.getShape(S.fromId,n),R=Object.values(w.handles).find(O=>O.bindingId===S.id).id,B=d.after.shapes[T.id];B.handles=y(m({},B.handles),{[R]:y(m({},B.handles[R]),{bindingId:void 0})})}else{let T=s.getShape(S.fromId,n),C=Object.values(w.handles).find(R=>R.bindingId===S.id);r.before.shapes[T.id]={handles:{[C.id]:{bindingId:S.id}}},r.after.shapes[T.id]={handles:{[C.id]:{bindingId:void 0}}}}});let h=s.state.document.pageStates[o],u=hl.getCommonBounds(c.map(S=>I.getBounds(S))),f=I.getCameraZoom(t.width<t.height?(t.width-128)/u.width:(t.height-128)/u.height),g=(t.width-u.width*f)/2/f,b=(t.height-u.height*f)/2/f,P=Qi.toFixed(Qi.add([-u.minX,-u.minY],[g,b]));return{id:"move_to_page",before:{appState:{currentPageId:n},document:{pages:{[n]:r.before,[o]:d.before},pageStates:{[n]:{selectedIds:e},[o]:{selectedIds:h.selectedIds,camera:h.camera}}}},after:{appState:{currentPageId:o},document:{pages:{[n]:r.after,[o]:d.after},pageStates:{[n]:{selectedIds:[]},[o]:{selectedIds:e,camera:{zoom:f,point:P}}}}}}}function cn(s,e,t){let{currentPageId:n,page:o}=s,i=new Set(e.map(p=>s.getShape(p).parentId)),r={before:{},after:{}},d,a,l;return Array.from(i.values()).forEach(p=>{let c=[];if(p===o.id)c=Object.values(o.shapes).sort((f,g)=>f.childIndex-g.childIndex);else{let f=s.getShape(p);if(!f.children)throw Error("No children in parent!");c=f.children.map(g=>s.getShape(g)).sort((g,b)=>g.childIndex-b.childIndex)}let h=c.map(f=>f.id),u=e.filter(f=>h.includes(f)).map(f=>h.indexOf(f)).sort((f,g)=>f-g);if(u.length!==h.length)switch(t){case $e.ToBack:{for(let f=0;f<h.length;f++)if(!u.includes(f)){d=f;break}a=c[d].childIndex,l=a/(u.length+1),r=I.mutateShapes(s.state,u.map(f=>c[f].id).reverse(),(f,g)=>({childIndex:a-(g+1)*l}),n);break}case $e.ToFront:{for(let f=h.length-1;f>=0;f--)if(!u.includes(f)){d=f;break}a=c[d].childIndex,l=1,r=I.mutateShapes(s.state,u.map(f=>c[f].id),(f,g)=>({childIndex:a+(g+1)}),n);break}case $e.Backward:{let f={};for(let g=h.length-1;g>=0;g--)if(u.includes(g)){for(let b=g;b>=0;b--)if(!u.includes(b)){let P=c[b].childIndex,S,w;b===0?(S=P/2,w=P/2/(g-b+1)):(S=c[b-1].childIndex,w=(P-S)/(g-b+1),S+=w);for(let v=0;v<g-b;v++)f[c[b+v+1].id]=S+w*v;break}}Object.values(f).length>0&&(r=I.mutateShapes(s.state,u.map(g=>c[g].id),g=>({childIndex:f[g.id]}),n));break}case $e.Forward:{let f={};for(let g=0;g<h.length;g++)if(u.includes(g)){for(let b=g;b<h.length;b++)if(!u.includes(b)){a=c[b].childIndex;let P=b===h.length-1?1:(c[b+1].childIndex-a)/(b-g+1);for(let S=0;S<b-g;S++)f[c[g+S].id]=a+P*(S+1);break}}Object.values(f).length>0&&(r=I.mutateShapes(s.state,u.map(g=>c[g].id),g=>({childIndex:f[g.id]}),n));break}}}),{id:"move",before:{document:{pages:{[n]:{shapes:r.before}},pageStates:{[n]:{selectedIds:e}}}},after:{document:{pages:{[n]:{shapes:r.after}},pageStates:{[n]:{selectedIds:e}}}}}}function tr(s,e,t){let{page:n}=s;return{id:"rename_page",before:{document:{pages:{[e]:{name:n.name}}}},after:{document:{pages:{[e]:{name:t}}}}}}function Jo(s,e,t){let{currentPageId:n}=s,{before:o,after:i}=I.mutateShapes(s.state,e,r=>{var d,a;return(a=(d=s.getShapeUtil(r)).onDoubleClickBoundsHandle)==null?void 0:a.call(d,r)},t);return{id:"reset_bounds",before:{document:{pages:{[n]:{shapes:o}},pageStates:{[n]:{selectedIds:e}}}},after:{document:{pages:{[n]:{shapes:i}},pageStates:{[n]:{selectedIds:e}}}}}}import{Utils as nr}from"@tldraw/core";var ul=Math.PI*2;function or(s,e,t=-ul/4){let{currentPageId:n}=s,o={},i={},r=e.flatMap(a=>{let l=s.getShape(a);return l.children?l.children.map(p=>s.getShape(p)):l}).filter(a=>!a.isLocked),d=nr.getBoundsCenter(nr.getCommonBounds(r.map(a=>I.getBounds(a))));return r.forEach(a=>{let l=I.getRotatedShapeMutation(a,I.getCenter(a),d,t);!l||(o[a.id]=I.getBeforeShape(a,l),i[a.id]=l)}),{id:"rotate",before:{document:{pages:{[n]:{shapes:o}},pageStates:{[n]:{selectedIds:e}}}},after:{document:{pages:{[n]:{shapes:i}},pageStates:{[n]:{selectedIds:e}}}}}}import{TLBoundsCorner as sr,Utils as ml}from"@tldraw/core";function ir(s,e,t){let{currentPageId:n,selectedIds:o}=s,i=e.map(c=>s.getShape(c)),r=i.map(c=>I.getBounds(c)),d=ml.getCommonBounds(r),a=e.flatMap(c=>{let h=s.getShape(c);return h.children?h.children:h.id}).filter(c=>!s.getShape(c).isLocked),{before:l,after:p}=I.mutateShapes(s.state,a,c=>{let h=I.getBounds(c);switch(t){case Ve.Horizontal:{let u=y(m({},h),{minX:d.minX,maxX:d.maxX,width:d.width});return I.getShapeUtil(c).transformSingle(c,u,{type:sr.TopLeft,scaleX:u.width/h.width,scaleY:1,initialShape:c,transformOrigin:[.5,.5]})}case Ve.Vertical:{let u=y(m({},h),{minY:d.minY,maxY:d.maxY,height:d.height});return I.getShapeUtil(c).transformSingle(c,u,{type:sr.TopLeft,scaleX:1,scaleY:u.height/h.height,initialShape:c,transformOrigin:[.5,.5]})}}},n);return i.forEach(c=>{c.type===x.Group&&(delete l[c.id],delete p[c.id])}),{id:"stretch",before:{document:{pages:{[n]:{shapes:l}},pageStates:{[n]:{selectedIds:o}}}},after:{document:{pages:{[n]:{shapes:p}},pageStates:{[n]:{selectedIds:e}}}}}}import{Vec as qo}from"@tldraw/vec";function rr(s,e,t){let{currentPageId:n,selectedIds:o}=s,i=e.flatMap(a=>I.getDocumentBranch(s.state,a,n)).filter(a=>!s.getShape(a).isLocked),r={},d={};return i.map(a=>s.getShape(a)).filter(a=>!a.isLocked).forEach(a=>{r[a.id]={style:m({},Object.fromEntries(Object.keys(t).map(l=>[l,a.style[l]])))},d[a.id]={style:t},a.type===x.Text&&(r[a.id].point=a.point,d[a.id].point=qo.toFixed(qo.add(a.point,qo.sub(s.getShapeUtil(a).getCenter(a),s.getShapeUtil(a).getCenter(y(m({},a),{style:m(m({},a.style),t)}))))))}),{id:"style",before:{document:{pages:{[n]:{shapes:r}},pageStates:{[n]:{selectedIds:o}}},appState:{currentStyle:m({},s.appState.currentStyle)}},after:{document:{pages:{[n]:{shapes:d}},pageStates:{[n]:{selectedIds:e}}},appState:{currentStyle:t}}}}function ar(s,e,t){let{currentPageId:n,selectedIds:o}=s,i=Object.fromEntries(e.map(d=>{var a;return[d,{decorations:{[t]:(a=s.getShape(d).decorations)==null?void 0:a[t]}}]})),r=Object.fromEntries(e.filter(d=>!s.getShape(d).isLocked).map(d=>{var a;return[d,{decorations:{[t]:((a=s.getShape(d).decorations)==null?void 0:a[t])?void 0:tt.Arrow}}]}));return{id:"toggle_decorations",before:{document:{pages:{[n]:{shapes:i}},pageStates:{[n]:{selectedIds:o}}}},after:{document:{pages:{[n]:{shapes:r}},pageStates:{[n]:{selectedIds:e}}}}}}function _n(s,e,t){let{currentPageId:n}=s,o=e.map(a=>s.getShape(a)).filter(a=>t==="isLocked"?!0:!a.isLocked),i=o.every(a=>a[t]),r={},d={};return o.forEach(a=>{r[a.id]={[t]:a[t]},d[a.id]={[t]:!i}}),{id:"toggle",before:{document:{pages:{[n]:{shapes:r}},pageStates:{[n]:{selectedIds:e}}}},after:{document:{pages:{[n]:{shapes:d}},pageStates:{[n]:{selectedIds:e}}}}}}import{Vec as dr}from"@tldraw/vec";function lr(s,e,t){let{currentPageId:n,selectedIds:o}=s;s.rotationInfo.selectedIds=[...o];let i={shapes:{},bindings:{}},r={shapes:{},bindings:{}},d=e.flatMap(p=>{let c=s.getShape(p);return c.children?c.children:c.id}).filter(p=>!s.getShape(p).isLocked),a=I.mutateShapes(s.state,d,p=>({point:dr.toFixed(dr.add(p.point,t))}),n);return i.shapes=a.before,r.shapes=a.after,I.getBindings(s.state,n).filter(p=>e.includes(p.fromId)&&!e.includes(p.toId)).forEach(p=>{i.bindings[p.id]=p,r.bindings[p.id]=void 0;for(let c of[p.toId,p.fromId]){let h=s.getShape(c);!h.handles||Object.values(h.handles).filter(u=>u.bindingId===p.id).forEach(u=>{var f,g;i.shapes[c]=y(m({},i.shapes[c]),{handles:y(m({},(f=i.shapes[c])==null?void 0:f.handles),{[u.id]:{bindingId:p.id}})}),r.shapes[c]=y(m({},r.shapes[c]),{handles:y(m({},(g=r.shapes[c])==null?void 0:g.handles),{[u.id]:{bindingId:void 0}})})})}}),{id:"translate",before:{document:{pages:{[n]:i},pageStates:{[n]:{selectedIds:e}}}},after:{document:{pages:{[n]:r},pageStates:{[n]:{selectedIds:e}}}}}}function cr(s,e,t,n){let{bindings:o}=s,i={},r={},d={},a={},l=e,p=e.filter(c=>!t.find(h=>h.id===c));return t.filter(c=>!c.isLocked).forEach(c=>{let h=[],u=[];i[c.id]=c,r[c.id]=void 0,c.children.forEach(S=>{p.push(S);let w=s.getShape(S,n);h.push(w)});let f=c.childIndex,b=(I.getChildIndexAbove(s.state,c.id,n)-f)/h.length;h.sort((S,w)=>S.childIndex-w.childIndex).forEach((S,w)=>{i[S.id]={parentId:S.parentId,childIndex:S.childIndex},r[S.id]={parentId:n,childIndex:f+b*w}}),o.filter(S=>S.toId===c.id||S.fromId===c.id).forEach(S=>{for(let w of[S.toId,S.fromId])if(r[w]===void 0){d[S.id]=S,a[S.id]=void 0;let v=s.getShape(w,n);v.handles&&Object.values(v.handles).filter(T=>T.bindingId===S.id).forEach(T=>{var C,R;i[w]=y(m({},i[w]),{handles:y(m({},(C=i[w])==null?void 0:C.handles),{[T.id]:{bindingId:S.id}})}),u.includes(w)||(r[w]=y(m({},r[w]),{handles:y(m({},(R=r[w])==null?void 0:R.handles),{[T.id]:{bindingId:void 0}})}))})}})}),{id:"ungroup",before:{document:{pages:{[n]:{shapes:i,bindings:d}},pageStates:{[n]:{selectedIds:l}}}},after:{document:{pages:{[n]:{shapes:r,bindings:d}},pageStates:{[n]:{selectedIds:p}}}}}}function pr(s,e,t){let n=e.map(i=>i.id),o=I.mutateShapes(s.state,n.filter(i=>!s.getShape(i,t).isLocked),(i,r)=>e[r],t);return{id:"update",before:{document:{pages:{[t]:{shapes:o.before}}}},after:{document:{pages:{[t]:{shapes:o.after}}}}}}function hr(s,e,t){let{currentPageId:n,selectedIds:o}=s,i=e.map(l=>s.getShape(l)).filter(l=>t.isLocked?!0:!l.isLocked),r={},d={},a=Object.keys(t);return i.forEach(l=>{r[l.id]=Object.fromEntries(a.map(p=>[p,l[p]])),d[l.id]=t}),{id:"set_props",before:{document:{pages:{[n]:{shapes:r}},pageStates:{[n]:{selectedIds:o}}}},after:{document:{pages:{[n]:{shapes:d}},pageStates:{[n]:{selectedIds:o}}}}}}import{Vec as ae}from"@tldraw/vec";var re=class{constructor(e){this.app=e}};import{Utils as pn}from"@tldraw/core";var Qo=class extends re{constructor(e,t,n,o=!1){super(e);this.type=H.Arrow;this.status=_.TranslatingHandle;this.newStartBindingId=pn.uniqueId();this.draggedBindingId=pn.uniqueId();this.didBind=!1;this.start=()=>{};this.update=()=>{var S,w,v;let{initialShape:e}=this,{currentPoint:t,shiftKey:n,altKey:o,metaKey:i,currentGrid:r,settings:{showGrid:d}}=this.app,a=this.app.getShape(e.id);if(a.isLocked)return;let l=a.handles,p=this.handleId;if(!l[p].canBind)return;let c=ae.sub(t,l[p].point);if(n){let T=l[p==="start"?"end":"start"].point,C=l[p].point,R=ae.toFixed(ae.sub(ae.add(C,c),a.point)),B=ae.angle(T,R),O=ae.rotWith(R,T,pn.snapAngleToSegments(B,24)-B);c=ae.add(c,ae.sub(O,R))}let h=ae.sub(ae.add(l[p].point,c),a.point),u=y(m({},l[p]),{point:d?ae.snap(h,r):ae.toFixed(h),bindingId:void 0}),f=mt[x.Arrow],g=(S=f.onHandleChange)==null?void 0:S.call(f,a,{[p]:u});if(!g)return;let b={shape:pn.deepMerge(a,g),bindings:{}};if(this.initialBinding&&(b.bindings[this.initialBinding.id]=void 0),this.startBindingShapeId){let T,C=this.app.page.shapes[this.startBindingShapeId],R=I.getShapeUtil(C);if(!i){let B=R.getCenter(C),O=b.shape.handles.start,j=ae.add(O.point,b.shape.point),E=B,De=ae.uni(ae.sub(j,E));T=this.findBindingPoint(a,C,"start",this.newStartBindingId,B,E,De,!1)}if(T){this.didBind=!0,b.bindings[this.newStartBindingId]=T,b.shape.handles=y(m({},b.shape.handles),{start:y(m({},b.shape.handles.start),{bindingId:T.id})});let B=this.app.page.shapes[this.startBindingShapeId],O=I.getShapeUtil(B),j=(v=(w=I.getShapeUtil(b.shape.type)).onBindingChange)==null?void 0:v.call(w,b.shape,T,B,O.getBounds(B),O.getCenter(B));j&&Object.assign(b.shape,j)}else this.didBind=this.didBind||!1,this.app.page.bindings[this.newStartBindingId]&&(b.bindings[this.newStartBindingId]=void 0),a.handles.start.bindingId===this.newStartBindingId&&(b.shape.handles=y(m({},b.shape.handles),{start:y(m({},b.shape.handles.start),{bindingId:void 0})}))}let P;if(!i){let T=b.shape.handles[this.handleId],C=b.shape.handles[this.handleId==="start"?"end":"start"],R=ae.add(C.point,b.shape.point),B=ae.add(T.point,b.shape.point),O=ae.uni(ae.sub(B,R)),j=this.bindableShapeIds.map(E=>this.app.page.shapes[E]);for(let E of j)if(P=this.findBindingPoint(a,E,this.handleId,this.draggedBindingId,B,R,O,o),P)break}if(P){this.didBind=!0,b.bindings[this.draggedBindingId]=P,b.shape.handles=y(m({},b.shape.handles),{[this.handleId]:y(m({},b.shape.handles[this.handleId]),{bindingId:this.draggedBindingId})});let T=this.app.page.shapes[P.toId],C=I.getShapeUtil(T),B=mt[x.Arrow].onBindingChange(b.shape,P,T,C.getBounds(T),C.getCenter(T));B&&Object.assign(b.shape,B)}else{this.didBind=this.didBind||!1;let T=a.handles[this.handleId].bindingId;T&&(b.bindings=y(m({},b.bindings),{[T]:void 0}),b.shape.handles=y(m({},b.shape.handles),{[this.handleId]:y(m({},b.shape.handles[this.handleId]),{bindingId:void 0})}))}return{document:{pages:{[this.app.currentPageId]:{shapes:{[a.id]:b.shape},bindings:b.bindings}},pageStates:{[this.app.currentPageId]:{bindingId:b.shape.handles[p].bindingId}}}}};this.cancel=()=>{let{initialShape:e,initialBinding:t,newStartBindingId:n,draggedBindingId:o}=this,i={};return i[o]=void 0,t&&(i[t.id]=t),n&&(i[n]=void 0),{document:{pages:{[this.app.currentPageId]:{shapes:{[e.id]:this.isCreate?void 0:e},bindings:i}},pageStates:{[this.app.currentPageId]:{selectedIds:this.isCreate?[]:[e.id],bindingId:void 0,hoveredId:void 0,editingId:void 0}}}}};this.complete=()=>{let{initialShape:e,initialBinding:t,newStartBindingId:n,startBindingShapeId:o,handleId:i}=this,r=I.onSessionComplete(this.app.page.shapes[e.id]),d=r.handles[i].bindingId;if(!(d||t)&&ae.dist(r.handles.start.point,r.handles.end.point)<4)return this.cancel();let a={},l={};return t&&(a[t.id]=this.isCreate?void 0:t,l[t.id]=void 0),d&&(a[d]=void 0,l[d]=this.app.page.bindings[d]),o&&(a[n]=void 0,l[n]=this.app.page.bindings[n]),{id:"arrow",before:{document:{pages:{[this.app.currentPageId]:{shapes:{[e.id]:this.isCreate?void 0:e},bindings:a}},pageStates:{[this.app.currentPageId]:{selectedIds:this.isCreate?[]:[e.id],bindingId:void 0,hoveredId:void 0,editingId:void 0}}}},after:{document:{pages:{[this.app.currentPageId]:{shapes:{[e.id]:r},bindings:l}},pageStates:{[this.app.currentPageId]:{selectedIds:[e.id],bindingId:void 0,hoveredId:void 0,editingId:void 0}}}}}};this.findBindingPoint=(e,t,n,o,i,r,d,a)=>{let p=I.getShapeUtil(t.type).getBindingPoint(t,e,i,r,d,ee,a);if(!!p)return{id:o,type:"arrow",fromId:e.id,toId:t.id,handleId:n,point:ae.toFixed(p.point),distance:p.distance}};var a;this.isCreate=o;let{currentPageId:i}=e.state.appState,r=e.state.document.pages[i];this.handleId=n,this.initialShape=r.shapes[t],this.bindableShapeIds=I.getBindableShapeIds(e.state).filter(l=>!(l===this.initialShape.id||l===this.initialShape.parentId));let{originPoint:d}=this.app;if(this.isCreate)this.startBindingShapeId=(a=this.bindableShapeIds.map(l=>r.shapes[l]).find(l=>pn.pointInBounds(d,I.getShapeUtil(l).getBounds(l))))==null?void 0:a.id;else{let l=this.initialShape.handles[this.handleId].bindingId;l?this.initialBinding=r.bindings[l]:this.initialShape.handles[this.handleId].bindingId=void 0}}};import{Utils as ur}from"@tldraw/core";var es=class extends re{constructor(e){super(e);this.type=H.Brush;this.status=_.Brushing;this.start=()=>{};this.update=()=>{let{initialSelectedIds:e,shapesToTest:t,app:{originPoint:n,currentPoint:o}}=this,i=ur.getBoundsFromPoints([n,o]),r=new Set,d=new Set(e);t.forEach(({id:c,selectId:h})=>{let{metaKey:u}=this.app,f=this.app.getShape(c);if(!r.has(h)){let g=this.app.getShapeUtil(f);(u?ur.boundsContain(i,g.getBounds(f)):g.hitTestBounds(f,i))?(r.add(h),d.has(h)||d.add(h)):d.has(h)&&d.delete(h)}});let a=this.app.selectedIds,p=d.size!==a.length||a.some(c=>!d.has(c))?Array.from(d.values()):a;return{document:{pageStates:{[this.app.currentPageId]:{brush:i,selectedIds:p}}}}};this.cancel=()=>({document:{pageStates:{[this.app.currentPageId]:{brush:null,selectedIds:Array.from(this.initialSelectedIds.values())}}}});this.complete=()=>({document:{pageStates:{[this.app.currentPageId]:{brush:null,selectedIds:[...this.app.selectedIds]}}}});let{currentPageId:t}=e;this.initialSelectedIds=new Set(this.app.selectedIds),this.shapesToTest=this.app.shapes.filter(n=>!(n.isLocked||n.isHidden||n.parentId!==t||this.initialSelectedIds.has(n.id)||this.initialSelectedIds.has(n.parentId))).map(n=>({id:n.id,bounds:this.app.getShapeUtil(n).getBounds(n),selectId:n.id}))}};import{Utils as mr}from"@tldraw/core";import{Vec as gt}from"@tldraw/vec";var ts=class extends re{constructor(e,t){super(e);this.type=H.Draw;this.status=_.Creating;this.shiftedPoints=[];this.start=()=>{};this.update=()=>{let{shapeId:e}=this,{currentPoint:t,originPoint:n,shiftKey:o}=this.app;if(!this.lockedDirection&&this.points.length>1){let p=mr.getBoundsFromPoints(this.points);(p.width>8||p.height>8)&&(this.lockedDirection=p.width>p.height?"horizontal":"vertical")}if(o){if(!this.isLocked&&this.points.length>2){if(!this.lockedDirection){let c=mr.getBoundsFromPoints(this.points);this.lockedDirection=c.width>c.height?"horizontal":"vertical"}this.isLocked=!0;let p=[...this.lastAdjustedPoint];this.lockedDirection==="vertical"?p[0]=0:p[1]=0,this.points.push(p.concat(t[2]))}}else this.isLocked&&(this.isLocked=!1);this.isLocked&&(this.lockedDirection==="vertical"?t[0]=n[0]:t[1]=n[1]);let i=gt.toFixed(gt.sub(t,n)).concat(t[2]);if(gt.isEqual(this.lastAdjustedPoint,i))return;this.points.push(i),this.lastAdjustedPoint=i;let r=[...this.topLeft],d=[Math.min(this.topLeft[0],t[0]),Math.min(this.topLeft[1],t[1])],a=gt.sub(d,n),l;return r[0]!==d[0]||r[1]!==d[1]?(this.topLeft=d,l=this.points.map(p=>gt.toFixed(gt.sub(p,a)).concat(p[2]))):l=[...this.shiftedPoints,gt.sub(i,a).concat(i[2])],this.shiftedPoints=l,{document:{pages:{[this.app.currentPageId]:{shapes:{[e]:{point:this.topLeft,points:l}}}},pageStates:{[this.app.currentPageId]:{selectedIds:[e]}}}}};this.cancel=()=>{let{shapeId:e}=this,t=this.app.currentPageId;return{document:{pages:{[t]:{shapes:{[e]:void 0}}},pageStates:{[t]:{selectedIds:[]}}}}};this.complete=()=>{let{shapeId:e}=this,t=this.app.currentPageId,n=this.app.getShape(e);return{id:"create_draw",before:{document:{pages:{[t]:{shapes:{[e]:void 0}}},pageStates:{[t]:{selectedIds:[]}}}},after:{document:{pages:{[t]:{shapes:{[e]:y(m({},n),{point:gt.toFixed(n.point),points:n.points.map(o=>gt.toFixed(o)),isComplete:!0})}}},pageStates:{[this.app.currentPageId]:{selectedIds:[]}}}}}};let{originPoint:n}=this.app;this.topLeft=[...n],this.shapeId=t,this.points=[[0,0,n[2]||.5]],this.shiftedPoints=[...this.points],this.lastAdjustedPoint=[0,0]}};import{Vec as ns}from"@tldraw/vec";var os=class extends re{constructor(e,t,n,o="move_handle"){super(e);this.type=H.Handle;this.status=_.TranslatingHandle;this.shiftKey=!1;this.start=()=>{};this.update=()=>{var u,f;let{initialShape:e,app:{currentPageId:t,currentPoint:n,shiftKey:o,altKey:i,metaKey:r}}=this,d=this.app.getShape(e.id);if(d.isLocked)return;let a=d.handles,l=this.handleId,p=ns.sub(n,a[l].point),c=y(m({},a[l]),{point:ns.sub(ns.add(a[l].point,p),d.point)}),h=(f=(u=I.getShapeUtil(d)).onHandleChange)==null?void 0:f.call(u,d,{[l]:c},{delta:p,shiftKey:o,altKey:i,metaKey:r});if(!!h)return{document:{pages:{[t]:{shapes:{[d.id]:h}}}}}};this.cancel=()=>{let{initialShape:e,app:{currentPageId:t}}=this;return{document:{pages:{[t]:{shapes:{[e.id]:e}}}}}};this.complete=()=>{let{initialShape:e,app:{currentPageId:t}}=this;return{id:this.commandId,before:{document:{pages:{[t]:{shapes:{[e.id]:e}}}}},after:{document:{pages:{[t]:{shapes:{[e.id]:I.onSessionComplete(this.app.getShape(this.initialShape.id))}}}}}}};let{originPoint:i}=e;this.topLeft=[...i],this.handleId=n,this.initialShape=this.app.getShape(t),this.commandId=o}};import{Utils as Xn}from"@tldraw/core";import{Vec as gr}from"@tldraw/vec";var ss=class extends re{constructor(e){super(e);this.type=H.Rotate;this.status=_.Transforming;this.delta=[0,0];this.changes={};this.start=()=>{};this.update=()=>{let{commonBoundsCenter:e,initialShapes:t,app:{currentPageId:n,currentPoint:o,shiftKey:i}}=this,r={},d=gr.angle(e,o)-this.initialAngle;return i&&(d=Xn.snapAngleToSegments(d,24)),t.forEach(({center:a,shape:l})=>{let{rotation:p=0}=l,c=0;i&&(c=Xn.snapAngleToSegments(p,24)-p);let h=I.getRotatedShapeMutation(l,a,e,i?d+c:d);h&&(r[l.id]=h)}),this.changes=r,{document:{pages:{[n]:{shapes:r}}}}};this.cancel=()=>{let{initialShapes:e,app:{currentPageId:t}}=this,n={};return e.forEach(({shape:o})=>n[o.id]=o),{document:{pages:{[t]:{shapes:n}}}}};this.complete=()=>{let{initialShapes:e,app:{currentPageId:t}}=this,n={},o=this.changes;return e.forEach(({shape:{id:i,point:r,rotation:d,handles:a}})=>{n[i]={point:r,rotation:d,handles:a}}),{id:"rotate",before:{document:{pages:{[t]:{shapes:n}}}},after:{document:{pages:{[t]:{shapes:o}}}}}};let{app:{currentPageId:t,pageState:n,originPoint:o}}=this,i=I.getSelectedBranchSnapshot(e.state,t).filter(r=>!r.isLocked);if(i.length===0)throw Error("No selected shapes!");if(e.rotationInfo.selectedIds===n.selectedIds){if(e.rotationInfo.center===void 0)throw Error("We should have a center for rotation!");this.commonBoundsCenter=e.rotationInfo.center}else this.commonBoundsCenter=Xn.getBoundsCenter(Xn.getCommonBounds(i.map(I.getBounds))),e.rotationInfo.selectedIds=n.selectedIds,e.rotationInfo.center=this.commonBoundsCenter;this.initialShapes=i.filter(r=>r.children===void 0).map(r=>({shape:r,center:this.app.getShapeUtil(r).getCenter(r)})),this.initialAngle=gr.angle(this.commonBoundsCenter,o)}};import{TLBoundsCorner as gl,Utils as Pe}from"@tldraw/core";import{Vec as hn}from"@tldraw/vec";var is=class extends re{constructor(e,t=gl.BottomRight,n=!1){super(e);this.transformType=t;this.isCreate=n;this.type=H.Transform;this.status=_.Transforming;this.scaleX=1;this.scaleY=1;this.snapInfo={state:"empty"};this.prevPoint=[0,0];this.speed=1;this.start=()=>{this.snapInfo={state:"ready",bounds:this.app.shapes.filter(e=>!this.initialShapeIds.includes(e.id)).map(e=>Pe.getBoundsWithCenter(I.getRotatedBounds(e)))}};this.update=()=>{let{transformType:e,shapeBounds:t,initialCommonBounds:n,isAllAspectRatioLocked:o,app:{currentPageId:i,pageState:{camera:r},viewport:d,currentPoint:a,previousPoint:l,originPoint:p,shiftKey:c,altKey:h,metaKey:u,currentGrid:f,settings:{isSnapping:g,showGrid:b}}}=this,P={},S=h?hn.mul(hn.sub(a,p),2):hn.sub(a,p),w=Pe.getTransformedBoundingBox(n,e,S,0,c||o);h&&(w=m(m({},w),Pe.centerBounds(w,Pe.getBoundsCenter(n)))),b&&(w=m(m({},w),Pe.snapBoundsToGrid(w,f)));let T=hn.dist(a,l)-this.speed;this.speed=this.speed+T*(T>1?.5:.15);let C=[];if((g&&!u||!g&&u)&&this.speed*r.zoom<Ft&&this.snapInfo.state==="ready"){let R=Pe.getSnapPoints(Pe.getBoundsWithCenter(w),this.snapInfo.bounds.filter(B=>Pe.boundsContain(d,B)||Pe.boundsCollide(d,B)),Ot/r.zoom);R&&(C=R.snapLines,w=Pe.getTransformedBoundingBox(n,e,hn.sub(S,R.offset),0,c||o))}return this.scaleX=w.scaleX,this.scaleY=w.scaleY,t.forEach(({initialShape:R,initialShapeBounds:B,transformOrigin:O})=>{let j=Pe.getRelativeTransformedBoundingBox(w,n,B,this.scaleX<0,this.scaleY<0);b&&(j=Pe.snapBoundsToGrid(j,f));let E=I.transform(this.app.getShape(R.id),j,{type:this.transformType,initialShape:R,scaleX:this.scaleX,scaleY:this.scaleY,transformOrigin:O});P[R.id]=E}),{appState:{snapLines:C},document:{pages:{[i]:{shapes:P}}}}};this.cancel=()=>{let{shapeBounds:e,app:{currentPageId:t}}=this,n={};return this.isCreate?e.forEach(o=>n[o.initialShape.id]=void 0):e.forEach(o=>n[o.initialShape.id]=o.initialShape),{appState:{snapLines:[]},document:{pages:{[t]:{shapes:n}},pageStates:{[t]:{selectedIds:this.isCreate?[]:e.map(o=>o.initialShape.id)}}}}};this.complete=()=>{let{isCreate:e,shapeBounds:t,hasUnlockedShapes:n,app:{currentPageId:o}}=this;if(!n)return;let i={},r={},d,a;return e?(d=[],a=[],t.forEach(({initialShape:l})=>{i[l.id]=void 0,r[l.id]=this.app.getShape(l.id)})):(d=this.initialSelectedIds,a=this.initialSelectedIds,t.forEach(({initialShape:l})=>{i[l.id]=l,r[l.id]=this.app.getShape(l.id)})),{id:"transform",before:{appState:{snapLines:[]},document:{pages:{[o]:{shapes:i}},pageStates:{[o]:{selectedIds:d,hoveredId:void 0,editingId:void 0}}}},after:{appState:{snapLines:[]},document:{pages:{[o]:{shapes:r}},pageStates:{[o]:{selectedIds:a,hoveredId:void 0,editingId:void 0}}}}}};this.initialSelectedIds=[...this.app.selectedIds],this.app.rotationInfo.selectedIds=[...this.initialSelectedIds],this.initialShapes=I.getSelectedBranchSnapshot(this.app.state,this.app.currentPageId).filter(d=>!d.isLocked),this.initialShapeIds=this.initialShapes.map(d=>d.id),this.hasUnlockedShapes=this.initialShapes.length>0,this.isAllAspectRatioLocked=this.initialShapes.every(d=>d.isAspectRatioLocked||I.getShapeUtil(d).isAspectRatioLocked);let o=Object.fromEntries(this.initialShapes.map(d=>[d.id,I.getBounds(d)])),i=Object.values(o);this.initialCommonBounds=Pe.getCommonBounds(i);let r=Pe.getBoundsFromPoints(i.map(Pe.getBoundsCenter));this.shapeBounds=this.initialShapes.map(d=>{let a=o[d.id],l=Pe.getBoundsCenter(a),p=(l[0]-r.minX)/r.width,c=(l[1]-r.minY)/r.height;return{initialShape:d,initialShapeBounds:a,transformOrigin:[p,c]}})}};import{Utils as st}from"@tldraw/core";import{Vec as Yt}from"@tldraw/vec";var rs=class extends re{constructor(e,t,n,o=!1){super(e);this.type=H.TransformSingle;this.status=_.Transforming;this.scaleX=1;this.scaleY=1;this.snapInfo={state:"empty"};this.prevPoint=[0,0];this.speed=1;this.start=()=>{this.snapInfo={state:"ready",bounds:this.app.shapes.filter(e=>e.id!==this.initialShape.id).map(e=>st.getBoundsWithCenter(I.getRotatedBounds(e)))}};this.update=()=>{let{transformType:e,initialShape:t,initialShapeBounds:n,app:{settings:{isSnapping:o,showGrid:i},currentPageId:r,pageState:{camera:d},viewport:a,currentPoint:l,previousPoint:p,originPoint:c,currentGrid:h,shiftKey:u,altKey:f,metaKey:g}}=this;if(t.isLocked)return;let b={},P=f?Yt.mul(Yt.sub(l,c),2):Yt.sub(l,c),S=this.app.getShape(t.id),w=I.getShapeUtil(S),v=st.getTransformedBoundingBox(n,e,P,S.rotation,u||S.isAspectRatioLocked||w.isAspectRatioLocked);f&&(v=m(m({},v),st.centerBounds(v,st.getBoundsCenter(n)))),i&&(v=m(m({},v),st.snapBoundsToGrid(v,h)));let C=Yt.dist(l,p)-this.speed;this.speed=this.speed+C*(C>1?.5:.15);let R=[];if((o&&!g||!o&&g)&&!t.rotation&&this.speed*d.zoom<Ft&&this.snapInfo.state==="ready"){let O=st.getSnapPoints(st.getBoundsWithCenter(v),this.snapInfo.bounds.filter(j=>st.boundsContain(a,j)||st.boundsCollide(a,j)),Ot/d.zoom);O&&(R=O.snapLines,v=st.getTransformedBoundingBox(n,e,Yt.sub(P,O.offset),S.rotation,u||S.isAspectRatioLocked||w.isAspectRatioLocked))}let B=I.getShapeUtil(S).transformSingle(S,v,{initialShape:t,type:this.transformType,scaleX:v.scaleX,scaleY:v.scaleY,transformOrigin:[.5,.5]});return B&&(b[S.id]=B),i&&B&&B.point&&(B.point=Yt.snap(B.point,h)),{appState:{snapLines:R},document:{pages:{[r]:{shapes:b}}}}};this.cancel=()=>{let{initialShape:e,app:{currentPageId:t}}=this,n={};return this.isCreate?n[e.id]=void 0:n[e.id]=e,{appState:{snapLines:[]},document:{pages:{[t]:{shapes:n}},pageStates:{[t]:{selectedIds:this.isCreate?[]:[e.id]}}}}};this.complete=()=>{let{initialShape:e,app:{currentPageId:t}}=this;if(e.isLocked)return;let n={},o={};return n[e.id]=this.isCreate?void 0:e,o[e.id]=I.onSessionComplete(this.app.getShape(e.id)),{id:"transform_single",before:{appState:{snapLines:[]},document:{pages:{[t]:{shapes:n}},pageStates:{[t]:{selectedIds:this.isCreate?[]:[e.id],editingId:void 0,hoveredId:void 0}}}},after:{appState:{snapLines:[]},document:{pages:{[t]:{shapes:o}},pageStates:{[t]:{selectedIds:[e.id],editingId:void 0,hoveredId:void 0}}}}}};this.isCreate=o,this.transformType=n;let i=this.app.getShape(t);this.initialShape=i,this.initialShapeBounds=I.getBounds(i),this.initialCommonBounds=I.getRotatedBounds(i),this.app.rotationInfo.selectedIds=[i.id]}};import{Utils as Ue}from"@tldraw/core";import{Vec as se}from"@tldraw/vec";var as=class extends re{constructor(e,t=!1,n=!1){super(e);this.type=H.Translate;this.status=_.Translating;this.delta=[0,0];this.prev=[0,0];this.prevPoint=[0,0];this.speed=1;this.cloneInfo={state:"empty"};this.snapInfo={state:"empty"};this.snapLines=[];this.isCloning=!1;this.start=()=>{let{bindingsToDelete:e,initialIds:t,app:{currentPageId:n,page:o}}=this,i=[],r=[];if(Object.values(o.shapes).forEach(a=>{let l=Ue.getBoundsWithCenter(I.getRotatedBounds(a));i.push(l),t.has(a.id)||r.push(l)}),this.snapInfo={state:"ready",bounds:i,others:r},e.length===0)return;let d={};return e.forEach(a=>d[a.id]=void 0),{document:{pages:{[n]:{bindings:d}}}}};this.update=()=>{let{initialParentChildren:e,initialShapes:t,initialCommonBounds:n,bindingsToDelete:o,app:{pageState:{camera:i},settings:{isSnapping:r,showGrid:d},currentPageId:a,viewport:l,selectedIds:p,currentPoint:c,previousPoint:h,originPoint:u,altKey:f,shiftKey:g,metaKey:b,currentGrid:P}}=this,S={},w={},v={},T=se.sub(c,u),C=!1;this.isCreate||(f&&!this.isCloning?(this.isCloning=!0,C=!0):!f&&this.isCloning&&(this.isCloning=!1,C=!0)),g&&(Math.abs(T[0])<Math.abs(T[1])?T[0]=0:T[1]=0);let B=se.dist(c,h)-this.speed;if(this.speed=this.speed+B*(B>1?.5:.15),this.snapLines=[],(r&&!b||!r&&b)&&this.speed*i.zoom<Ft&&this.snapInfo.state==="ready"){let O=Ue.getSnapPoints(Ue.getBoundsWithCenter(d?Ue.snapBoundsToGrid(Ue.translateBounds(n,T),P):Ue.translateBounds(n,T)),(this.isCloning?this.snapInfo.bounds:this.snapInfo.others).filter(j=>Ue.boundsContain(l,j)||Ue.boundsCollide(l,j)),Ot/i.zoom);O&&(this.snapLines=O.snapLines,T=se.sub(T,O.offset))}if(this.prev=T,this.isCloning)if(C){if(this.cloneInfo.state==="empty"&&this.createCloneInfo(),this.cloneInfo.state==="empty")throw Error;let{clones:O,clonedBindings:j}=this.cloneInfo;this.isCloning=!0,o.forEach(E=>S[E.id]=E),t.forEach(E=>w[E.id]={point:E.point}),O.forEach(E=>{var De;if(w[E.id]=m({},E),E.parentId!==a&&!p.includes(E.parentId)){let et=((De=w[E.parentId])==null?void 0:De.children)||e[E.parentId];et.includes(E.id)||(w[E.parentId]=y(m({},w[E.parentId]),{children:[...et,E.id]}))}});for(let E of j)S[E.id]=E;v.selectedIds=O.map(E=>E.id),O.forEach(E=>{w[E.id]=y(m({},E),{point:d?se.snap(se.toFixed(se.add(E.point,T)),P):se.toFixed(se.add(E.point,T))})})}else{if(this.cloneInfo.state==="empty")throw Error;let{clones:O}=this.cloneInfo;O.forEach(j=>{w[j.id]={point:d?se.snap(se.toFixed(se.add(j.point,T)),P):se.toFixed(se.add(j.point,T))}})}else if(C){if(this.cloneInfo.state==="empty")throw Error;let{clones:O,clonedBindings:j}=this.cloneInfo;this.isCloning=!1,o.forEach(E=>S[E.id]=void 0),O.forEach(E=>{E.parentId!==a&&(w[E.parentId]=y(m({},w[E.parentId]),{children:e[E.parentId]}))}),O.forEach(E=>w[E.id]=void 0),t.forEach(E=>{w[E.id]={point:d?se.snap(se.toFixed(se.add(E.point,T)),P):se.toFixed(se.add(E.point,T))}});for(let E of j)S[E.id]=void 0;v.selectedIds=t.map(E=>E.id)}else t.forEach(O=>{w[O.id]={point:d?se.snap(se.toFixed(se.add(O.point,T)),P):se.toFixed(se.add(O.point,T))}});return{appState:{snapLines:this.snapLines},document:{pages:{[a]:{shapes:w,bindings:S}},pageStates:{[a]:v}}}};this.cancel=()=>{let{initialShapes:e,initialSelectedIds:t,bindingsToDelete:n,app:{currentPageId:o}}=this,i={},r={},d={editingId:void 0,hoveredId:void 0};if(n.forEach(a=>i[a.id]=a),this.isCreate?(e.forEach(({id:a})=>r[a]=void 0),d.selectedIds=[]):(e.forEach(({id:a,point:l})=>r[a]=y(m({},r[a]),{point:l})),d.selectedIds=t),this.cloneInfo.state==="ready"){let{clones:a,clonedBindings:l}=this.cloneInfo;a.forEach(p=>r[p.id]=void 0),l.forEach(p=>i[p.id]=void 0)}return{appState:{snapLines:[]},document:{pages:{[o]:{shapes:r,bindings:i}},pageStates:{[o]:d}}}};this.complete=()=>{let{initialShapes:e,initialParentChildren:t,bindingsToDelete:n,app:{currentPageId:o}}=this,i={},r={},d={},a={};if(this.isCloning){if(this.cloneInfo.state==="empty"&&this.createCloneInfo(),this.cloneInfo.state!=="ready")throw Error;let{clones:l,clonedBindings:p}=this.cloneInfo;l.forEach(c=>{r[c.id]=void 0,a[c.id]=this.app.getShape(c.id),c.parentId!==o&&(r[c.parentId]=y(m({},r[c.parentId]),{children:t[c.parentId]}),a[c.parentId]=y(m({},a[c.parentId]),{children:this.app.getShape(c.parentId).children}))}),p.forEach(c=>{i[c.id]=void 0,d[c.id]=this.app.getBinding(c.id)})}else e.forEach(l=>{r[l.id]=this.isCreate?void 0:y(m({},r[l.id]),{point:l.point}),a[l.id]=m(m({},a[l.id]),this.isCreate?this.app.getShape(l.id):{point:this.app.getShape(l.id).point})});return n.forEach(l=>{i[l.id]=l;for(let p of[l.toId,l.fromId]){let c=this.app.getShape(p);!c.handles||Object.values(c.handles).filter(h=>h.bindingId===l.id).forEach(h=>{r[p]=y(m({},r[p]),{handles:{}}),a[p]=y(m({},a[p]),{handles:{}}),r[p].handles[h.id]={bindingId:l.id},a[p].handles[h.id]={bindingId:void 0}})}}),{id:"translate",before:{appState:{snapLines:[]},document:{pages:{[o]:{shapes:r,bindings:i}},pageStates:{[o]:{selectedIds:this.isCreate?[]:[...this.initialSelectedIds]}}}},after:{appState:{snapLines:[]},document:{pages:{[o]:{shapes:a,bindings:d}},pageStates:{[o]:{selectedIds:[...this.app.selectedIds]}}}}}};this.createCloneInfo=()=>{let{initialShapes:e,initialParentChildren:t,app:{selectedIds:n,currentPageId:o,page:i}}=this,r={},d={},a=[],l=[];e.forEach(c=>{let h=Ue.uniqueId();t[h]=t[c.id],r[c.id]=h;let u=y(m({},Ue.deepClone(c)),{id:h,parentId:c.parentId,childIndex:I.getChildIndexAbove(this.app.state,c.id,o)});l.push(u)}),l.forEach(c=>{c.children!==void 0&&(c.children=c.children.map(h=>r[h]))}),l.forEach(c=>{n.includes(c.parentId)&&(c.parentId=r[c.parentId])});let p=new Set(Object.keys(r));Object.values(i.bindings).filter(c=>p.has(c.fromId)||p.has(c.toId)).forEach(c=>{if(p.has(c.fromId)&&p.has(c.toId)){let h=Ue.uniqueId(),u=y(m({},Ue.deepClone(c)),{id:h,fromId:r[c.fromId]||c.fromId,toId:r[c.toId]||c.toId});d[c.id]=h,a.push(u)}}),l.forEach(c=>{if(c.handles&&c.handles)for(let h in c.handles){let u=c.handles[h];u.bindingId=u.bindingId?d[u.bindingId]:void 0}}),l.forEach(c=>{if(i.shapes[c.id])throw Error("uh oh, we didn't clone correctly")}),this.cloneInfo={state:"ready",clones:l,cloneMap:r,clonedBindings:a}};this.isCreate=t,this.link=n;let{currentPageId:o,selectedIds:i,page:r}=this.app;this.initialSelectedIds=[...i];let d=(n?I.getLinkedShapeIds(this.app.state,o,n,!1):i).map(l=>this.app.getShape(l)).filter(l=>!l.isLocked),a=new Set(d.map(l=>l.id));this.hasUnlockedShapes=d.length>0,this.initialShapes=Array.from(new Set(d.filter(l=>!a.has(l.parentId)).flatMap(l=>l.children?[l,...l.children.map(p=>this.app.getShape(p))]:[l])).values()),this.initialIds=new Set(this.initialShapes.map(l=>l.id)),this.bindingsToDelete=[],Object.values(r.bindings).filter(l=>this.initialIds.has(l.fromId)||this.initialIds.has(l.toId)).forEach(l=>{this.initialIds.has(l.fromId)&&(this.initialIds.has(l.toId)||this.bindingsToDelete.push(l))}),this.initialParentChildren={},this.initialShapes.map(l=>l.parentId).filter(l=>l!==r.id).forEach(l=>{this.initialParentChildren[l]=this.app.getShape(l).children}),this.initialCommonBounds=Ue.getCommonBounds(this.initialShapes.map(I.getRotatedBounds)),this.app.rotationInfo.selectedIds=[...this.app.selectedIds]}};import{Vec as un}from"@tldraw/vec";var ds=class extends re{constructor(e){super(e);this.type=H.Draw;this.status=_.Creating;this.erasedShapes=new Set;this.erasedBindings=new Set;this.start=()=>{};this.update=()=>{let{page:e,shiftKey:t,originPoint:n,currentPoint:o}=this.app;if(t){if(!this.isLocked&&un.dist(n,o)>4){if(!this.lockedDirection){let a=un.sub(o,n);this.lockedDirection=a[0]>a[1]?"horizontal":"vertical"}this.isLocked=!0}}else this.isLocked&&(this.isLocked=!1);this.isLocked&&(this.lockedDirection==="vertical"?o[0]=n[0]:o[1]=n[1]);let i=un.toFixed(un.add(n,un.sub(o,n))),r=new Set([]);for(let a of this.erasableShapes)if(!this.erasedShapes.has(a)&&this.app.getShapeUtil(a).hitTestLineSegment(a,this.prevPoint,i)&&(this.erasedShapes.add(a),r.add(a.id),a.children!==void 0))for(let l of a.children)this.erasedShapes.add(this.app.getShape(l)),r.add(l);Object.values(e.bindings).forEach(a=>{for(let l of[a.toId,a.fromId])r.has(l)&&this.erasedBindings.add(a)});let d=Array.from(this.erasedShapes.values());return this.prevPoint=i,{document:{pages:{[e.id]:{shapes:Object.fromEntries(d.map(a=>[a.id,{isGhost:!0}]))}}}}};this.cancel=()=>{let{page:e}=this.app,t=Array.from(this.erasedShapes.values());return{document:{pages:{[e.id]:{shapes:Object.fromEntries(t.map(n=>[n.id,{isGhost:!1}]))}},pageStates:{[e.id]:{selectedIds:this.initialSelectedShapes.map(n=>n.id)}}}}};this.complete=()=>{let{page:e}=this.app,t=Array.from(this.erasedShapes.values()),n=Array.from(this.erasedBindings.values()),o=t.map(a=>a.id),i=n.map(a=>a.id),r={shapes:Object.fromEntries(t.map(a=>[a.id,a])),bindings:Object.fromEntries(n.map(a=>[a.id,a]))},d={shapes:Object.fromEntries(t.map(a=>[a.id,void 0])),bindings:Object.fromEntries(n.map(a=>[a.id,void 0]))};return this.app.shapes.forEach(a=>{a.handles&&!d.shapes[a.id]&&Object.values(a.handles).forEach(l=>{var p,c;l.bindingId&&i.includes(l.bindingId)&&(r.shapes[a.id]=y(m({},r.shapes[a.id]),{handles:y(m({},(p=r.shapes[a.id])==null?void 0:p.handles),{[l.id]:l})}),o.includes(a.id)||(d.shapes[a.id]=y(m({},d.shapes[a.id]),{handles:y(m({},(c=d.shapes[a.id])==null?void 0:c.handles),{[l.id]:y(m({},l),{bindingId:void 0})})})))})}),{id:"erase",before:{document:{pages:{[e.id]:r},pageStates:{[e.id]:{selectedIds:this.initialSelectedShapes.map(a=>a.id)}}}},after:{document:{pages:{[e.id]:d},pageStates:{[e.id]:{selectedIds:this.initialSelectedShapes.filter(a=>!o.includes(a.id)).map(a=>a.id)}}}}}};this.prevPoint=[...e.originPoint],this.initialSelectedShapes=this.app.selectedIds.map(t=>this.app.getShape(t)),this.erasableShapes=this.app.shapes.filter(t=>!t.isLocked)}};import{Utils as fr}from"@tldraw/core";import{Vec as Sr}from"@tldraw/vec";var ls=class extends re{constructor(e,t){super(e);this.type=H.Grid;this.status=_.Translating;this.grid={};this.columns=1;this.rows=1;this.isCopying=!1;this.start=()=>{};this.update=()=>{let{currentPageId:e,altKey:t,shiftKey:n,currentPoint:o}=this.app,i={},r={},d=fr.getBoundsCenter(this.bounds),a=Sr.sub(o,d);n&&(Math.abs(a[0])<Math.abs(a[1])?a[0]=0:a[1]=0);let l=this.bounds.width+32,p=this.bounds.height+32,c=Math.ceil(a[0]/l),h=Math.ceil(a[1]/p),u=Math.min(c,0),f=Math.min(h,0),g=Math.max(c,1),b=Math.max(h,1),P=new Set,S=t;S!==this.isCopying&&(Object.values(this.grid).filter(w=>w!==this.shape.id).forEach(w=>i[w]=void 0),this.grid={"0_0":this.shape.id},this.isCopying=S);for(let w=u;w<g;w++)for(let v=f;v<b;v++){let T=`${w}_${v}`;if(P.add(T),this.grid[T]||w===0&&v===0)continue;let C=this.getClone(Sr.add(this.shape.point,[w*l,v*p]),S);i[C.id]=C,this.grid[T]=C.id}if(Object.entries(this.grid).forEach(([w,v])=>{P.has(w)||(i[v]=void 0,delete this.grid[w])}),Object.values(i).length!==0)return this.initialSiblings&&(i[this.shape.parentId]={children:[...this.initialSiblings,...Object.values(this.grid)]}),{document:{pages:{[e]:{shapes:i}},pageStates:{[e]:r}}}};this.cancel=()=>{let{currentPageId:e}=this.app,t={};return Object.values(this.grid).forEach(n=>{t[n]=void 0}),t[this.shape.id]=y(m({},t[this.shape.id]),{point:this.shape.point}),this.initialSiblings&&(t[this.shape.parentId]={children:[...this.initialSiblings,this.shape.id]}),{document:{pages:{[e]:{shapes:t}},pageStates:{[e]:{selectedIds:[this.shape.id]}}}}};this.complete=()=>{let{currentPageId:e}=this.app,t={},n={},o=[];if(Object.values(this.grid).forEach(i=>{t[i]=void 0,n[i]=this.app.getShape(i),o.push(i)}),t[this.shape.id]=this.shape,this.initialSiblings&&(t[this.shape.parentId]={children:[...this.initialSiblings,this.shape.id]},n[this.shape.parentId]={children:[...this.initialSiblings,...Object.values(this.grid)]}),o.length!==1)return{id:"grid",before:{document:{pages:{[e]:{shapes:t}},pageStates:{[e]:{selectedIds:[],hoveredId:void 0}}}},after:{document:{pages:{[e]:{shapes:n}},pageStates:{[e]:{selectedIds:o,hoveredId:void 0}}}}}};this.getClone=(e,t)=>{let n=y(m({},this.shape),{id:fr.uniqueId(),point:e});return t||n.type===x.Sticky&&(n.text=""),n};var n;this.shape=this.app.getShape(t),this.grid["0_0"]=this.shape.id,this.bounds=this.app.getShapeBounds(t),this.initialSelectedIds=[...this.app.selectedIds],this.shape.parentId!==this.app.currentPageId&&(this.initialSiblings=(n=this.app.getShape(this.shape.parentId).children)==null?void 0:n.filter(o=>o!==this.shape.id))}};var fl={[H.Arrow]:Qo,[H.Brush]:es,[H.Draw]:ts,[H.Erase]:ds,[H.Handle]:os,[H.Rotate]:ss,[H.Transform]:is,[H.TransformSingle]:rs,[H.Translate]:as,[H.Grid]:ls},Tr=s=>fl[s];import{Utils as mn}from"@tldraw/core";import{Utils as Sl}from"@tldraw/core";var $;(function(n){n.Idle="idle",n.Creating="creating",n.Pinching="pinching"})($||($={}));var ue=class extends ho{constructor(e){super();this.app=e;this.type="select";this.status=$.Idle;this.setStatus=e=>{this.status=e,this.app.setStatus(this.status)};this.onEnter=()=>{this.setStatus($.Idle)};this.onExit=()=>{this.setStatus($.Idle)};this.onCancel=()=>{this.status===$.Idle?this.app.selectTool("select"):this.setStatus($.Idle),this.app.cancelSession()};this.getNextChildIndex=()=>{let{shapes:e,appState:{currentPageId:t}}=this.app;return e.length===0?1:e.filter(n=>n.parentId===t).sort((n,o)=>o.childIndex-n.childIndex)[0].childIndex+1};this.onPinchStart=()=>{this.app.cancelSession(),this.setStatus($.Pinching)};this.onPinchEnd=()=>{Sl.isMobileSafari()&&this.app.undoSelect(),this.setStatus($.Idle)};this.onPinch=(e,t)=>{var n;this.status==="pinching"&&(this.app.pinchZoom(e.point,e.delta,e.delta[2]),(n=this.onPointerMove)==null||n.call(this,e,t))};this.onKeyDown=e=>{if(e==="Escape"){this.onCancel();return}if(e==="Meta"||e==="Control"||e==="Alt"){this.app.updateSession();return}};this.onKeyUp=e=>{if(e==="Meta"||e==="Control"||e==="Alt"){this.app.updateSession();return}};this.onPointerMove=()=>{this.status===$.Creating&&this.app.updateSession()};this.onPointerUp=()=>{if(this.status===$.Creating){this.app.completeSession();let{isToolLocked:e}=this.app.appState;e||this.app.selectTool("select")}this.setStatus($.Idle)}}};import ft from"@tldraw/vec";var F;(function(S){S.Idle="idle",S.Creating="creating",S.Pinching="pinching",S.PointingCanvas="pointingCanvas",S.PointingHandle="pointingHandle",S.PointingBounds="pointingBounds",S.PointingClone="pointingClone",S.TranslatingClone="translatingClone",S.PointingBoundsHandle="pointingBoundsHandle",S.TranslatingHandle="translatingHandle",S.Translating="translating",S.Transforming="transforming",S.Rotating="rotating",S.Brushing="brushing",S.GridCloning="gridCloning",S.ClonePainting="clonePainting",S.SpacePanning="spacePanning",S.MiddleWheelPanning="middleWheelPanning"})(F||(F={}));var gn=class extends ue{constructor(){super(...arguments);this.type="select";this.onEnter=()=>{this.setStatus(F.Idle)};this.onExit=()=>{this.setStatus(F.Idle)};this.clonePaint=e=>{if(this.app.selectedIds.length===0)return;let t=this.app.selectedIds.map(l=>this.app.getShape(l)),n=mn.expandBounds(mn.getCommonBounds(t.map(I.getBounds)),16),o=mn.getBoundsCenter(n),i=[n.width,n.height],r=[o[0]+i[0]*Math.floor((e[0]+i[0]/2-o[0])/i[0]),o[1]+i[1]*Math.floor((e[1]+i[1]/2-o[1])/i[1])],d=mn.centerBounds(n,r);this.app.shapes.some(l=>I.getShapeUtil(l).hitTestBounds(l,d))||this.app.duplicate(this.app.selectedIds,r)};this.getShapeClone=(e,t)=>{let n=this.app.getShape(e),o=I.getShapeUtil(n);if(o.canClone){let i=o.getBounds(n),r=o.getCenter(n),d={top:[i.minX,i.minY-(i.height+Fe)],right:[i.maxX+Fe,i.minY],bottom:[i.minX,i.maxY+Fe],left:[i.minX-(i.width+Fe),i.minY],topLeft:[i.minX-(i.width+Fe),i.minY-(i.height+Fe)],topRight:[i.maxX+Fe,i.minY-(i.height+Fe)],bottomLeft:[i.minX-(i.width+Fe),i.maxY+Fe],bottomRight:[i.maxX+Fe,i.maxY+Fe]}[t];if(n.rotation!==0){let p=ft.add(d,[i.width/2,i.height/2]),c=ft.rotWith(p,r,n.rotation||0);d=ft.sub(c,[i.width/2,i.height/2])}let a=mn.uniqueId(),l=y(m({},n),{id:a,point:d});return l.type===x.Sticky&&(l.text=""),l}};this.onCancel=()=>{this.selectNone(),this.app.cancelSession(),this.setStatus(F.Idle)};this.onKeyDown=e=>{if(e==="Escape"){this.onCancel();return}if(e===" "&&this.status===F.Idle&&this.setStatus(F.SpacePanning),e==="Tab"){if(this.status===F.Idle&&this.app.selectedIds.length===1){let[t]=this.app.selectedIds,n=this.getShapeClone(t,"right");n&&(this.app.createShapes(n),this.setStatus(F.Idle),n.type===x.Sticky&&(this.app.select(n.id),this.app.setEditingId(n.id)))}return}if(e==="Meta"||e==="Control"||e==="Alt"){this.app.updateSession();return}};this.onKeyUp=(e,t)=>{if(this.status===F.ClonePainting&&!(t.altKey&&t.shiftKey)){this.setStatus(F.Idle);return}if(this.status===F.SpacePanning&&e===" "){this.setStatus(F.Idle);return}if(e==="Meta"||e==="Control"||e==="Alt"){this.app.updateSession();return}};this.onPointerMove=(e,t)=>{var i,r;let{originPoint:n,currentPoint:o}=this.app;if(this.status===F.SpacePanning&&t.buttons===1||this.status===F.MiddleWheelPanning&&t.buttons===4){(r=(i=this.app).onPan)==null||r.call(i,y(m({},e),{delta:ft.neg(e.delta)}),t);return}if(this.status===F.PointingBoundsHandle){if(!this.pointedBoundsHandle)throw Error("No pointed bounds handle");if(ft.dist(n,o)>It){if(this.pointedBoundsHandle==="rotate")this.setStatus(F.Rotating),this.app.startSession(H.Rotate);else if(this.pointedBoundsHandle==="center"||this.pointedBoundsHandle==="left"||this.pointedBoundsHandle==="right")this.setStatus(F.Translating),this.app.startSession(H.Translate,!1,this.pointedBoundsHandle);else{this.setStatus(F.Transforming);let d=this.app.selectedIds.flatMap(a=>I.getDocumentBranch(this.app.state,a,this.app.currentPageId));d.length===1?this.app.startSession(H.TransformSingle,d[0],this.pointedBoundsHandle):this.app.startSession(H.Transform,this.pointedBoundsHandle)}this.app.updateSession()}return}if(this.status===F.PointingCanvas){ft.dist(n,o)>It&&(this.app.startSession(H.Brush),this.setStatus(F.Brushing));return}if(this.status===F.PointingClone){ft.dist(n,o)>It&&(this.setStatus(F.TranslatingClone),this.app.startSession(H.Translate),this.app.updateSession());return}if(this.status===F.PointingBounds){ft.dist(n,o)>It&&(this.setStatus(F.Translating),this.app.startSession(H.Translate),this.app.updateSession());return}if(this.status===F.PointingHandle){if(!this.pointedHandleId)throw Error("No pointed handle");if(ft.dist(n,o)>It){this.setStatus(F.TranslatingHandle);let d=this.app.getShape(this.app.selectedIds[0]);if(!d)return;this.pointedHandleId==="bend"?(this.app.startSession(H.Handle,d.id,this.pointedHandleId),this.app.updateSession()):(this.app.startSession(H.Arrow,d.id,this.pointedHandleId,!1),this.app.updateSession())}return}if(this.app.session)return this.app.updateSession();this.status===F.ClonePainting&&this.clonePaint(o)};this.onPointerDown=(e,t)=>{if(t.buttons===4&&this.setStatus(F.MiddleWheelPanning),e.target==="canvas"&&this.status===F.Idle){let{currentPoint:n}=this.app;if(e.spaceKey&&t.buttons===1)return;if(this.status===F.Idle&&e.altKey&&e.shiftKey){this.setStatus(F.ClonePainting),this.clonePaint(n);return}if(!e.shiftKey){if(this.app.onShapeBlur(),e.altKey&&this.app.selectedIds.length>0){this.app.duplicate(this.app.selectedIds,n);return}this.selectNone()}this.setStatus(F.PointingCanvas)}};this.onPointerUp=(e,t)=>{if(this.status===F.MiddleWheelPanning){this.setStatus(F.Idle);return}if(this.status===F.TranslatingClone||this.status===F.PointingClone){this.pointedId&&(this.app.completeSession(),this.app.setEditingId(this.pointedId)),this.setStatus(F.Idle),this.pointedId=void 0;return}if(this.status===F.PointingBounds){if(e.target==="bounds")this.selectNone();else if(this.app.isSelected(e.target))e.shiftKey?this.pointedId!==e.target&&this.deselect(e.target):this.pointedId!==e.target&&this.app.selectedIds.length>1&&this.select(e.target);else if(this.pointedId===e.target){if(this.app.getShape(e.target).isLocked)return;e.shiftKey?this.pushSelect(e.target):this.select(e.target)}}this.app.completeSession(),this.setStatus(F.Idle),this.pointedBoundsHandle=void 0,this.pointedHandleId=void 0,this.pointedId=void 0};this.onDoubleClickCanvas=()=>{};this.onPointShape=(e,t)=>{if(e.spaceKey&&t.buttons===1||this.app.getShape(e.target).isLocked)return;let{editingId:n,hoveredId:o}=this.app.pageState;if(n&&e.target!==n&&this.app.onShapeBlur(),(this.status===F.Idle||this.status===F.PointingBounds)&&e.metaKey&&e.shiftKey&&o){this.pointedId=o,this.app.isSelected(o)?this.deselect(o):(this.pushSelect(o),this.setStatus(F.PointingBounds));return}if(this.status===F.PointingBounds){let{parentId:i}=this.app.getShape(e.target);this.pointedId=i===this.app.currentPageId?e.target:i;return}if(this.status===F.Idle){if(this.setStatus(F.PointingBounds),e.metaKey){e.shiftKey||this.selectNone(),this.app.startSession(H.Brush),this.setStatus(F.Brushing);return}let i,{parentId:r}=this.app.getShape(e.target);r===this.app.currentPageId?(i=e.target,this.selectedGroupId=void 0):r===this.selectedGroupId?i=e.target:(i=r,this.selectedGroupId=void 0),this.app.isSelected(i)||(this.pointedId=i,e.shiftKey?this.pushSelect(i):this.select(i))}};this.onDoubleClickShape=e=>{let t=this.app.getShape(e.target);if(t.isLocked){this.app.select(e.target);return}I.getShapeUtil(t.type).canEdit&&(t.parentId===this.app.currentPageId||t.parentId===this.selectedGroupId)&&this.app.setEditingId(e.target),t.parentId!==this.app.currentPageId&&(this.selectedGroupId=t.parentId),this.app.select(e.target)};this.onRightPointShape=e=>{this.app.isSelected(e.target)||this.app.select(e.target)};this.onHoverShape=e=>{this.app.setHoveredId(e.target)};this.onUnhoverShape=e=>{let{currentPageId:t}=this.app;requestAnimationFrame(()=>{t===this.app.currentPageId&&this.app.pageState.hoveredId===e.target&&this.app.setHoveredId(void 0)})};this.onPointBounds=e=>{if(e.metaKey){e.shiftKey||this.selectNone(),this.app.startSession(H.Brush),this.setStatus(F.Brushing);return}this.setStatus(F.PointingBounds)};this.onRightPointBounds=(e,t)=>{t.stopPropagation()};this.onReleaseBounds=()=>{(this.status===F.Translating||this.status===F.Brushing)&&this.app.completeSession(),this.setStatus(F.Idle)};this.onPointBoundsHandle=e=>{this.pointedBoundsHandle=e.target,this.setStatus(F.PointingBoundsHandle)};this.onDoubleClickBoundsHandle=e=>{(e.target==="center"||e.target==="left"||e.target==="right")&&this.app.select(...I.getLinkedShapeIds(this.app.state,this.app.currentPageId,e.target,e.shiftKey)),this.app.selectedIds.length===1&&this.app.resetBounds(this.app.selectedIds)};this.onReleaseBoundsHandle=()=>{this.setStatus(F.Idle)};this.onPointHandle=e=>{this.pointedHandleId=e.target,this.setStatus(F.PointingHandle)};this.onDoubleClickHandle=e=>{this.app.toggleDecoration(e.target)};this.onReleaseHandle=()=>{this.setStatus(F.Idle)};this.onShapeClone=e=>{let t=this.app.selectedIds[0],n=this.getShapeClone(t,e.target);e.target==="left"||e.target==="right"||e.target==="top"||e.target==="bottom"?n&&(this.app.createShapes(n),this.pointedId=n.id,this.setStatus(F.PointingClone)):(this.setStatus(F.GridCloning),this.app.startSession(H.Grid,t))}}deselect(e){this.app.select(...this.app.selectedIds.filter(t=>t!==e))}select(e){this.app.select(e)}pushSelect(e){let t=this.app.getShape(e);this.app.select(...this.app.selectedIds.filter(n=>n!==t.parentId),e)}selectNone(){this.app.selectNone()}};import Tl from"@tldraw/vec";var ze;(function(n){n.Idle="idle",n.Pointing="pointing",n.Erasing="erasing"})(ze||(ze={}));var fn=class extends ue{constructor(){super(...arguments);this.type="erase";this.status=ze.Idle;this.onPointerDown=()=>{this.status===ze.Idle&&this.setStatus(ze.Pointing)};this.onPointerMove=e=>{switch(this.status){case ze.Pointing:{Tl.dist(e.origin,e.point)>It&&(this.app.startSession(H.Erase),this.app.updateSession(),this.setStatus(ze.Erasing));break}case ze.Erasing:this.app.updateSession()}};this.onPointerUp=()=>{switch(this.status){case ze.Pointing:{let e=this.app.shapes.filter(t=>!t.isLocked).filter(t=>this.app.getShapeUtil(t).hitTestPoint(t,this.app.currentPoint)).flatMap(t=>t.children?[t.id,...t.children]:t.id);this.app.delete(e);break}case ze.Erasing:this.app.completeSession()}this.setStatus(ze.Idle)};this.onCancel=()=>{this.status===ze.Idle?this.previous?this.app.selectTool(this.previous):this.app.selectTool("select"):this.setStatus(ze.Idle),this.app.cancelSession()}}};import yl from"@tldraw/vec";var Sn=class extends ue{constructor(){super(...arguments);this.type=x.Text;this.stopEditingShape=()=>{this.setStatus($.Idle),this.app.appState.isToolLocked||this.app.selectTool("select")};this.onKeyUp=()=>{};this.onKeyDown=()=>{};this.onPointerDown=()=>{if(this.status===$.Creating){this.stopEditingShape();return}if(this.status===$.Idle){let{currentPoint:e,currentGrid:t,settings:{showGrid:n}}=this.app;this.app.createTextShapeAtPoint(n?yl.snap(e,t):e),this.setStatus($.Creating);return}};this.onPointerUp=()=>{};this.onPointShape=e=>{let t=this.app.getShape(e.target);t.type===x.Text&&(this.setStatus($.Idle),this.app.setEditingId(t.id))};this.onShapeBlur=()=>{this.stopEditingShape()}}};import{Utils as bl}from"@tldraw/core";var Tn=class extends ue{constructor(){super(...arguments);this.type=x.Draw;this.onPointerDown=e=>{if(this.status!==$.Idle)return;let{currentPoint:t,appState:{currentPageId:n,currentStyle:o}}=this.app,i=this.getNextChildIndex(),r=bl.uniqueId(),d=Wo.create({id:r,parentId:n,childIndex:i,point:[...t,e.pressure||.5],style:m({},o)});this.app.patchCreate([d]),this.app.startSession(H.Draw,r),this.setStatus($.Creating)};this.onPointerMove=()=>{this.status===$.Creating&&this.app.updateSession()};this.onPointerUp=()=>{this.status===$.Creating&&this.app.completeSession(),this.setStatus($.Idle)}}};import{Utils as Il,TLBoundsCorner as wl}from"@tldraw/core";import xl from"@tldraw/vec";var yn=class extends ue{constructor(){super(...arguments);this.type=x.Ellipse;this.onPointerDown=()=>{if(this.status!==$.Idle)return;let{currentPoint:e,currentGrid:t,settings:{showGrid:n},appState:{currentPageId:o,currentStyle:i}}=this.app,r=this.getNextChildIndex(),d=Il.uniqueId(),a=Vo.create({id:d,parentId:o,childIndex:r,point:n?xl.snap(e,t):e,style:m({},i)});this.app.patchCreate([a]),this.app.startSession(H.TransformSingle,a.id,wl.BottomRight,!0),this.setStatus($.Creating)}}};import{Utils as Cl,TLBoundsCorner as Pl}from"@tldraw/core";import vl from"@tldraw/vec";var bn=class extends ue{constructor(){super(...arguments);this.type=x.Rectangle;this.onPointerDown=()=>{if(this.status!==$.Idle)return;let{currentPoint:e,currentGrid:t,settings:{showGrid:n},appState:{currentPageId:o,currentStyle:i}}=this.app,r=this.getNextChildIndex(),d=Cl.uniqueId(),a=Ko.create({id:d,parentId:o,childIndex:r,point:n?vl.snap(e,t):e,style:m({},i)});this.app.patchCreate([a]),this.app.startSession(H.TransformSingle,a.id,Pl.BottomRight,!0),this.setStatus($.Creating)}}};import{Utils as Dl}from"@tldraw/core";import Bl from"@tldraw/vec";var In=class extends ue{constructor(){super(...arguments);this.type=x.Line;this.onPointerDown=()=>{if(this.status!==$.Idle)return;let{currentPoint:e,currentGrid:t,settings:{showGrid:n},appState:{currentPageId:o,currentStyle:i}}=this.app,r=this.getNextChildIndex(),d=Dl.uniqueId(),a=ln.create({id:d,parentId:o,childIndex:r,point:n?Bl.snap(e,t):e,decorations:{start:void 0,end:void 0},style:m({},i)});this.app.patchCreate([a]),this.app.startSession(H.Arrow,a.id,"end",!0),this.setStatus($.Creating)}}};import{Utils as kl}from"@tldraw/core";import Rl from"@tldraw/vec";var wn=class extends ue{constructor(){super(...arguments);this.type=x.Arrow;this.onPointerDown=()=>{if(this.status!==$.Idle)return;let{currentPoint:e,currentGrid:t,settings:{showGrid:n},appState:{currentPageId:o,currentStyle:i}}=this.app,r=this.getNextChildIndex(),d=kl.uniqueId(),a=ln.create({id:d,parentId:o,childIndex:r,point:n?Rl.snap(e,t):e,style:m({},i)});this.app.patchCreate([a]),this.app.startSession(H.Arrow,a.id,"end",!0),this.setStatus($.Creating)}}};import yr from"@tldraw/vec";import{Utils as El}from"@tldraw/core";var xn=class extends ue{constructor(){super(...arguments);this.type=x.Sticky;this.onPointerDown=()=>{if(this.status===$.Creating){this.setStatus($.Idle),this.app.appState.isToolLocked||this.app.selectTool("select");return}if(this.status===$.Idle){let{currentPoint:e,currentGrid:t,settings:{showGrid:n},appState:{currentPageId:o,currentStyle:i}}=this.app,r=this.getNextChildIndex(),d=El.uniqueId();this.shapeId=d;let a=Nn.create({id:d,parentId:o,childIndex:r,point:n?yr.snap(e,t):e,style:m({},i)}),l=Nn.getBounds(a);a.point=yr.sub(a.point,[l.width/2,l.height/2]),this.app.createShapes(a),this.app.startSession(H.Translate),this.setStatus($.Creating)}};this.onPointerUp=()=>{this.status===$.Creating&&(this.setStatus($.Idle),this.app.completeSession(),this.app.selectTool("select"),this.app.setEditingId(this.shapeId))}}};import Ll from"zustand/vanilla";import Ml from"zustand";import{get as br,set as ps}from"idb-keyval";function Pt(s){if(s===null)return s;if(s instanceof Date)return new Date(s.getTime());if(typeof s=="object")if(typeof s[Symbol.iterator]=="function"){let e=[];if(s.length>0)for(let t of s)e.push(Pt(t));return e}else{let e=Object.keys(s),t={};if(e.length>0)for(let n of e)t[n]=Pt(s[n]);return t}return s}import{Utils as Hl}from"@tldraw/core";var cs=class{constructor(e,t,n,o){this.pointer=-1;this._status="loading";this.stack=[];this.isPaused=!1;this.persist=e=>{if(this.onPersist&&this.onPersist(this._state,e),this._idbId)return ps(this._idbId,this._state).catch(t=>console.error(t))};this.applyPatch=(e,t)=>{let n=this._state,o=Hl.deepMerge(this._state,e),i=this.cleanup(o,n,e,t);return this.onStateWillChange&&this.onStateWillChange(i,t),this._state=i,this.store.setState(this._state,!0),this.onStateDidChange&&this.onStateDidChange(this._state,t),this};this.cleanup=(e,t,n,o)=>e;this.patchState=(e,t)=>(this.applyPatch(e,t),this.onPatch&&this.onPatch(this._state,t),this);this.replaceState=(e,t)=>{let n=this.cleanup(e,this._state,e,t);return this.onStateWillChange&&this.onStateWillChange(n,"replace"),this._state=n,this.store.setState(this._state,!0),this.onStateDidChange&&this.onStateDidChange(this._state,"replace"),this};this.setState=(e,t=e.id)=>(this.pointer<this.stack.length-1&&(this.stack=this.stack.slice(0,this.pointer+1)),this.stack.push(y(m({},e),{id:t})),this.pointer=this.stack.length-1,this.applyPatch(e.after,t),this.onCommand&&this.onCommand(this._state,t),this.persist(t),this);this.reset=()=>(this.onStateWillChange&&this.onStateWillChange(this.initialState,"reset"),this._state=this.initialState,this.store.setState(this._state,!0),this.resetHistory(),this.persist("reset"),this.onStateDidChange&&this.onStateDidChange(this._state,"reset"),this.onReset&&this.onReset(this._state),this);this.replaceHistory=(e,t=e.length-1)=>(this.stack=e,this.pointer=t,this.onReplace&&this.onReplace(this._state),this);this.resetHistory=()=>(this.stack=[],this.pointer=-1,this.onResetHistory&&this.onResetHistory(this._state),this);this.undo=()=>{if(!this.isPaused){if(!this.canUndo)return this;let e=this.stack[this.pointer];this.pointer--,this.applyPatch(e.before,"undo"),this.persist("undo")}return this.onUndo&&this.onUndo(this._state),this};this.redo=()=>{if(!this.isPaused){if(!this.canRedo)return this;this.pointer++;let e=this.stack[this.pointer];this.applyPatch(e.after,"redo"),this.persist("undo")}return this.onRedo&&this.onRedo(this._state),this};this.setSnapshot=()=>(this._snapshot=m({},this._state),this);this.forceUpdate=()=>{this.store.setState(this._state,!0)};this._idbId=t,this._state=Pt(e),this._snapshot=Pt(e),this.initialState=Pt(e),this.store=Ll(()=>this._state),this.useStore=Ml(this.store),this.ready=new Promise(i=>{let r="none";this._idbId?(r="restored",br(this._idbId).then(d=>he(this,null,function*(){if(d){let a=d;if(n){let l=yield br(t+"_version");l&&l<n&&(a=o?o(d,e,l):e,r="migrated")}yield ps(t+"_version",n||-1),this._state=Pt(a),this._snapshot=Pt(a),this.store.setState(this._state,!0)}else yield ps(t+"_version",n||-1);this._status="ready",i(r)})).catch(d=>console.error(d))):(this._status="ready",i(r)),i(r)}).then(i=>(this.onReady&&this.onReady(i),i))}pause(){this.isPaused=!0}resume(){this.isPaused=!1}get canUndo(){return this.pointer>-1}get canRedo(){return this.pointer<this.stack.length-1}get state(){return this._state}get status(){return this._status}get snapshot(){return this._snapshot}};var hs=ce.uniqueId(),ve=class extends cs{constructor(e,t={}){super(ve.defaultState,e,ve.version,(n,o,i)=>y(m({},o),{document:dt(y(m(m({},o.document),n.document),{version:i}),ve.version)}));this.callbacks={};this.tools={select:new gn(this),erase:new fn(this),[x.Text]:new Sn(this),[x.Draw]:new Tn(this),[x.Ellipse]:new yn(this),[x.Rectangle]:new bn(this),[x.Line]:new In(this),[x.Arrow]:new wn(this),[x.Sticky]:new xn(this)};this.currentTool=this.tools.select;this.readOnly=!1;this.isDirty=!1;this.isCreating=!1;this.originPoint=[0,0];this.currentPoint=[0,0];this.previousPoint=[0,0];this.shiftKey=!1;this.altKey=!1;this.metaKey=!1;this.ctrlKey=!1;this.spaceKey=!1;this.editingStartTime=-1;this.fileSystemHandle=null;this.viewport=ce.getBoundsFromPoints([[0,0],[100,100]]);this.rendererBounds=ce.getBoundsFromPoints([[0,0],[100,100]]);this.selectHistory={stack:[[]],pointer:0};this.rotationInfo={selectedIds:[],center:[0,0]};this.pasteInfo={center:[0,0],offset:[0,0]};this.onReady=()=>{var e,t;this.loadDocument(this.document),So().then(n=>{this.fileSystemHandle=n});try{this.patchState({appState:{status:_.Idle},document:dt(this.document,ve.version)})}catch(n){console.error("The data appears to be corrupted. Resetting!",n),localStorage.setItem(this.document.id+"_corrupted",JSON.stringify(this.document)),this.patchState(y(m({},ve.defaultState),{appState:y(m({},ve.defaultState.appState),{status:_.Idle})}))}(t=(e=this.callbacks).onMount)==null||t.call(e,this)};this.cleanup=(e,t)=>{let n=m({},e);n.document!==t.document&&Object.entries(n.document.pages).forEach(([r,d])=>{if(d===void 0){delete n.document.pages[r],delete n.document.pageStates[r];return}let a=t.document.pages[r],l={};if(!a||d.shapes!==a.shapes||d.bindings!==a.bindings){d.shapes=m({},d.shapes),d.bindings=m({},d.bindings);let c=new Set;Object.entries(d.shapes).forEach(([u,f])=>{var b;let g;f?g=f.parentId:(g=(b=a==null?void 0:a.shapes[u])==null?void 0:b.parentId,delete d.shapes[u]),d.id===n.appState.currentPageId&&(a==null?void 0:a.shapes[u])!==f&&(l[u]=f),g&&g!==r&&d.shapes[g]!==void 0&&c.add(d.shapes[g])}),Object.keys(d.bindings).forEach(u=>{d.bindings[u]||delete d.bindings[u]}),n.document.pages[r]=d,I.getRelatedBindings(n,Object.keys(l),r).forEach(u=>{var w;if(!d.bindings[u.id])return;let f=d.shapes[u.toId],g=d.shapes[u.fromId],b=I.getShapeUtil(f),P=I.getShapeUtil(g),S=(w=P.onBindingChange)==null?void 0:w.call(P,g,u,f,b.getBounds(f),b.getCenter(f));if(S){let v=m(m({},g),S);d.shapes[g.id]=v}}),c.forEach(u=>{if(!u)throw Error("no group!");let f=u.children.filter(b=>d.shapes[b]!==void 0),g=ce.getCommonBounds(f.map(b=>d.shapes[b]).filter(Boolean).map(b=>I.getRotatedBounds(b)));d.shapes[u.id]=y(m({},u),{point:[g.minX,g.minY],size:[g.width,g.height],children:f})})}let p=m({},n.document.pageStates[r]);p.brush||delete p.brush,p.hoveredId&&!d.shapes[p.hoveredId]&&delete p.hoveredId,p.bindingId&&!d.bindings[p.bindingId]&&(I.warn(`Could not find the binding of ${r}`),delete p.bindingId),p.editingId&&!d.shapes[p.editingId]&&(I.warn("Could not find the editing shape!"),delete p.editingId),n.document.pageStates[r]=p});let o=n.appState.currentPageId,i=n.document.pageStates[o];if(n.room&&n.room!==t.room){let r=y(m({},n.room),{users:m({},n.room.users)});t.room&&Object.values(t.room.users).filter(Boolean).forEach(d=>{r.users[d.id]===void 0&&delete r.users[d.id]}),n.room=r}return n.room&&(n.room.users[n.room.userId]=y(m({},n.room.users[n.room.userId]),{point:this.currentPoint,selectedIds:i.selectedIds})),this.readOnly&&(n.document.pages=t.document.pages),n};this.onPatch=(e,t)=>{var n,o;(o=(n=this.callbacks).onPatch)==null||o.call(n,this,t)};this.onCommand=(e,t)=>{var n,o;this.clearSelectHistory(),this.isDirty=!0,(o=(n=this.callbacks).onCommand)==null||o.call(n,this,t)};this.onReplace=()=>{this.clearSelectHistory(),this.isDirty=!1};this.onUndo=()=>{var e,t;this.rotationInfo.selectedIds=[...this.selectedIds],(t=(e=this.callbacks).onUndo)==null||t.call(e,this)};this.onRedo=()=>{var e,t;this.rotationInfo.selectedIds=[...this.selectedIds],(t=(e=this.callbacks).onRedo)==null||t.call(e,this)};this.onPersist=()=>{var e,t;this.callbacks.onChangePage&&this.broadcastPageChanges(),(t=(e=this.callbacks).onPersist)==null||t.call(e,this)};this.prevSelectedIds=this.selectedIds;this.onStateDidChange=(e,t)=>{var n,o,i,r;(o=(n=this.callbacks).onChange)==null||o.call(n,this,t),this.room&&this.selectedIds!==this.prevSelectedIds&&((r=(i=this.callbacks).onChangePresence)==null||r.call(i,this,y(m({},this.room.users[this.room.userId]),{selectedIds:this.selectedIds})),this.prevSelectedIds=this.selectedIds)};this.justSent=!1;this.prevShapes=this.page.shapes;this.prevBindings=this.page.bindings;this.broadcastPageChanges=()=>{var o,i;let e=new Set,t={},n={};this.shapes.forEach(r=>{e.add(r.id),this.prevShapes[r.id]!==r&&(t[r.id]=r)}),Object.keys(this.prevShapes).filter(r=>!e.has(r)).forEach(r=>{t[r]=void 0}),this.bindings.forEach(r=>{e.add(r.id),this.prevBindings[r.id]!==r&&(n[r.id]=r)}),Object.keys(this.prevBindings).filter(r=>!e.has(r)).forEach(r=>{n[r]=void 0}),this.justSent=!0,(i=(o=this.callbacks).onChangePage)==null||i.call(o,this,t,n),this.prevShapes=this.page.shapes,this.prevBindings=this.page.bindings};this.getReservedContent=(e,t=this.currentPageId)=>{let{bindings:n}=this.document.pages[t],o={},i={},r=Object.values(n),d=new Map(r.map(u=>[u.toId,u])),a=new Map(r.map(u=>[u.fromId,u])),l=[d,a],p=[];this.session&&e.forEach(u=>p.push(u));let c=new Set(p),h=new Set;for(;p.length>0;){let u=p.pop();if(!u)break;if(h.has(u))continue;h.add(u);let f=this.getShape(u);o[u]=f,f.parentId!==t&&p.push(f.parentId),f.children&&p.push(...f.children),l.map(g=>g.get(f.id)).filter(Boolean).forEach(g=>{i[g.id]=g,p.push(g.toId,g.fromId)})}return{reservedShapes:o,reservedBindings:i,strongReservedShapeIds:c}};this.replacePageContent=(e,t,n=this.currentPageId)=>this.justSent?(this.justSent=!1,this):(this.useStore.setState(o=>{let{hoveredId:i,editingId:r,bindingId:d,selectedIds:a}=o.document.pageStates[n],l=[...a];r&&l.push(r);let{reservedShapes:p,reservedBindings:c,strongReservedShapeIds:h}=this.getReservedContent(l,this.currentPageId);Object.values(p).filter(S=>!("text"in S)).forEach(S=>{let w=e[S.id];if(!!w){if(!(S.type===x.Arrow||h.has(S.id))){p[S.id]=w;return}"decorations"in w&&"decorations"in S&&(S.decorations=w.decorations),S.style=w.style}}),this.prevShapes=e,this.prevBindings=t;let u=m(m({},e),p),f=m(m({},t),c),g=y(m({},o),{document:y(m({},o.document),{pages:{[n]:y(m({},o.document.pages[n]),{shapes:u,bindings:f})},pageStates:y(m({},o.document.pageStates),{[n]:y(m({},o.document.pageStates[n]),{selectedIds:a.filter(S=>u[S]!==void 0),hoveredId:i?u[i]===void 0?void 0:i:void 0,editingId:r,bindingId:d?f[d]===void 0?void 0:d:void 0})})})}),b=I.getRelatedBindings(g,Object.keys(u),n),P=g.document.pages[n];return b.forEach(S=>{var B;if(!P.bindings[S.id])return;let w=P.shapes[S.toId],v=P.shapes[S.fromId],T=I.getShapeUtil(w),C=I.getShapeUtil(v),R=(B=C.onBindingChange)==null?void 0:B.call(C,v,S,w,T.getBounds(w),T.getCenter(w));if(R){let O=m(m({},v),R);P.shapes[v.id]=O}}),Object.values(u).forEach(S=>{if(S.type!==x.Group)return;let w=S.children.filter(T=>P.shapes[T]!==void 0),v=ce.getCommonBounds(w.map(T=>P.shapes[T]).filter(Boolean).map(T=>I.getRotatedBounds(T)));P.shapes[S.id]=y(m({},S),{point:[v.minX,v.minY],size:[v.width,v.height],children:w})}),this.state.document=g.document,g},!0),this);this.updateBounds=e=>{this.rendererBounds=e;let{point:t,zoom:n}=this.pageState.camera;this.updateViewport(t,n),!this.readOnly&&this.session&&this.session.update()};this.updateViewport=(e,t)=>{let{width:n,height:o}=this.rendererBounds,[i,r]=G.sub(G.div([0,0],t),e),[d,a]=G.sub(G.div([n,o],t),e);this.viewport={minX:i,minY:r,maxX:d,maxY:a,height:d-i,width:a-r}};this.setEditingId=e=>{this.readOnly||(this.editingStartTime=Date.now(),this.patchState({document:{pageStates:{[this.currentPageId]:{editingId:e}}}},"set_editing_id"))};this.setHoveredId=e=>{this.patchState({document:{pageStates:{[this.currentPageId]:{hoveredId:e}}}},"set_hovered_id")};this.setSetting=(e,t)=>this.session?this:(this.patchState({settings:{[e]:typeof t=="function"?t(this.settings[e]):t}},`settings:${e}`),this.persist(),this);this.toggleFocusMode=()=>this.session?this:(this.patchState({settings:{isFocusMode:!this.settings.isFocusMode}},"settings:toggled_focus_mode"),this.persist(),this);this.togglePenMode=()=>this.session?this:(this.patchState({settings:{isPenMode:!this.settings.isPenMode}},"settings:toggled_pen_mode"),this.persist(),this);this.toggleDarkMode=()=>this.session?this:(this.patchState({settings:{isDarkMode:!this.settings.isDarkMode}},"settings:toggled_dark_mode"),this.persist(),this);this.toggleZoomSnap=()=>this.session?this:(this.patchState({settings:{isZoomSnap:!this.settings.isZoomSnap}},"settings:toggled_zoom_snap"),this.persist(),this);this.toggleDebugMode=()=>this.session?this:(this.patchState({settings:{isDebugMode:!this.settings.isDebugMode}},"settings:toggled_debug"),this.persist(),this);this.setMenuOpen=e=>(this.patchState({appState:{isMenuOpen:e}},"ui:toggled_menu_opened"),this.persist(),this);this.isMenuOpen=()=>this.appState.isMenuOpen;this.toggleGrid=()=>this.session?this:(this.patchState({settings:{showGrid:!this.settings.showGrid}},"settings:toggled_grid"),this.persist(),this);this.selectTool=e=>{if(this.readOnly||this.session)return this;let t=this.tools[e];return t===this.currentTool?(this.patchState({appState:{isToolLocked:!1}}),this):(this.currentTool.onExit(),t.previous=this.currentTool.type,this.currentTool=t,this.currentTool.onEnter(),this.patchState({appState:{activeTool:e,isToolLocked:!1}},`selected_tool:${e}`))};this.toggleToolLock=()=>this.session?this:this.patchState({appState:{isToolLocked:!this.appState.isToolLocked}},"toggled_tool_lock");this.resetDocument=()=>this.session?this:(this.session=void 0,this.pasteInfo.offset=[0,0],this.currentTool=this.tools.select,this.resetHistory().clearSelectHistory().loadDocument(dt(ve.defaultDocument,ve.version)).persist(),this);this.updateUsers=(e,t=!1)=>{this.patchState({room:{users:Object.fromEntries(e.map(n=>[n.id,n]))}},t?"room:self:update":"room:user:update")};this.removeUser=e=>{this.patchState({room:{users:{[e]:void 0}}})};this.mergeDocument=e=>{if(this.document.id!==e.id)return this.replaceState(y(m({},this.state),{appState:y(m({},this.appState),{currentPageId:Object.keys(e.pages)[0]}),document:dt(e,ve.version)})),this;let t=m({},this.document.pageStates),n=y(m({},this.appState),{currentPageId:e.pages[this.currentPageId]?this.currentPageId:Object.keys(e.pages)[0],pages:Object.values(e.pages).map((i,r)=>({id:i.id,name:i.name,childIndex:i.childIndex||r}))});this.resetHistory(),Object.keys(this.document.pages).forEach(i=>{e.pages[i]||(i===this.appState.currentPageId&&(this.cancelSession(),this.selectNone()),t[i]=void 0)}),this.session&&this.selectedIds.filter(i=>!e.pages[this.currentPageId].shapes[i]).forEach(i=>e.pages[this.currentPageId].shapes[i]=this.page.shapes[i]),Object.entries(t).forEach(([i,r])=>{r.selectedIds=r.selectedIds.filter(d=>!!e.pages[i].shapes[d])});let{editingId:o}=this.pageState;return o&&(e.pages[this.currentPageId].shapes[o]=this.page.shapes[o],t[this.currentPageId].selectedIds=[o]),this.replaceState(y(m({},this.state),{appState:n,document:y(m({},dt(e,ve.version)),{pageStates:t})}),"merge")};this.updateDocument=(e,t="updated_document")=>{let n=this.state,o=y(m({},n),{document:m({},n.document)});e.pages[this.currentPageId]||(o.appState=y(m({},n.appState),{currentPageId:Object.keys(e.pages)[0]}));let i=1;for(let r of Object.values(e.pages))r!==n.document.pages[r.id]&&(o.document.pages[r.id]=r,r.name||(o.document.pages[r.id].name=`Page ${i+1}`,i++));for(let r of Object.values(e.pageStates))if(r!==n.document.pageStates[r.id]){o.document.pageStates[r.id]=r;let d=e.pages[r.id],a=["bindingId","editingId","hoveredId","pointedId"];for(let l of a)d.shapes[l]||(r[l]=void 0);r.selectedIds=r.selectedIds.filter(l=>!!e.pages[d.id].shapes[l])}return o.document=dt(o.document,o.document.version||0),this.replaceState(o,`${t}:${e.id}`)};this.loadRoom=e=>(this.patchState({room:{id:e,userId:hs,users:{[hs]:{id:hs,color:bo[Math.floor(Math.random()*bo.length)],point:[100,100],selectedIds:[],activeShapes:[]}}}}),this);this.loadDocument=e=>(this.selectNone(),this.resetHistory(),this.clearSelectHistory(),this.session=void 0,this.replaceState(y(m({},ve.defaultState),{document:dt(e,ve.version),appState:y(m({},ve.defaultState.appState),{currentPageId:Object.keys(e.pages)[0]})}),"loaded_document"),this);this.newProject=()=>{!this.isLocal||(this.fileSystemHandle=null,this.resetDocument())};this.saveProject=()=>he(this,null,function*(){if(!this.readOnly){try{let e=yield Hn(this.document,this.fileSystemHandle);this.fileSystemHandle=e,this.persist(),this.isDirty=!1}catch(e){console.error(e.message)}return this}});this.saveProjectAs=()=>he(this,null,function*(){try{let e=yield Hn(this.document,null);this.fileSystemHandle=e,this.persist(),this.isDirty=!1}catch(e){console.error(e.message)}return this});this.openProject=()=>he(this,null,function*(){if(!!this.isLocal)try{let e=yield yo();if(!e)throw Error();let{fileHandle:t,document:n}=e;this.loadDocument(n),this.fileSystemHandle=t,this.zoomToFit(),this.persist()}catch(e){console.error(e)}finally{this.persist()}});this.signOut=()=>{};this.getAppState=()=>this.appState;this.getPage=(e=this.currentPageId)=>I.getPage(this.state,e||this.currentPageId);this.getShapes=(e=this.currentPageId)=>I.getShapes(this.state,e||this.currentPageId);this.getBindings=(e=this.currentPageId)=>I.getBindings(this.state,e||this.currentPageId);this.getShape=(e,t=this.currentPageId)=>I.getShape(this.state,e,t);this.getShapeBounds=(e,t=this.currentPageId)=>I.getBounds(this.getShape(e,t));this.getBinding=(e,t=this.currentPageId)=>I.getBinding(this.state,e,t);this.getPageState=(e=this.currentPageId)=>I.getPageState(this.state,e||this.currentPageId);this.getPagePoint=(e,t=this.currentPageId)=>{let{camera:n}=this.getPageState(t);return G.sub(G.div(e,n.zoom),n.point)};this.createPage=e=>{if(this.readOnly)return this;let{width:t,height:n}=this.rendererBounds;return this.setState(Vi(this,[-t/2,-n/2],e))};this.changePage=e=>this.setState(Ki(this,e));this.renamePage=(e,t)=>this.readOnly?this:this.setState(tr(this,e,t));this.duplicatePage=e=>this.readOnly?this:this.setState(Yi(this,e));this.deletePage=e=>this.readOnly?this:Object.values(this.document.pages).length<=1?this:this.setState(Wi(this,e||this.currentPageId));this.copy=(e=this.selectedIds)=>{let t=e.flatMap(i=>I.getDocumentBranch(this.state,i,this.currentPageId)),n=t.map(i=>ce.deepClone(this.getShape(i,this.currentPageId)));if(n.length===0)return this;let o=Object.values(this.page.bindings).filter(i=>t.includes(i.fromId)&&t.includes(i.toId));this.clipboard={shapes:n,bindings:o};try{let i=JSON.stringify({type:"tldr/clipboard",shapes:n,bindings:o});navigator.clipboard.writeText(i).then(()=>{},()=>{})}catch(i){}return this.pasteInfo.offset=[0,0],this.pasteInfo.center=[0,0],this};this.cut=(e=this.selectedIds)=>(this.copy(e),this.delete(e),this);this.paste=e=>{if(this.readOnly)return;let t=(n,o)=>{let i={};n.forEach(u=>i[u.id]=ce.uniqueId()),o.forEach(u=>i[u.id]=ce.uniqueId());let r=I.getTopChildIndex(this.state,this.currentPageId),d=n.sort((u,f)=>u.childIndex-f.childIndex).map(u=>{let f=i[u.parentId],g=y(m({},u),{id:i[u.id],parentId:f||this.currentPageId});return u.children&&(g.children=u.children.map(b=>i[b])),f||(g.childIndex=r,r++),g.handles&&Object.values(g.handles).forEach(b=>{b.bindingId&&(b.bindingId=i[b.bindingId])}),g}),a=o.map(u=>y(m({},u),{id:i[u.id],toId:i[u.toId],fromId:i[u.fromId]})),l=ce.getCommonBounds(d.map(I.getBounds)),p=G.toFixed(this.getPagePoint(e||this.centerPoint));G.dist(p,this.pasteInfo.center)<2||G.dist(p,G.toFixed(ce.getBoundsCenter(l)))<2?(p=G.add(p,this.pasteInfo.offset),this.pasteInfo.offset=G.add(this.pasteInfo.offset,[ct,ct])):(this.pasteInfo.center=p,this.pasteInfo.offset=[0,0]);let c=ce.centerBounds(l,p),h=G.sub(ce.getBoundsCenter(c),ce.getBoundsCenter(l));this.create(d.map(u=>I.getShapeUtil(u.type).create(y(m({},u),{point:G.toFixed(G.add(u.point,h)),parentId:u.parentId||this.currentPageId}))),a)};try{if(!("clipboard"in navigator&&navigator.clipboard.readText))throw Error("This browser does not support the clipboard API.");navigator.clipboard.readText().then(n=>{try{let o=JSON.parse(n);if(o.type!=="tldr/clipboard")throw Error("The pasted string was not from the Tldraw clipboard.");t(o.shapes,o.bindings)}catch(o){I.warn(o);let i=ce.uniqueId();this.createShapes({id:i,type:x.Text,parentId:this.appState.currentPageId,text:I.normalizeText(n),point:this.getPagePoint(this.centerPoint,this.currentPageId),style:m({},this.appState.currentStyle)}),this.select(i)}})}catch(n){this.clipboard&&t(this.clipboard.shapes,this.clipboard.bindings)}return this};this.copySvg=(e=this.selectedIds,t=this.currentPageId)=>{if(e.length===0&&(e=Object.keys(this.page.shapes)),e.length===0)return;let n=e.map(h=>this.getShape(h,t)),o=ce.getCommonBounds(n.map(I.getRotatedBounds)),i=16,r=document.createElementNS("http://www.w3.org/2000/svg","svg"),d=document.createElementNS("http://www.w3.org/2000/svg","defs"),a=document.createElementNS("http://www.w3.org/2000/svg","style");a.textContent="@import url('https://fonts.googleapis.com/css2?family=Caveat+Brush&family=Source+Code+Pro&family=Source+Sans+Pro&family=Source+Serif+Pro&display=swap');",d.appendChild(a),r.appendChild(d);function l(h){let u=I.getShapeUtil(h),f=u.getSvgElement(h),g=u.getBounds(h);if(!!f)return f.setAttribute("transform",`translate(${i+h.point[0]-o.minX}, ${i+h.point[1]-o.minY}) rotate(${(h.rotation||0)*180/Math.PI}, ${g.width/2}, ${g.height/2})`),f}n.forEach(h=>{var f;if((f=h.children)==null?void 0:f.length){let g=document.createElementNS("http://www.w3.org/2000/svg","g");h.children.map(b=>this.getShape(b,t)).map(l).filter(Boolean).forEach(b=>g.appendChild(b)),r.appendChild(g);return}let u=l(h);u&&r.appendChild(u)}),r.setAttribute("viewBox",[0,0,o.width+i*2,o.height+i*2].join(" ")),r.setAttribute("width",String(o.width)),r.setAttribute("height",String(o.height));let c=new XMLSerializer().serializeToString(r).replaceAll("&#10;      ","").replaceAll(/((\s|")[0-9]*\.[0-9]{2})([0-9]*)(\b|"|\))/g,"$1");return I.copyStringToClipboard(c),c};this.copyJson=(e=this.selectedIds,t=this.currentPageId)=>{if(e.length===0&&(e=Object.keys(this.page.shapes)),e.length===0)return;let n=e.map(i=>this.getShape(i,t)),o=JSON.stringify(n,null,2);return I.copyStringToClipboard(o),o};this.setCamera=(e,t,n)=>(this.updateViewport(e,t),this.patchState({document:{pageStates:{[this.currentPageId]:{camera:{point:e,zoom:t}}}}},n),this);this.resetCamera=()=>this.setCamera(this.centerPoint,1,"reset_camera");this.pan=e=>{let{camera:t}=this.pageState;return this.setCamera(G.toFixed(G.sub(t.point,e)),t.zoom,"panned")};this.pinchZoom=(e,t,n)=>{let{camera:o}=this.pageState,i=G.sub(o.point,G.div(t,o.zoom)),r=n,d=G.sub(G.div(e,o.zoom),i),a=G.sub(G.div(e,r),i);return this.setCamera(G.toFixed(G.add(i,G.sub(a,d))),r,"pinch_zoomed")};this.zoomTo=(e,t=this.centerPoint)=>{let{zoom:n,point:o}=this.pageState.camera,i=G.sub(G.div(t,n),o),r=G.sub(G.div(t,e),o);return this.setCamera(G.toFixed(G.add(o,G.sub(r,i))),e,"zoomed_camera")};this.zoomIn=()=>{let e=Math.round(this.pageState.camera.zoom*100/25),t=I.getCameraZoom((e+1)*.25);return this.zoomTo(t)};this.zoomOut=()=>{let e=Math.round(this.pageState.camera.zoom*100/25),t=I.getCameraZoom((e-1)*.25);return this.zoomTo(t)};this.zoomToFit=()=>{let e=this.shapes;if(e.length===0)return this;let{rendererBounds:t}=this,n=ce.getCommonBounds(e.map(I.getBounds)),o=I.getCameraZoom(Math.min((t.width-nn)/n.width,(t.height-nn)/n.height));o=this.pageState.camera.zoom===o||this.pageState.camera.zoom<1?Math.min(1,o):o;let i=(t.width-n.width*o)/2/o,r=(t.height-n.height*o)/2/o;return this.setCamera(G.toFixed(G.sub([i,r],[n.minX,n.minY])),o,"zoomed_to_fit")};this.zoomToSelection=()=>{if(this.selectedIds.length===0)return this;let{rendererBounds:e}=this,t=I.getSelectedBounds(this.state),n=I.getCameraZoom(Math.min((e.width-nn)/t.width,(e.height-nn)/t.height));n=this.pageState.camera.zoom===n||this.pageState.camera.zoom<1?Math.min(1,n):n;let o=(e.width-t.width*n)/2/n,i=(e.height-t.height*n)/2/n;return this.setCamera(G.toFixed(G.sub([o,i],[t.minX,t.minY])),n,"zoomed_to_selection")};this.zoomToContent=()=>{let e=this.shapes,t=this.pageState;if(e.length===0)return this;let{rendererBounds:n}=this,{zoom:o}=t.camera,i=ce.getCommonBounds(e.map(I.getBounds)),r=(n.width-i.width*o)/2/o,d=(n.height-i.height*o)/2/o;return this.setCamera(G.toFixed(G.sub([r,d],[i.minX,i.minY])),this.pageState.camera.zoom,"zoomed_to_content")};this.resetZoom=()=>this.zoomTo(1);this.zoomBy=ce.throttle((e,t)=>{let{zoom:n}=this.pageState.camera,o=I.getCameraZoom(n-e*n);return this.zoomTo(o,t)},16);this.clearSelectHistory=()=>(this.selectHistory.pointer=0,this.selectHistory.stack=[this.selectedIds],this);this.addToSelectHistory=e=>(this.selectHistory.pointer<this.selectHistory.stack.length&&(this.selectHistory.stack=this.selectHistory.stack.slice(0,this.selectHistory.pointer+1)),this.selectHistory.pointer++,this.selectHistory.stack.push(e),this);this.setSelectedIds=(e,t=!1)=>{let n=t?[...this.pageState.selectedIds,...e]:[...e];return this.patchState({appState:{activeTool:"select"},document:{pageStates:{[this.currentPageId]:{selectedIds:n}}}},"selected")};this.undoSelect=()=>(this.selectHistory.pointer>0&&(this.selectHistory.pointer--,this.setSelectedIds(this.selectHistory.stack[this.selectHistory.pointer])),this);this.redoSelect=()=>(this.selectHistory.pointer<this.selectHistory.stack.length-1&&(this.selectHistory.pointer++,this.setSelectedIds(this.selectHistory.stack[this.selectHistory.pointer])),this);this.select=(...e)=>(e.forEach(t=>{if(!this.page.shapes[t])throw Error(`That shape does not exist on page ${this.currentPageId}`)}),this.setSelectedIds(e),this.addToSelectHistory(e),this);this.selectAll=(e=this.currentPageId)=>this.session?this:(this.setSelectedIds(Object.values(this.document.pages[e].shapes).filter(t=>t.parentId===e).map(t=>t.id)),this.addToSelectHistory(this.selectedIds),this.selectTool("select"),this);this.selectNone=()=>(this.setSelectedIds([]),this.addToSelectHistory(this.selectedIds),this);this.startSession=(e,...t)=>{if(this.readOnly&&e!==H.Brush)return this;this.session&&(I.warn(`Already in a session! (${this.session.constructor.name})`),this.cancelSession());let n=Tr(e);this.session=new n(this,...t);let o=this.session.start();return o&&this.patchState(o,`session:start_${this.session.constructor.name}`),this};this.updateSession=()=>{let{session:e}=this;if(!e)return this;let t=e.update();return t?this.patchState(t,`session:${e==null?void 0:e.constructor.name}`):this};this.cancelSession=()=>{let{session:e}=this;if(!e)return this;this.session=void 0;let t=e.cancel();return t&&this.patchState(t,`session:cancel:${e.constructor.name}`),this};this.completeSession=()=>{var n,o,i,r,d,a,l;let{session:e}=this;if(!e)return this;this.session=void 0;let t=e.complete();if(t===void 0)return this.isCreating=!1,this.patchState({appState:{status:_.Idle},document:{pageStates:{[this.currentPageId]:{editingId:void 0,bindingId:void 0,hoveredId:void 0}}}},`session:complete:${e.constructor.name}`);if("after"in t){if(this.isCreating){if(t.before={appState:y(m({},t.before.appState),{status:_.Idle}),document:{pages:{[this.currentPageId]:{shapes:Object.fromEntries(this.selectedIds.map(p=>[p,void 0]))}},pageStates:{[this.currentPageId]:{selectedIds:[],editingId:null,bindingId:null,hoveredId:null}}}},this.appState.isToolLocked){let p=((i=(o=(n=t.after)==null?void 0:n.document)==null?void 0:o.pageStates)==null?void 0:i[this.currentPageId])||{};p.selectedIds=[]}this.isCreating=!1}t.after.appState=y(m({},t.after.appState),{status:_.Idle}),t.after.document=y(m({},t.after.document),{pageStates:y(m({},(r=t.after.document)==null?void 0:r.pageStates),{[this.currentPageId]:y(m({},(((d=t.after.document)==null?void 0:d.pageStates)||{})[this.currentPageId]),{editingId:null})})}),this.setState(t,`session:complete:${e.constructor.name}`)}else this.patchState(y(m({},t),{appState:y(m({},t.appState),{status:_.Idle}),document:y(m({},t.document),{pageStates:{[this.currentPageId]:y(m({},(l=(a=t.document)==null?void 0:a.pageStates)==null?void 0:l[this.currentPageId]),{editingId:null})}})}),`session:complete:${e.constructor.name}`);return this};this.createShapes=(...e)=>e.length===0?this:this.create(e.map(t=>I.getShapeUtil(t.type).create(m({parentId:this.currentPageId},t))));this.updateShapes=(...e)=>{let t=this.document.pages[this.currentPageId].shapes,n=e.filter(o=>t[o.id]);return n.length===0?this:this.setState(pr(this,n,this.currentPageId),"updated_shapes")};this.create=(e=[],t=[])=>e.length===0?this:this.setState(No(this,e,t));this.patchCreate=(e=[],t=[])=>e.length===0?this:this.patchState(No(this,e,t).after);this.delete=(e=this.selectedIds)=>e.length===0?this:this.setState(_o(this,e));this.deleteAll=()=>(this.selectAll(),this.delete(),this);this.style=(e,t=this.selectedIds)=>this.setState(rr(this,t,e));this.align=(e,t=this.selectedIds)=>t.length<2?this:this.setState($i(this,t,e));this.distribute=(e,t=this.selectedIds)=>t.length<3?this:this.setState(Xi(this,t,e));this.stretch=(e,t=this.selectedIds)=>t.length<2?this:this.setState(ir(this,t,e));this.flipHorizontal=(e=this.selectedIds)=>e.length===0?this:this.setState(Zo(this,e,bt.Horizontal));this.flipVertical=(e=this.selectedIds)=>e.length===0?this:this.setState(Zo(this,e,bt.Vertical));this.moveToPage=(e,t=this.currentPageId,n=this.selectedIds)=>{if(n.length===0)return this;let{rendererBounds:o}=this;return this.setState(er(this,n,o,t,e)),this};this.moveToBack=(e=this.selectedIds)=>e.length===0?this:this.setState(cn(this,e,$e.ToBack));this.moveBackward=(e=this.selectedIds)=>e.length===0?this:this.setState(cn(this,e,$e.Backward));this.moveForward=(e=this.selectedIds)=>e.length===0?this:this.setState(cn(this,e,$e.Forward));this.moveToFront=(e=this.selectedIds)=>e.length===0?this:this.setState(cn(this,e,$e.ToFront));this.nudge=(e,t=!1,n=this.selectedIds)=>{if(n.length===0)return this;let o=t?this.settings.showGrid?this.currentGrid*4:10:this.settings.showGrid?this.currentGrid:1;return this.setState(lr(this,n,G.mul(e,o)))};this.duplicate=(e=this.selectedIds,t)=>this.readOnly?this:e.length===0?this:this.setState(Zi(this,e,t));this.resetBounds=(e=this.selectedIds)=>{let t=Jo(this,e,this.currentPageId);return this.setState(Jo(this,e,this.currentPageId),t.id)};this.toggleHidden=(e=this.selectedIds)=>e.length===0?this:this.setState(_n(this,e,"isHidden"));this.toggleLocked=(e=this.selectedIds)=>e.length===0?this:this.setState(_n(this,e,"isLocked"));this.toggleAspectRatioLocked=(e=this.selectedIds)=>e.length===0?this:this.setState(_n(this,e,"isAspectRatioLocked"));this.toggleDecoration=(e,t=this.selectedIds)=>t.length===0||!(e==="start"||e==="end")?this:this.setState(ar(this,t,e));this.setShapeProps=(e,t=this.selectedIds)=>this.setState(hr(this,t,e));this.rotate=(e=Math.PI*-.5,t=this.selectedIds)=>{if(t.length===0)return this;let n=or(this,t,e);return n?this.setState(n):this};this.group=(e=this.selectedIds,t=ce.uniqueId(),n=this.currentPageId)=>{if(this.readOnly)return this;if(e.length===1&&this.getShape(e[0],n).type===x.Group)return this.ungroup(e,n);if(e.length<2)return this;let o=qi(this,e,t,n);return o?this.setState(o):this};this.ungroup=(e=this.selectedIds,t=this.currentPageId)=>{if(this.readOnly)return this;let n=e.map(i=>this.getShape(i,t)).filter(i=>i.type===x.Group);if(n.length===0)return this;let o=cr(this,e,n,t);return o?this.setState(o):this};this.cancel=()=>{var e,t;return(t=(e=this.currentTool).onCancel)==null||t.call(e),this};this.onKeyDown=(e,t,n)=>{var o,i;switch(n.key){case"/":{if(this.status==="idle"){let{shiftKey:r,metaKey:d,altKey:a,ctrlKey:l,spaceKey:p}=this;this.onPointerDown({target:"canvas",pointerId:0,origin:t.point,point:t.point,delta:[0,0],pressure:.5,shiftKey:r,ctrlKey:l,metaKey:d,altKey:a,spaceKey:p},{shiftKey:r,altKey:a,ctrlKey:l,pointerId:0,clientX:t.point[0],clientY:t.point[1]})}break}case"Escape":{this.cancel();break}case"Meta":{this.metaKey=!0;break}case"Alt":{this.altKey=!0;break}case"Control":{this.ctrlKey=!0;break}case" ":{this.spaceKey=!0;break}}return(i=(o=this.currentTool).onKeyDown)==null||i.call(o,e,t,n),this};this.onKeyUp=(e,t,n)=>{var o,i;if(!!t){switch(n.key){case"/":{let{currentPoint:r,shiftKey:d,metaKey:a,altKey:l,ctrlKey:p,spaceKey:c}=this;this.onPointerUp({target:"canvas",pointerId:0,origin:r,point:r,delta:[0,0],pressure:.5,shiftKey:d,ctrlKey:p,metaKey:a,altKey:l,spaceKey:c},{shiftKey:d,altKey:l,ctrlKey:p,pointerId:0,clientX:r[0],clientY:r[1]});break}case"Meta":{this.metaKey=!1;break}case"Alt":{this.altKey=!1;break}case"Control":{this.ctrlKey=!1;break}case" ":{this.spaceKey=!1;break}}(i=(o=this.currentTool).onKeyUp)==null||i.call(o,e,t,n)}};this.onPinchStart=(e,t)=>{var n,o;return(o=(n=this.currentTool).onPinchStart)==null?void 0:o.call(n,e,t)};this.onPinchEnd=(e,t)=>{var n,o;return(o=(n=this.currentTool).onPinchEnd)==null?void 0:o.call(n,e,t)};this.onPinch=(e,t)=>{var n,o;return(o=(n=this.currentTool).onPinch)==null?void 0:o.call(n,e,t)};this.onPan=(e,t)=>{if(this.appState.status==="pinching")return;let n=G.div(e.delta,this.pageState.camera.zoom),o=this.pageState.camera.point,i=G.sub(o,n);G.isEqual(i,o)||(this.pan(n),!e.spaceKey&&t.buttons!==4&&this.onPointerMove(e,t))};this.onZoom=(e,t)=>{if(this.state.appState.status!==_.Idle)return;let n=t.deltaMode===WheelEvent.DOM_DELTA_PIXEL?e.delta[2]/500:t.deltaMode===WheelEvent.DOM_DELTA_LINE?e.delta[2]/100:e.delta[2]/2;this.zoomBy(n,this.centerPoint),this.onPointerMove(e,t)};this.updateInputs=e=>{this.currentPoint=[...this.getPagePoint(e.point),e.pressure],this.shiftKey=e.shiftKey,this.altKey=e.altKey,this.ctrlKey=e.ctrlKey,this.metaKey=e.metaKey};this.onPointerMove=(e,t)=>{var n,o,i,r;if(this.previousPoint=this.currentPoint,this.updateInputs(e,t),(o=(n=this.currentTool).onPointerMove)==null||o.call(n,e,t),this.state.room){let{users:d,userId:a}=this.state.room;(r=(i=this.callbacks).onChangePresence)==null||r.call(i,this,y(m({},d[a]),{point:this.getPagePoint(e.point)}))}};this.onPointerDown=(e,t)=>{var n,o;this.originPoint=this.getPagePoint(e.point),this.updateInputs(e,t),(o=(n=this.currentTool).onPointerDown)==null||o.call(n,e,t)};this.onPointerUp=(e,t)=>{var n,o;this.updateInputs(e,t),(o=(n=this.currentTool).onPointerUp)==null||o.call(n,e,t)};this.onPointCanvas=(e,t)=>{var n,o;this.updateInputs(e,t),(o=(n=this.currentTool).onPointCanvas)==null||o.call(n,e,t)};this.onDoubleClickCanvas=(e,t)=>{var n,o;this.updateInputs(e,t),(o=(n=this.currentTool).onDoubleClickCanvas)==null||o.call(n,e,t)};this.onRightPointCanvas=(e,t)=>{var n,o;this.updateInputs(e,t),(o=(n=this.currentTool).onRightPointCanvas)==null||o.call(n,e,t)};this.onDragCanvas=(e,t)=>{var n,o;this.updateInputs(e,t),(o=(n=this.currentTool).onDragCanvas)==null||o.call(n,e,t)};this.onReleaseCanvas=(e,t)=>{var n,o;this.updateInputs(e,t),(o=(n=this.currentTool).onReleaseCanvas)==null||o.call(n,e,t)};this.onPointShape=(e,t)=>{var n,o;this.originPoint=this.getPagePoint(e.point),this.updateInputs(e,t),(o=(n=this.currentTool).onPointShape)==null||o.call(n,e,t)};this.onReleaseShape=(e,t)=>{var n,o;this.updateInputs(e,t),(o=(n=this.currentTool).onReleaseShape)==null||o.call(n,e,t)};this.onDoubleClickShape=(e,t)=>{var n,o;this.originPoint=this.getPagePoint(e.point),this.updateInputs(e,t),(o=(n=this.currentTool).onDoubleClickShape)==null||o.call(n,e,t)};this.onRightPointShape=(e,t)=>{var n,o;this.originPoint=this.getPagePoint(e.point),this.updateInputs(e,t),(o=(n=this.currentTool).onRightPointShape)==null||o.call(n,e,t)};this.onDragShape=(e,t)=>{var n,o;this.updateInputs(e,t),(o=(n=this.currentTool).onDragShape)==null||o.call(n,e,t)};this.onHoverShape=(e,t)=>{var n,o;this.updateInputs(e,t),(o=(n=this.currentTool).onHoverShape)==null||o.call(n,e,t)};this.onUnhoverShape=(e,t)=>{var n,o;this.updateInputs(e,t),(o=(n=this.currentTool).onUnhoverShape)==null||o.call(n,e,t)};this.onPointBounds=(e,t)=>{var n,o;this.originPoint=this.getPagePoint(e.point),this.updateInputs(e,t),(o=(n=this.currentTool).onPointBounds)==null||o.call(n,e,t)};this.onDoubleClickBounds=(e,t)=>{var n,o;this.originPoint=this.getPagePoint(e.point),this.updateInputs(e,t),(o=(n=this.currentTool).onDoubleClickBounds)==null||o.call(n,e,t)};this.onRightPointBounds=(e,t)=>{var n,o;this.originPoint=this.getPagePoint(e.point),this.updateInputs(e,t),(o=(n=this.currentTool).onRightPointBounds)==null||o.call(n,e,t)};this.onDragBounds=(e,t)=>{var n,o;this.updateInputs(e,t),(o=(n=this.currentTool).onDragBounds)==null||o.call(n,e,t)};this.onHoverBounds=(e,t)=>{var n,o;this.updateInputs(e,t),(o=(n=this.currentTool).onHoverBounds)==null||o.call(n,e,t)};this.onUnhoverBounds=(e,t)=>{var n,o;this.updateInputs(e,t),(o=(n=this.currentTool).onUnhoverBounds)==null||o.call(n,e,t)};this.onReleaseBounds=(e,t)=>{var n,o;this.updateInputs(e,t),(o=(n=this.currentTool).onReleaseBounds)==null||o.call(n,e,t)};this.onPointBoundsHandle=(e,t)=>{var n,o;this.originPoint=this.getPagePoint(e.point),this.updateInputs(e,t),(o=(n=this.currentTool).onPointBoundsHandle)==null||o.call(n,e,t)};this.onDoubleClickBoundsHandle=(e,t)=>{var n,o;this.originPoint=this.getPagePoint(e.point),this.updateInputs(e,t),(o=(n=this.currentTool).onDoubleClickBoundsHandle)==null||o.call(n,e,t)};this.onRightPointBoundsHandle=(e,t)=>{var n,o;this.originPoint=this.getPagePoint(e.point),this.updateInputs(e,t),(o=(n=this.currentTool).onRightPointBoundsHandle)==null||o.call(n,e,t)};this.onDragBoundsHandle=(e,t)=>{var n,o;this.updateInputs(e,t),(o=(n=this.currentTool).onDragBoundsHandle)==null||o.call(n,e,t)};this.onHoverBoundsHandle=(e,t)=>{var n,o;this.updateInputs(e,t),(o=(n=this.currentTool).onHoverBoundsHandle)==null||o.call(n,e,t)};this.onUnhoverBoundsHandle=(e,t)=>{var n,o;this.updateInputs(e,t),(o=(n=this.currentTool).onUnhoverBoundsHandle)==null||o.call(n,e,t)};this.onReleaseBoundsHandle=(e,t)=>{var n,o;this.updateInputs(e,t),(o=(n=this.currentTool).onReleaseBoundsHandle)==null||o.call(n,e,t)};this.onPointHandle=(e,t)=>{var n,o;this.originPoint=this.getPagePoint(e.point),this.updateInputs(e,t),(o=(n=this.currentTool).onPointHandle)==null||o.call(n,e,t)};this.onDoubleClickHandle=(e,t)=>{var n,o;this.originPoint=this.getPagePoint(e.point),this.updateInputs(e,t),(o=(n=this.currentTool).onDoubleClickHandle)==null||o.call(n,e,t)};this.onRightPointHandle=(e,t)=>{var n,o;this.originPoint=this.getPagePoint(e.point),this.updateInputs(e,t),(o=(n=this.currentTool).onRightPointHandle)==null||o.call(n,e,t)};this.onDragHandle=(e,t)=>{var n,o;this.updateInputs(e,t),(o=(n=this.currentTool).onDragHandle)==null||o.call(n,e,t)};this.onHoverHandle=(e,t)=>{var n,o;this.updateInputs(e,t),(o=(n=this.currentTool).onHoverHandle)==null||o.call(n,e,t)};this.onUnhoverHandle=(e,t)=>{var n,o;this.updateInputs(e,t),(o=(n=this.currentTool).onUnhoverHandle)==null||o.call(n,e,t)};this.onReleaseHandle=(e,t)=>{var n,o;this.updateInputs(e,t),(o=(n=this.currentTool).onReleaseHandle)==null||o.call(n,e,t)};this.onShapeChange=e=>{this.updateShapes(e)};this.onShapeBlur=()=>{var n,o;if(Date.now()-this.editingStartTime<50)return;let{editingId:e}=this.pageState,{isToolLocked:t}=this.getAppState();if(e){let i=this.getShape(e);this.setEditingId(),i.type===x.Text&&(i.text.trim().length<=0?this.patchState(_o(this,[e]).after,"delete_empty_text"):t||this.select(e))}(o=(n=this.currentTool).onShapeBlur)==null||o.call(n)};this.onShapeClone=(e,t)=>{var n,o;this.originPoint=this.getPagePoint(e.point),this.updateInputs(e,t),(o=(n=this.currentTool).onShapeClone)==null||o.call(n,e,t)};this.onRenderCountChange=e=>{let t=this.getAppState();t.isEmptyCanvas&&e.length>0?this.patchState({appState:{isEmptyCanvas:!1}},"empty_canvas:false"):!t.isEmptyCanvas&&e.length<=0&&this.patchState({appState:{isEmptyCanvas:!0}},"empty_canvas:true")};this.onError=()=>{};this.getShapeUtil=I.getShapeUtil;this.callbacks=t}setStatus(e){return this.patchState({appState:{status:e}},`set_status:${e}`)}get history(){return this.stack.slice(0,this.pointer+1)}set history(e){this.replaceHistory(e)}get document(){return this.state.document}get settings(){return this.state.settings}get appState(){return this.state.appState}get currentPageId(){return this.state.appState.currentPageId}get page(){return this.state.document.pages[this.currentPageId]}get shapes(){return Object.values(this.page.shapes)}get bindings(){return Object.values(this.page.bindings)}get pageState(){return this.state.document.pageStates[this.currentPageId]}get selectedIds(){return this.pageState.selectedIds}createTextShapeAtPoint(e,t){let{shapes:n,appState:{currentPageId:o,currentStyle:i}}=this,r=n.length===0?1:n.filter(p=>p.parentId===o).sort((p,c)=>c.childIndex-p.childIndex)[0].childIndex+1,d=mt[x.Text],a=d.create({id:t||ce.uniqueId(),parentId:o,childIndex:r,point:e,style:m({},i)}),l=d.getBounds(a);return a.point=G.sub(a.point,[l.width/2,l.height/2]),this.createShapes(a),this.setEditingId(a.id),this}isSelected(e){return this.selectedIds.includes(e)}get room(){return this.state.room}get isLocal(){return this.state.room===void 0||this.state.room.id==="local"}get status(){return this.appState.status}get currentUser(){if(!!this.state.room)return this.state.room.users[this.state.room.userId]}get centerPoint(){let{width:e,height:t}=this.rendererBounds;return G.toFixed([e/2,t/2])}get currentGrid(){let{zoom:e}=this.pageState.camera;return e<.15?ct*16:e<1?ct*4:ct*1}},vt=ve;vt.version=14,vt.defaultDocument={id:"doc",name:"New Document",version:14,pages:{page:{id:"page",name:"Page 1",childIndex:1,shapes:{},bindings:{}}},pageStates:{page:{id:"page",selectedIds:[],camera:{point:[0,0],zoom:1}}}},vt.defaultState={settings:{isPenMode:!1,isDarkMode:!1,isZoomSnap:!1,isFocusMode:!1,isSnapping:!1,isDebugMode:!1,isReadonlyMode:!1,nudgeDistanceLarge:16,nudgeDistanceSmall:1,showRotateHandles:!0,showBindingHandles:!0,showCloneHandles:!1,showGrid:!1},appState:{status:_.Idle,activeTool:"select",hoveredId:void 0,currentPageId:"page",currentStyle:Be,isToolLocked:!1,isMenuOpen:!1,isEmptyCanvas:!1,snapLines:[]},document:ve.defaultDocument};var IC={select:gn,erase:fn,[x.Text]:Sn,[x.Draw]:Tn,[x.Ellipse]:yn,[x.Rectangle]:bn,[x.Line]:In,[x.Arrow]:wn,[x.Sticky]:xn};import{useCallback as Al}from"react";import{useHotkeys as U}from"react-hotkeys-hook";function us(s){let e=K(),t=Al((d=!1)=>{let a=s.current;return d&&e.isMenuOpen()?!0:a&&(document.activeElement===a||a.contains(document.activeElement))},[s]);U("v,1",()=>{!t(!0)||e.selectTool("select")},[e,s.current]),U("d,p,2",()=>{!t(!0)||e.selectTool(x.Draw)},void 0,[e]),U("e,3",()=>{!t(!0)||e.selectTool("erase")},void 0,[e]),U("r,4",()=>{!t(!0)||e.selectTool(x.Rectangle)},void 0,[e]),U("o,5",()=>{!t(!0)||e.selectTool(x.Ellipse)},void 0,[e]),U("l,6",()=>{!t(!0)||e.selectTool(x.Line)},void 0,[e]),U("a,7",()=>{!t(!0)||e.selectTool(x.Arrow)},void 0,[e]),U("t,8",()=>{!t(!0)||e.selectTool(x.Text)},void 0,[e]),U("s,9",()=>{!t(!0)||e.selectTool(x.Sticky)},void 0,[e]),U("ctrl+shift+d,\u2318+shift+d",d=>{!t(!0)||(e.toggleDarkMode(),d.preventDefault())},void 0,[e]),U("ctrl+.,\u2318+.",()=>{!t(!0)||e.toggleFocusMode()},void 0,[e]),U("ctrl+shift+g,\u2318+shift+g",()=>{!t(!0)||e.toggleGrid()},void 0,[e]);let{onNewProject:n,onOpenProject:o,onSaveProject:i,onSaveProjectAs:r}=Yn();U("ctrl+n,\u2318+n",d=>{!t()||n(d)},void 0,[e]),U("ctrl+s,\u2318+s",d=>{!t()||i(d)},void 0,[e]),U("ctrl+shift+s,\u2318+shift+s",d=>{!t()||r(d)},void 0,[e]),U("ctrl+o,\u2318+o",d=>{!t()||o(d)},void 0,[e]),U("\u2318+z,ctrl+z",()=>{!t(!0)||(e.session?e.cancelSession():e.undo())},void 0,[e]),U("ctrl+shift-z,\u2318+shift+z",()=>{!t(!0)||(e.session?e.cancelSession():e.redo())},void 0,[e]),U("\u2318+u,ctrl+u",()=>{!t()||e.undoSelect()},void 0,[e]),U("ctrl+shift-u,\u2318+shift+u",()=>{!t()||e.redoSelect()},void 0,[e]),U("ctrl+=,\u2318+=,ctrl+num_subtract,\u2318+num_subtract",d=>{!t(!0)||(e.zoomIn(),d.preventDefault())},void 0,[e]),U("ctrl+-,\u2318+-,ctrl+num_add,\u2318+num_add",d=>{!t(!0)||(e.zoomOut(),d.preventDefault())},void 0,[e]),U("shift+0,ctrl+numpad_0,\u2318+numpad_0",()=>{!t(!0)||e.resetZoom()},void 0,[e]),U("shift+1",()=>{!t(!0)||e.zoomToFit()},void 0,[e]),U("shift+2",()=>{!t(!0)||e.zoomToSelection()},void 0,[e]),U("ctrl+d,\u2318+d",d=>{!t()||(e.duplicate(),d.preventDefault())},void 0,[e]),U("shift+h",()=>{!t(!0)||e.flipHorizontal()},void 0,[e]),U("shift+v",()=>{!t(!0)||e.flipVertical()},void 0,[e]),U("escape",()=>{!t(!0)||e.cancel()},void 0,[e]),U("backspace,del",()=>{!t()||e.delete()},void 0,[e]),U("\u2318+a,ctrl+a",()=>{!t(!0)||e.selectAll()},void 0,[e]),U("up",()=>{!t()||e.nudge([0,-1],!1)},void 0,[e]),U("right",()=>{!t()||e.nudge([1,0],!1)},void 0,[e]),U("down",()=>{!t()||e.nudge([0,1],!1)},void 0,[e]),U("left",()=>{!t()||e.nudge([-1,0],!1)},void 0,[e]),U("shift+up",()=>{!t()||e.nudge([0,-1],!0)},void 0,[e]),U("shift+right",()=>{!t()||e.nudge([1,0],!0)},void 0,[e]),U("shift+down",()=>{!t()||e.nudge([0,1],!0)},void 0,[e]),U("shift+left",()=>{!t()||e.nudge([-1,0],!0)},void 0,[e]),U("\u2318+shift+l,ctrl+shift+l",()=>{!t()||e.toggleLocked()},void 0,[e]),U("\u2318+c,ctrl+c",()=>{!t()||e.copy()},void 0,[e]),U("\u2318+x,ctrl+x",()=>{!t()||e.cut()},void 0,[e]),U("\u2318+v,ctrl+v",()=>{!t()||e.paste()},void 0,[e]),U("\u2318+g,ctrl+g",d=>{!t()||(e.group(),d.preventDefault())},void 0,[e]),U("\u2318+shift+g,ctrl+shift+g",d=>{!t()||(e.ungroup(),d.preventDefault())},void 0,[e]),U("[",()=>{!t(!0)||e.moveBackward()},void 0,[e]),U("]",()=>{!t(!0)||e.moveForward()},void 0,[e]),U("shift+[",()=>{!t(!0)||e.moveToBack()},void 0,[e]),U("shift+]",()=>{!t(!0)||e.moveToFront()},void 0,[e]),U("ctrl+shift+backspace,\u2318+shift+backspace",d=>{!t()||(e.settings.isDebugMode&&e.resetDocument(),d.preventDefault())},void 0,[e]),U("alt+command+l,alt+ctrl+l",d=>{!t(!0)||(e.style({textAlign:N.Start}),d.preventDefault())},void 0,[e]),U("alt+command+t,alt+ctrl+t",d=>{!t(!0)||(e.style({textAlign:N.Middle}),d.preventDefault())},void 0,[e]),U("alt+command+r,alt+ctrl+r",d=>{!t(!0)||(e.style({textAlign:N.End}),d.preventDefault())},void 0,[e])}import{createContext as Ol,useContext as Fl}from"react";var Zn=Ol({});function K(){return Fl(Zn)}import{useLayoutEffect as Ul}from"react";var ms=new Map,Cn="Tldraw-fonts",Ir=`
@import url('https://fonts.googleapis.com/css2?family=Caveat+Brush&family=Source+Code+Pro&family=Source+Sans+Pro&family=Source+Serif+Pro&display=swap');
`;function gs(){Ul(()=>{if(ms.get(Cn))return;let s=document.createElement("style");return s.innerHTML=Ir,s.setAttribute("id",Cn),document.head.appendChild(s),ms.set(Cn,s),()=>{s&&document.head.contains(s)&&(document.head.removeChild(s),ms.delete(Cn))}},[Cn,Ir])}import{useCallback as Jn}from"react";function Yn(){let s=K(),e=Jn(i=>he(this,null,function*(){var r,d;i&&s.callbacks.onOpenProject&&i.preventDefault(),(d=(r=s.callbacks).onNewProject)==null||d.call(r,s)}),[s]),t=Jn(i=>{var r,d;i&&s.callbacks.onOpenProject&&i.preventDefault(),(d=(r=s.callbacks).onSaveProject)==null||d.call(r,s)},[s]),n=Jn(i=>{var r,d;i&&s.callbacks.onOpenProject&&i.preventDefault(),(d=(r=s.callbacks).onSaveProjectAs)==null||d.call(r,s)},[s]),o=Jn(i=>he(this,null,function*(){var r,d;i&&s.callbacks.onOpenProject&&i.preventDefault(),(d=(r=s.callbacks).onOpenProject)==null||d.call(r,s)}),[s]);return{onNewProject:e,onSaveProject:t,onSaveProjectAs:n,onOpenProject:o}}import{useCallback as Pn}from"react";function zl(){let s=Pn(i=>he(this,null,function*(){i.isDirty&&(i.fileSystemHandle?window.confirm("Do you want to save changes to your current project?")&&(yield i.saveProject()):window.confirm("Do you want to save your current project?")&&(yield i.saveProject()))}),[]),e=Pn(i=>he(this,null,function*(){window.confirm("Do you want to create a new project?")&&(yield s(i),i.newProject())}),[s]),t=Pn(i=>{i.saveProject()},[]),n=Pn(i=>{i.saveProjectAs()},[]),o=Pn(i=>he(this,null,function*(){yield s(i),i.openProject()}),[s]);return{onNewProject:e,onSaveProject:t,onSaveProjectAs:n,onOpenProject:o}}import{createElement as St,memo as Pp}from"react";import{createElement as xr}from"react";var ye={"@initial":"mobile","@micro":"micro","@sm":"small","@md":"medium","@lg":"large"};var jl=s=>s.appState.status,Gl=s=>s.appState.activeTool;function wr(){let s=K(),e=s.useStore(jl),t=s.useStore(Gl);return xr($l,{bp:ye},xr(Kl,null,t," | ",e))}var $l=D("div",{height:40,userSelect:"none",borderTop:"1px solid $panelContrast",gridArea:"status",display:"flex",color:"$text",justifyContent:"space-between",alignItems:"center",backgroundColor:"$panel",gap:8,fontFamily:"$ui",fontSize:"$0",padding:"0 16px",variants:{bp:{small:{fontSize:"$1"}}}}),Kl=D("div",{whiteSpace:"nowrap",overflow:"hidden"});import{createElement as vr,memo as ec}from"react";import{ItemIndicator as _l}from"@radix-ui/react-dropdown-menu";import{ChevronRightIcon as Xl,CheckIcon as Yl}from"@radix-ui/react-icons";import{createElement as Dt,forwardRef as Jl}from"react";import{createElement as Cr}from"react";import{Utils as Vl}from"@tldraw/core";var Wl=()=>Vl.isDarwin()?"\u2318":"Ctrl";function qn({variant:s,children:e}){return Cr(Nl,{variant:s},e.split("").map((t,n)=>Cr("span",{key:n},t.replace("#",Wl()))))}var Nl=D("kbd",{marginLeft:"$3",textShadow:"$2",textAlign:"center",fontSize:"$0",fontFamily:"$ui",color:"$text",background:"none",fontWeight:400,gap:"$1",display:"flex",alignItems:"center","& > span":{padding:"$0",borderRadius:"$0",display:"flex",alignItems:"center",justifyContent:"center"},variants:{variant:{tooltip:{"& > span":{color:"$tooltipContrast",background:"$overlayContrast",boxShadow:"$key",width:"20px",height:"20px"}},menu:{}}}});var Ae=D("div",{height:"100%",borderRadius:"4px",marginRight:"1px",width:"fit-content",display:"grid",alignItems:"center",justifyContent:"center",outline:"none",border:"none",pointerEvents:"all",cursor:"pointer",color:"currentColor","& svg":{height:16,width:16,strokeWidth:1},"& > *":{gridRow:1,gridColumn:1}});var be=Jl((h,c)=>{var u=h,{onClick:s,isActive:e=!1,isWarning:t=!1,hasIndicator:n=!1,hasArrow:o=!1,disabled:i=!1,isSponsor:r=!1,variant:d,kbd:a,children:l}=u,p=Se(u,["onClick","isActive","isWarning","hasIndicator","hasArrow","disabled","isSponsor","variant","kbd","children"]);return Dt(Zl,m({ref:c,bp:ye,isWarning:t,isActive:e,isSponsor:r,disabled:i,onClick:s,variant:d},p),Dt(Qn,null,l,a?Dt(qn,{variant:"menu"},a):void 0,n&&Dt(_l,{dir:"ltr"},Dt(Ae,null,Dt(Yl,null))),o&&Dt(Ae,null,Dt(Xl,null))))}),Qn=D("div",{height:"100%",width:"100%",backgroundColor:"$panel",borderRadius:"$2",display:"flex",gap:"$1",flexDirection:"row",alignItems:"center",padding:"0 $3",justifyContent:"space-between",border:"1px solid transparent","& svg":{position:"relative",stroke:"$overlay",strokeWidth:1,zIndex:1}}),Zl=D("button",{position:"relative",width:"100%",background:"none",border:"none",cursor:"pointer",height:"32px",outline:"none",color:"$text",fontFamily:"$ui",fontWeight:400,fontSize:"$1",borderRadius:4,userSelect:"none",margin:0,padding:"0 0","&[data-disabled]":{opacity:.3},"&:disabled":{opacity:.3},[`&:focus:not(:disabled) ${Qn}`]:{backgroundColor:"$hover"},"& a":{textDecoration:"none",color:"$text"},variants:{bp:{mobile:{},small:{}},variant:{styleMenu:{margin:"$1 0 $1 0"},wide:{gridColumn:"1 / span 4"}},size:{icon:{padding:"4px ",width:"auto"}},isSponsor:{true:{color:"#eb30a2"},false:{}},isWarning:{true:{color:"$warn"}},isActive:{true:{backgroundColor:"$hover"},false:{}}},compoundVariants:[{isActive:!1,isSponsor:!0,bp:"small",css:{[`&:hover:not(:disabled) ${Qn}`]:{backgroundColor:"$sponsorContrast",border:"1px solid $panel",'& *[data-shy="true"]':{opacity:1}}}},{isActive:!1,isSponsor:!1,bp:"small",css:{[`&:hover:not(:disabled) ${Qn}`]:{backgroundColor:"$hover",border:"1px solid $panel",'& *[data-shy="true"]':{opacity:1}}}}]});var Ye=D("div",{position:"relative",overflow:"hidden",userSelect:"none",display:"flex",flexDirection:"column",zIndex:180,minWidth:180,pointerEvents:"all",backgroundColor:"$panel",boxShadow:"$panel",padding:"$2 $2",borderRadius:"$3",font:"$ui"});var ql=s=>Object.keys(s.document.pages[s.appState.currentPageId].shapes).length>0&&s.appState.isEmptyCanvas,Pr=ec(function(){let e=K();return e.useStore(ql)?vr(Ql,null,vr(be,{onClick:e.zoomToContent},"Back to content")):null}),Ql=D(Ye,{pointerEvents:"all",width:"fit-content",minWidth:0,gridRow:1,flexGrow:2,display:"block"});import{createElement as Oe,memo as Bc,useCallback as Jt}from"react";import{ArrowTopRightIcon as Ic,CursorArrowIcon as wc,Pencil1Icon as xc,Pencil2Icon as Cc,TextIcon as Pc}from"@radix-ui/react-icons";import{createElement as vn,forwardRef as lc,useCallback as cc}from"react";import{Arrow as rc,Content as ic,Root as oc,Trigger as sc}from"@radix-ui/react-tooltip";import{createElement as Zt}from"react";function Ie({children:s,label:e,kbd:t,side:n="top"}){return Zt(oc,null,Zt(sc,{dir:"ltr",asChild:!0},Zt("span",null,s)),Zt(tc,{dir:"ltr",side:n,sideOffset:8},e,t?Zt(qn,{variant:"tooltip"},t):null,Zt(nc,null)))}var tc=D(ic,{borderRadius:3,padding:"$3 $3 $3 $3",fontSize:"$1",backgroundColor:"$tooltip",color:"$tooltipContrast",boxShadow:"$3",display:"flex",alignItems:"center",fontFamily:"$ui",userSelect:"none"}),nc=D(rc,{fill:"$tooltip",margin:"0 8px"});var V=lc((c,p)=>{var h=c,{onSelect:s,onClick:e,onDoubleClick:t,variant:n,children:o,isToolLocked:i=!1,disabled:r=!1,isActive:d=!1,isSponsor:a=!1}=h,l=Se(h,["onSelect","onClick","onDoubleClick","variant","children","isToolLocked","disabled","isActive","isSponsor"]);return vn(ac,m({ref:p,isActive:d,isSponsor:a,variant:n,onClick:e,disabled:r,onPointerDown:s,onDoubleClick:t,bp:ye},l),vn(Ke,null,o),i&&vn(dc,null))});function Lt(o){var i=o,{label:s,kbd:e,isLocked:t}=i,n=Se(i,["label","kbd","isLocked"]);let r=K(),d=cc(()=>{r.toggleToolLock()},[]);return vn(Ie,{label:s[0].toUpperCase()+s.slice(1),kbd:e},vn(V,y(m({},n),{variant:"primary",isToolLocked:t&&n.isActive,onDoubleClick:d})))}var Ke=D("div",{position:"relative",height:"100%",width:"100%",backgroundColor:"$panel",borderRadius:"$2",margin:"0",display:"flex",alignItems:"center",justifyContent:"center",fontFamily:"$ui",color:"inherit",userSelect:"none",boxSizing:"border-box",border:"1px solid transparent"}),ac=D("button",{position:"relative",color:"$text",fontSize:"$0",background:"none",margin:"0",padding:"$2",display:"flex",alignItems:"center",justifyContent:"center",outline:"none",cursor:"pointer",pointerEvents:"all",border:"none",height:"40px",width:"40px",[`&:disabled ${Ke}`]:{opacity:.618},variants:{variant:{primary:{marginTop:"0"},icon:{[`& ${Ke}`]:{display:"grid","& > *":{gridRow:1,gridColumn:1}}},text:{width:"auto",[`& ${Ke}`]:{fontSize:"$1",padding:"0 $3",gap:"$3"}},circle:{padding:"$2",[`& ${Ke}`]:{border:"1px solid $panelContrast",borderRadius:"100%",boxShadow:"$panel"},[`& ${Ke} > svg`]:{width:14,height:14}}},isSponsor:{true:{[`${Ke}`]:{backgroundColor:"$sponsorContrast"}}},isActive:{true:{},false:{}},bp:{mobile:{},small:{}}},compoundVariants:[{variant:"primary",bp:"mobile",css:{height:"40px",width:"40px",[`& ${Ke} > svg`]:{width:16,height:16}}},{variant:"primary",bp:"small",css:{height:"44px",width:"44px",[`& ${Ke} > svg`]:{width:20,height:20}}},{isActive:!0,isSponsor:!1,css:{[`${Ke}`]:{backgroundColor:"$selected",color:"$selectedContrast"}}},{isActive:!1,isSponsor:!1,bp:"small",css:{[`&:hover:not(:disabled) ${Ke}`]:{backgroundColor:"$hover",border:"1px solid $panel"},[`&:focus:not(:disabled) ${Ke}`]:{backgroundColor:"$hover"}}}]}),dc=D("div",{position:"absolute",width:10,height:10,backgroundColor:"$selected",borderRadius:"100%",bottom:-2,border:"2px solid $panel",zIndex:100});var Mt=D("div",{backgroundColor:"$panel",display:"flex",flexDirection:"row",boxShadow:"$panel",padding:"$2",border:"1px solid $panelContrast",gap:0,variants:{side:{center:{borderRadius:"$4"},left:{padding:0,borderTop:0,borderLeft:0,borderTopRightRadius:"$1",borderBottomRightRadius:"$3",borderBottomLeftRadius:"$1"},right:{padding:0,borderTop:0,borderRight:0,borderTopLeftRadius:"$1",borderBottomLeftRadius:"$3",borderBottomRightRadius:"$1"}}}});import{createElement as Ze,memo as mc,useCallback as ea,useEffect as fc,useState as gc}from"react";import{Content as yc,Item as bc,Root as Sc,Trigger as Tc}from"@radix-ui/react-dropdown-menu";import{SquareIcon as hc,CircleIcon as uc}from"@radix-ui/react-icons";import{createElement as ov}from"react";import{createElement as Dr}from"react";function fs(s){let n=s,{size:e=16}=n,t=Se(n,["size"]);return Dr("svg",m({width:24,height:24},t),Dr("circle",{cx:12,cy:12,r:e/2}))}import{createElement as kr}from"react";function Br(){return kr("svg",{width:"24",height:"24",stroke:"currentColor",xmlns:"http://www.w3.org/2000/svg"},kr("circle",{cx:12,cy:12,r:8,fill:"none",strokeWidth:2.5,strokeLinecap:"round",strokeDasharray:50.26548*.1}))}import{createElement as Er}from"react";var pc=`${50.26548*.025} ${50.26548*.1}`;function Rr(){return Er("svg",{width:"24",height:"24",stroke:"currentColor",xmlns:"http://www.w3.org/2000/svg"},Er("circle",{cx:12,cy:12,r:8,fill:"none",strokeWidth:2.5,strokeLinecap:"round",strokeDasharray:pc}))}import{createElement as Mr}from"react";function Lr(){return Mr("svg",{width:"24",height:"24",viewBox:"1 1.5 21 22",fill:"currentColor",stroke:"currentColor",xmlns:"http://www.w3.org/2000/svg"},Mr("path",{d:"M10.0162 19.2768C10.0162 19.2768 9.90679 19.2517 9.6879 19.2017C9.46275 19.1454 9.12816 19.0422 8.68413 18.8921C8.23384 18.7358 7.81482 18.545 7.42707 18.3199C7.03307 18.101 6.62343 17.7883 6.19816 17.3818C5.77289 16.9753 5.33511 16.3718 4.88482 15.5713C4.43453 14.7645 4.1531 13.8545 4.04053 12.8414C3.92795 11.822 4.04991 10.8464 4.40639 9.91451C4.76286 8.98266 5.39452 8.10084 6.30135 7.26906C7.21444 6.44353 8.29325 5.83377 9.5378 5.43976C10.7823 5.05202 11.833 4.92068 12.6898 5.04576C13.5466 5.16459 14.3878 5.43664 15.2133 5.86191C16.0388 6.28718 16.7768 6.8688 17.4272 7.60678C18.0714 8.34475 18.5404 9.21406 18.8344 10.2147C19.1283 11.2153 19.1721 12.2598 18.9657 13.348C18.7593 14.4299 18.2872 15.4337 17.5492 16.3593C16.8112 17.2849 15.9263 18.0072 14.8944 18.5263C13.8624 19.0391 12.9056 19.3174 12.0238 19.3612C11.142 19.405 10.2101 19.2705 9.22823 18.9578C8.24635 18.6451 7.35828 18.151 6.56402 17.4756C5.77601 16.8002 6.08871 16.8658 7.50212 17.6726C8.90927 18.4731 10.1444 18.8484 11.2076 18.7983C12.2645 18.7545 13.2965 18.4825 14.3034 17.9822C15.3102 17.4819 16.1264 16.8221 16.7518 16.0028C17.3772 15.1835 17.7681 14.3111 17.9244 13.3855C18.0808 12.4599 18.0401 11.5781 17.8025 10.74C17.5586 9.902 17.1739 9.15464 16.6486 8.49797C16.1233 7.8413 15.2289 7.27844 13.9656 6.80939C12.7086 6.34034 11.4203 6.20901 10.1007 6.41539C8.78732 6.61552 7.69599 7.06893 6.82669 7.77564C5.96363 8.48859 5.34761 9.26409 4.97863 10.1021C4.60964 10.9402 4.45329 11.8376 4.50958 12.7945C4.56586 13.7513 4.79101 14.6238 5.18501 15.4118C5.57276 16.1998 5.96363 16.8002 6.35764 17.2129C6.75164 17.6257 7.13313 17.9509 7.50212 18.1886C7.87736 18.4325 8.28074 18.642 8.71227 18.8171C9.15005 18.9922 9.47839 19.111 9.69728 19.1736C9.91617 19.2361 10.0256 19.2705 10.0256 19.2768H10.0162Z",strokeWidth:"2"}))}import{createElement as Ar}from"react";function Hr(){return Ar("svg",{width:"24",height:"24",stroke:"currentColor",xmlns:"http://www.w3.org/2000/svg"},Ar("circle",{cx:12,cy:12,r:8,fill:"none",strokeWidth:2,strokeLinecap:"round"}))}import{createElement as fv}from"react";import{createElement as Fr}from"react";function Or(s){return Fr("svg",m({width:32,height:32,viewBox:"0 0 15 15",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg"},s),Fr("path",{d:"M4.32978 8.5081C4.32978 10.1923 5.70009 11.5625 7.38418 11.5625H8.46539C8.64456 11.5625 8.78975 11.4173 8.78975 11.2382V11.13C8.78975 10.9508 8.64457 10.8057 8.46539 10.8057H7.38418C6.11736 10.8057 5.08662 9.77492 5.08662 8.5081C5.08662 7.24128 6.11736 6.21054 7.38418 6.21054H9.37894L8.00515 7.58433C7.8576 7.73183 7.8576 7.97195 8.00515 8.11944C8.14833 8.26251 8.39751 8.2623 8.54036 8.11944L10.56 6.09971C10.6315 6.02824 10.6709 5.93321 10.6709 5.8321C10.6709 5.73106 10.6315 5.63598 10.56 5.56454L8.54025 3.54472C8.3974 3.40176 8.14801 3.40176 8.00513 3.54472C7.85758 3.69218 7.85758 3.93234 8.00513 4.07979L9.37892 5.45368H7.38418C5.70009 5.45368 4.32978 6.82393 4.32978 8.5081Z"}))}import{createElement as eo}from"react";function Ur(s){return eo("svg",m({width:18,height:18,viewBox:"0 0 15 15",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg"},s),eo("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M2 4.656a.5.5 0 01.5-.5h9.7a.5.5 0 010 1H2.5a.5.5 0 01-.5-.5z"}),eo("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M6.272 3a.578.578 0 00-.578.578v.578h3.311v-.578A.578.578 0 008.428 3H6.272zm3.733 1.156v-.578A1.578 1.578 0 008.428 2H6.272a1.578 1.578 0 00-1.578 1.578v.578H3.578a.5.5 0 00-.5.5V12.2a1.578 1.578 0 001.577 1.578h5.39a1.578 1.578 0 001.577-1.578V4.656a.5.5 0 00-.5-.5h-1.117zm-5.927 1V12.2a.578.578 0 00.577.578h5.39a.578.578 0 00.577-.578V5.156H4.078z"}),eo("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M6.272 6.85a.5.5 0 01.5.5v3.233a.5.5 0 11-1 0V7.35a.5.5 0 01.5-.5zM8.428 6.85a.5.5 0 01.5.5v3.233a.5.5 0 11-1 0V7.35a.5.5 0 01.5-.5z"}))}import{createElement as jr}from"react";function zr(s){return jr("svg",m({width:32,height:32,viewBox:"0 0 15 15",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg"},s),jr("path",{d:"M10.6707 8.5081C10.6707 10.1923 9.3004 11.5625 7.61631 11.5625H6.5351C6.35593 11.5625 6.21074 11.4173 6.21074 11.2382V11.13C6.21074 10.9508 6.35591 10.8057 6.5351 10.8057H7.61631C8.88313 10.8057 9.91387 9.77492 9.91387 8.5081C9.91387 7.24128 8.88313 6.21054 7.61631 6.21054H5.62155L6.99534 7.58433C7.14289 7.73183 7.14289 7.97195 6.99534 8.11944C6.85216 8.26251 6.60298 8.2623 6.46013 8.11944L4.44045 6.09971C4.36898 6.02824 4.32959 5.93321 4.32959 5.8321C4.32959 5.73106 4.36898 5.63598 4.44045 5.56454L6.46024 3.54472C6.60309 3.40176 6.85248 3.40176 6.99535 3.54472C7.14291 3.69218 7.14291 3.93234 6.99535 4.07979L5.62156 5.45368H7.61631C9.3004 5.45368 10.6707 6.82393 10.6707 8.5081Z"}))}import{createElement as $r}from"react";function Gr(s){return $r("svg",m({width:24,height:24,viewBox:"-2 -2 28 28",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg"},s),$r("path",{d:"M12.4239 4.62C13.3572 4.62 14.1572 4.73333 14.8239 4.96C15.4906 5.17333 15.9772 5.43333 16.2839 5.74C16.3639 5.82 16.4039 5.94 16.4039 6.1V8.86H14.0639C13.9172 8.86 13.8439 8.78666 13.8439 8.64V7.26C13.4306 7.12666 12.9572 7.06 12.4239 7.06C11.6506 7.06 11.0639 7.18 10.6639 7.42C10.2639 7.66 10.0639 8.04666 10.0639 8.58V9C10.0639 9.38666 10.1639 9.69333 10.3639 9.92C10.5772 10.1333 11.0306 10.3467 11.7239 10.56L13.6439 11.14C14.4706 11.38 15.1172 11.66 15.5839 11.98C16.0506 12.3 16.3772 12.68 16.5639 13.12C16.7639 13.5467 16.8639 14.0733 16.8639 14.7V15.62C16.8639 16.7933 16.4039 17.7133 15.4839 18.38C14.5639 19.0467 13.2839 19.38 11.6439 19.38C10.6706 19.38 9.79723 19.2867 9.0239 19.1C8.2639 18.9133 7.71056 18.6533 7.3639 18.32C7.3239 18.28 7.29056 18.24 7.2639 18.2C7.25056 18.1467 7.2439 18.06 7.2439 17.94V15.74H7.6239C8.2239 16.1533 8.85056 16.4533 9.5039 16.64C10.1572 16.8267 10.9306 16.92 11.8239 16.92C12.6506 16.92 13.2506 16.7867 13.6239 16.52C14.0106 16.2533 14.2039 15.9333 14.2039 15.56V14.88C14.2039 14.6667 14.1639 14.48 14.0839 14.32C14.0172 14.16 13.8706 14.0133 13.6439 13.88C13.4172 13.7467 13.0572 13.6067 12.5639 13.46L10.6639 12.88C9.7839 12.6133 9.11056 12.3 8.6439 11.94C8.17723 11.58 7.85056 11.18 7.6639 10.74C7.49056 10.3 7.4039 9.83333 7.4039 9.34V8.38C7.4039 7.64666 7.61056 7 8.0239 6.44C8.43723 5.88 9.01723 5.44 9.7639 5.12C10.5239 4.78666 11.4106 4.62 12.4239 4.62Z"}))}import{createElement as Vr}from"react";function Kr(s){return Vr("svg",m({width:24,height:24,viewBox:"-2 -2 28 28",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg"},s),Vr("path",{d:"M8.16191 19H5.68191C5.53525 19 5.46191 18.9267 5.46191 18.78V5H8.76191C8.88191 5 8.97525 5.03333 9.04191 5.1C9.10858 5.15333 9.17525 5.27333 9.24191 5.46C9.72191 6.59333 10.1686 7.7 10.5819 8.78C11.0086 9.84667 11.4352 10.98 11.8619 12.18H12.1619C12.6019 10.9667 13.0352 9.79333 13.4619 8.66C13.8886 7.52667 14.3552 6.30667 14.8619 5H18.3219C18.4686 5 18.5419 5.07333 18.5419 5.22V19H16.0619C15.9152 19 15.8419 18.9267 15.8419 18.78V16.26C15.8419 15.5267 15.8486 14.8133 15.8619 14.12C15.8886 13.4267 15.9286 12.6867 15.9819 11.9C16.0486 11.1 16.1419 10.1933 16.2619 9.18H15.9019C15.4352 10.3533 14.9486 11.5667 14.4419 12.82C13.9486 14.06 13.4819 15.2333 13.0419 16.34H11.1019C11.0619 16.34 11.0152 16.3333 10.9619 16.32C10.9219 16.2933 10.8886 16.2467 10.8619 16.18C10.4619 15.18 10.0086 14.06 9.50191 12.82C9.00858 11.58 8.53525 10.3667 8.08191 9.18H7.70191C7.83525 10.18 7.93525 11.0733 8.00191 11.86C8.06858 12.6467 8.10858 13.3933 8.12191 14.1C8.14858 14.8067 8.16191 15.5267 8.16191 16.26V19Z"}))}import{createElement as Nr}from"react";function Wr(s){return Nr("svg",m({width:24,height:24,viewBox:"-2 -2 28 28",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg"},s),Nr("path",{d:"M7.68191 19C7.53525 19 7.46191 18.9267 7.46191 18.78V5H10.1219C10.2686 5 10.3419 5.07333 10.3419 5.22V16.56H13.4419V15.02H15.7619C15.9086 15.02 15.9819 15.0933 15.9819 15.24V19H7.68191Z"}))}import{createElement as to}from"react";function _r(){return to("svg",{width:"15",height:"15",viewBox:"0 0 15 15",fill:"none",xmlns:"http://www.w3.org/2000/svg"},to("path",{d:"M1.72838 9.33987L8.84935 2.34732C9.23874 1.96494 9.86279 1.96539 10.2516 2.34831L13.5636 5.60975C13.9655 6.00555 13.9607 6.65526 13.553 7.04507L8.13212 12.2278C7.94604 12.4057 7.69851 12.505 7.44107 12.505L6.06722 12.505L3.83772 12.505C3.5673 12.505 3.30842 12.3954 3.12009 12.2014L1.7114 10.7498C1.32837 10.3551 1.33596 9.72521 1.72838 9.33987Z",stroke:"currentColor"}),to("line",{x1:"6.01807",y1:"12.5",x2:"10.7959",y2:"12.5",stroke:"currentColor",strokeLinecap:"round"}),to("line",{x1:"5.50834",y1:"5.74606",x2:"10.1984",y2:"10.4361",stroke:"currentColor"}))}import{createElement as Mv}from"react";import{createElement as Yr}from"react";function Xr(){return Yr("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",viewBox:"0 0 16 16"},Yr("path",{d:"M13.545 2.907a13.227 13.227 0 0 0-3.257-1.011.05.05 0 0 0-.052.025c-.141.25-.297.577-.406.833a12.19 12.19 0 0 0-3.658 0 8.258 8.258 0 0 0-.412-.833.051.051 0 0 0-.052-.025c-1.125.194-2.22.534-3.257 1.011a.041.041 0 0 0-.021.018C.356 6.024-.213 9.047.066 12.032c.001.014.01.028.021.037a13.276 13.276 0 0 0 3.995 2.02.05.05 0 0 0 .056-.019c.308-.42.582-.863.818-1.329a.05.05 0 0 0-.01-.059.051.051 0 0 0-.018-.011 8.875 8.875 0 0 1-1.248-.595.05.05 0 0 1-.02-.066.051.051 0 0 1 .015-.019c.084-.063.168-.129.248-.195a.05.05 0 0 1 .051-.007c2.619 1.196 5.454 1.196 8.041 0a.052.052 0 0 1 .053.007c.08.066.164.132.248.195a.051.051 0 0 1-.004.085 8.254 8.254 0 0 1-1.249.594.05.05 0 0 0-.03.03.052.052 0 0 0 .003.041c.24.465.515.909.817 1.329a.05.05 0 0 0 .056.019 13.235 13.235 0 0 0 4.001-2.02.049.049 0 0 0 .021-.037c.334-3.451-.559-6.449-2.366-9.106a.034.034 0 0 0-.02-.019Zm-8.198 7.307c-.789 0-1.438-.724-1.438-1.612 0-.889.637-1.613 1.438-1.613.807 0 1.45.73 1.438 1.613 0 .888-.637 1.612-1.438 1.612Zm5.316 0c-.788 0-1.438-.724-1.438-1.612 0-.889.637-1.613 1.438-1.613.807 0 1.451.73 1.438 1.613 0 .888-.631 1.612-1.438 1.612Z"}))}import{createElement as Jr}from"react";function Zr(){return Jr("svg",{width:"15",height:"15",viewBox:"0 0 15 15",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg"},Jr("path",{d:"M3.64645 11.3536C3.45118 11.1583 3.45118 10.8417 3.64645 10.6465L11.1464 3.14645C11.3417 2.95118 11.6583 2.95118 11.8536 3.14645C12.0488 3.34171 12.0488 3.65829 11.8536 3.85355L4.35355 11.3536C4.15829 11.5488 3.84171 11.5488 3.64645 11.3536Z"}))}var Ss=[x.Rectangle,x.Ellipse,x.Line],qr={[x.Rectangle]:Ze(hc,null),[x.Ellipse]:Ze(uc,null),[x.Line]:Ze(Zr,null)},Qr=mc(function({activeTool:e,isToolLocked:t}){let n=K(),[o,i]=gc(x.Rectangle);fc(()=>{Ss.includes(e)&&o!==e&&i(e)},[e]);let r=ea(()=>{n.selectTool(o)},[e,n]),d=ea(()=>{n.toggleToolLock()},[n]),a=Ss.includes(e);return Ze(Sc,{dir:"ltr",onOpenChange:r},Ze(Tc,{dir:"ltr",asChild:!0},Ze(V,{variant:"primary",onDoubleClick:d,isToolLocked:a&&t,isActive:a},qr[o])),Ze(yc,{asChild:!0,dir:"ltr",side:"top",sideOffset:12},Ze(Mt,{side:"center"},Ss.map((l,p)=>Ze(Ie,{key:l,label:l[0].toUpperCase()+l.slice(1),kbd:(4+p).toString()},Ze(bc,{asChild:!0},Ze(V,{variant:"primary",onClick:()=>{n.selectTool(l),i(l)}},qr[l])))))))});var vc=s=>s.appState.activeTool,Dc=s=>s.appState.isToolLocked,ta=Bc(function(){let e=K(),t=e.useStore(vc),n=e.useStore(Dc),o=Jt(()=>{e.selectTool("select")},[e]),i=Jt(()=>{e.selectTool("erase")},[e]),r=Jt(()=>{e.selectTool(x.Draw)},[e]),d=Jt(()=>{e.selectTool(x.Arrow)},[e]),a=Jt(()=>{e.selectTool(x.Text)},[e]),l=Jt(()=>{e.selectTool(x.Sticky)},[e]);return Oe(Mt,{side:"center"},Oe(Lt,{kbd:"1",label:"select",onClick:o,isActive:t==="select"},Oe(wc,null)),Oe(Lt,{kbd:"2",label:x.Draw,onClick:r,isActive:t===x.Draw},Oe(xc,null)),Oe(Lt,{kbd:"3",label:"eraser",onClick:i,isActive:t==="erase"},Oe(_r,null)),Oe(Qr,{activeTool:t,isToolLocked:n}),Oe(Lt,{kbd:"7",label:x.Arrow,onClick:d,isLocked:n,isActive:t===x.Arrow},Oe(Ic,null)),Oe(Lt,{kbd:"8",label:x.Text,onClick:a,isLocked:n,isActive:t===x.Text},Oe(Pc,null)),Oe(Lt,{kbd:"9",label:x.Sticky,onClick:l,isActive:t===x.Sticky},Oe(Cc,null)))});import{Fragment as Tp,createElement as M,useCallback as de}from"react";import{Root as fp,Trigger as Sp}from"@radix-ui/react-dropdown-menu";import{ArrowDownIcon as Gc,ArrowUpIcon as $c,AspectRatioIcon as Kc,CopyIcon as Vc,DotsHorizontalIcon as Wc,GroupIcon as Nc,LockClosedIcon as _c,LockOpen1Icon as Xc,PinBottomIcon as Yc,PinTopIcon as Zc,RotateCounterClockwiseIcon as Jc,AlignBottomIcon as qc,AlignCenterHorizontallyIcon as Qc,AlignCenterVerticallyIcon as ep,AlignLeftIcon as tp,AlignRightIcon as np,AlignTopIcon as op,SpaceEvenlyHorizontallyIcon as sp,SpaceEvenlyVerticallyIcon as ip,StretchHorizontallyIcon as rp,StretchVerticallyIcon as ap,BoxIcon as dp,AngleIcon as lp}from"@radix-ui/react-icons";import{Arrow as kc}from"@radix-ui/react-dropdown-menu";var vD=D(kc,{fill:"$panel",bp:ye});import{createElement as na}from"react";import{Item as Rc}from"@radix-ui/react-dropdown-menu";function q(t){var n=t,{onSelect:s}=n,e=Se(n,["onSelect"]);return na(Rc,{dir:"ltr",asChild:!0,onSelect:s},na(be,m({},e)))}import{createElement as oa}from"react";import{CheckboxItem as Ec}from"@radix-ui/react-dropdown-menu";var te=s=>s.preventDefault();function Je({checked:s,disabled:e=!1,variant:t,onCheckedChange:n,kbd:o,children:i}){return oa(Ec,{dir:"ltr",onSelect:te,onCheckedChange:n,checked:s,disabled:e,asChild:!0},oa(be,{kbd:o,variant:t,hasIndicator:!0},i))}import{createElement as sa}from"react";import{Content as Lc}from"@radix-ui/react-dropdown-menu";function it({sideOffset:s=8,children:e,align:t,variant:n}){return sa(Lc,{dir:"ltr",align:t,sideOffset:s,onEscapeKeyDown:Wt,asChild:!0},sa(Mc,{variant:n},e))}var Mc=D(Ye,{width:"fit-content",height:"fit-content",minWidth:0,variants:{variant:{horizontal:{flexDirection:"row"},menu:{minWidth:128}}}});import{Separator as Hc}from"@radix-ui/react-dropdown-menu";var qe=D(Hc,{backgroundColor:"$hover",height:1,marginTop:"$2",marginRight:"-$2",marginBottom:"$2",marginLeft:"-$2"});import{RadioItem as Ac}from"@radix-ui/react-dropdown-menu";var Dn=D(Ac,{height:"32px",width:"32px",backgroundColor:"$panel",borderRadius:"4px",padding:"0",margin:"0",display:"flex",alignItems:"center",justifyContent:"center",outline:"none",border:"none",pointerEvents:"all",cursor:"pointer",variants:{isActive:{true:{backgroundColor:"$selected",color:"$panel"},false:{}},bp:{mobile:{},small:{}}},compoundVariants:[{isActive:!1,bp:"small",css:{"&:focus":{backgroundColor:"$hover"},"&:hover:not(:disabled)":{backgroundColor:"$hover"}}}]});import{createElement as qt}from"react";import{Root as Oc,TriggerItem as Fc,Content as Uc,Arrow as zc}from"@radix-ui/react-dropdown-menu";function Bn({children:s,disabled:e=!1,label:t}){return qt(Oc,{dir:"ltr"},qt(Fc,{dir:"ltr",asChild:!0},qt(be,{disabled:e,hasArrow:!0},t)),qt(Uc,{dir:"ltr",asChild:!0,sideOffset:2,alignOffset:-2},qt(Ye,null,s,qt(zc,{offset:13}))))}import{createElement as ra}from"react";import{Trigger as jc}from"@radix-ui/react-dropdown-menu";function ia(t){var n=t,{children:s}=n,e=Se(n,["children"]);return ra(jc,{asChild:!0},ra(V,m({},e),s))}import"react";var Qe=D("hr",{height:1,marginTop:"$1",marginRight:"-$2",marginBottom:"$1",marginLeft:"-$2",border:"none",borderBottom:"1px solid $hover"});var cp=s=>s.document.pageStates[s.appState.currentPageId].selectedIds.length,pp=s=>{let e=s.document.pages[s.appState.currentPageId],{selectedIds:t}=s.document.pageStates[s.appState.currentPageId];return t.every(n=>e.shapes[n].isLocked)},hp=s=>{let e=s.document.pages[s.appState.currentPageId],{selectedIds:t}=s.document.pageStates[s.appState.currentPageId];return t.every(n=>e.shapes[n].isAspectRatioLocked)},up=s=>{let e=s.document.pages[s.appState.currentPageId],t=s.document.pageStates[s.appState.currentPageId].selectedIds.map(n=>e.shapes[n]);return t.every(n=>n.children!==void 0||n.parentId===t[0].parentId&&t[0].parentId!==s.appState.currentPageId)},mp=s=>{let{selectedIds:e}=s.document.pageStates[s.appState.currentPageId];return e.length>0},gp=s=>{let{selectedIds:e}=s.document.pageStates[s.appState.currentPageId];return e.length>1};function aa(){let s=K(),e=s.useStore(pp),t=s.useStore(hp),n=s.useStore(up),o=s.useStore(mp),i=s.useStore(gp),r=s.useStore(cp),d=r>1,a=r>2,l=de(()=>{s.rotate()},[s]),p=de(()=>{s.duplicate()},[s]),c=de(()=>{s.toggleLocked()},[s]),h=de(()=>{s.toggleAspectRatioLocked()},[s]),u=de(()=>{s.group()},[s]),f=de(()=>{s.moveToBack()},[s]),g=de(()=>{s.moveBackward()},[s]),b=de(()=>{s.moveForward()},[s]),P=de(()=>{s.moveToFront()},[s]),S=de(()=>{s.setShapeProps({rotation:0})},[s]),w=de(()=>{s.align(ne.Top)},[s]),v=de(()=>{s.align(ne.CenterVertical)},[s]),T=de(()=>{s.align(ne.Bottom)},[s]),C=de(()=>{s.stretch(Ve.Vertical)},[s]),R=de(()=>{s.distribute(We.Vertical)},[s]),B=de(()=>{s.align(ne.Left)},[s]),O=de(()=>{s.align(ne.CenterHorizontal)},[s]),j=de(()=>{s.align(ne.Right)},[s]),E=de(()=>{s.stretch(Ve.Horizontal)},[s]),De=de(()=>{s.distribute(We.Horizontal)},[s]),et=de(fe=>{s.setMenuOpen(fe)},[s]);return M(fp,{dir:"ltr",onOpenChange:et},M(Sp,{dir:"ltr",asChild:!0},M(V,{variant:"circle"},M(Wc,null))),M(it,{sideOffset:16},M(Tp,null,M(no,null,M(V,{variant:"icon",disabled:!o,onClick:p},M(Ie,{label:"Duplicate",kbd:"#D"},M(Vc,null))),M(V,{disabled:!o,onClick:l},M(Ie,{label:"Rotate"},M(Jc,null))),M(V,{disabled:!o,onClick:c},M(Ie,{label:"Toggle Locked",kbd:"#L"},e?M(_c,null):M(Xc,null))),M(V,{disabled:!o,onClick:h},M(Ie,{label:"Toggle Aspect Ratio Lock"},t?M(Kc,null):M(dp,null))),M(V,{disabled:!o||!n&&!i,onClick:u},M(Ie,{label:"Group",kbd:"#G"},M(Nc,null)))),M(no,null,M(V,{disabled:!o,onClick:f},M(Ie,{label:"Move to Back",kbd:"#\u21E7["},M(Yc,null))),M(V,{disabled:!o,onClick:g},M(Ie,{label:"Move Backward",kbd:"#["},M(Gc,null))),M(V,{disabled:!o,onClick:b},M(Ie,{label:"Move Forward",kbd:"#]"},M($c,null))),M(V,{disabled:!o,onClick:P},M(Ie,{label:"Move to Front",kbd:"#\u21E7]"},M(Zc,null))),M(V,{disabled:!o,onClick:S},M(Ie,{label:"Reset Angle"},M(lp,null)))),M(Qe,null),M(no,null,M(V,{disabled:!d,onClick:B},M(tp,null)),M(V,{disabled:!d,onClick:O},M(Qc,null)),M(V,{disabled:!d,onClick:j},M(np,null)),M(V,{disabled:!d,onClick:E},M(rp,null)),M(V,{disabled:!a,onClick:De},M(sp,null))),M(no,null,M(V,{disabled:!d,onClick:w},M(op,null)),M(V,{disabled:!d,onClick:v},M(ep,null)),M(V,{disabled:!d,onClick:T},M(qc,null)),M(V,{disabled:!d,onClick:C},M(ap,null)),M(V,{disabled:!a,onClick:R},M(ip,null))))))}var no=D("div",{position:"relative",display:"flex",width:"100%",background:"none",border:"none",cursor:"pointer",outline:"none",alignItems:"center",justifyContent:"flex-start",padding:0});import{createElement as Ts,useCallback as yp}from"react";function da(){let s=K(),e=yp(()=>{s.delete()},[s]),t=s.useStore(n=>n.appState.status==="idle"&&n.document.pageStates[n.appState.currentPageId].selectedIds.length>0);return Ts(Ie,{label:"Delete",kbd:"\u232B"},Ts(V,{variant:"circle",disabled:!t,onSelect:e},Ts(Ur,null)))}var bp=s=>s.settings.isDebugMode,ys=Pp(function({onBlur:e}){let n=K().useStore(bp);return St(Ip,{onBlur:e},St(wp,null,St(Pr,null),St(Cp,null,St(aa,null),St(ta,null),St(da,null))),n&&St(xp,null,St(wr,null)))}),Ip=D("div",{position:"absolute",bottom:0,left:0,right:0,width:"100%",minWidth:0,maxWidth:"100%",display:"grid",gridTemplateColumns:"auto auto auto",gridTemplateRows:"auto auto",justifyContent:"space-between",padding:"0",gap:"$4",zIndex:200,pointerEvents:"none","& > div > *":{pointerEvents:"all"}}),wp=D("div",{gridRow:1,gridColumn:2,display:"flex",width:"fit-content",alignItems:"center",justifyContent:"center",flexDirection:"column",gap:"$4"}),xp=D("div",{gridRow:2,gridColumn:"1 / span 3"}),Cp=D("div",{position:"relative",display:"flex",alignItems:"center",gap:"$2"});import{createElement as je}from"react";import{Fragment as ua,createElement as z,memo as Lp,useCallback as Tt}from"react";import{ExitIcon as Dp,GitHubLogoIcon as Bp,HamburgerMenuIcon as kp,TwitterLogoIcon as Rp}from"@radix-ui/react-icons";import{Root as Mp}from"@radix-ui/react-dropdown-menu";import{createElement as rt,useCallback as Bt}from"react";var vp=s=>s.settings;function la(){let s=K(),e=s.useStore(vp),t=Bt(()=>{s.setSetting("isDebugMode",p=>!p)},[s]),n=Bt(()=>{s.setSetting("isDarkMode",p=>!p)},[s]),o=Bt(()=>{s.setSetting("isFocusMode",p=>!p)},[s]),i=Bt(()=>{s.setSetting("showRotateHandles",p=>!p)},[s]),r=Bt(()=>{s.setSetting("showGrid",p=>!p)},[s]),d=Bt(()=>{s.setSetting("showBindingHandles",p=>!p)},[s]),a=Bt(()=>{s.setSetting("isSnapping",p=>!p)},[s]),l=Bt(()=>{s.setSetting("showCloneHandles",p=>!p)},[s]);return rt(Bn,{label:"Preferences"},rt(Je,{checked:e.isDarkMode,onCheckedChange:n,kbd:"#\u21E7D"},"Dark Mode"),rt(Je,{checked:e.isFocusMode,onCheckedChange:o,kbd:"#."},"Focus Mode"),rt(Je,{checked:e.isDebugMode,onCheckedChange:t},"Debug Mode"),rt(qe,null),rt(Je,{checked:e.showRotateHandles,onCheckedChange:i},"Rotate Handles"),rt(Je,{checked:e.showBindingHandles,onCheckedChange:d},"Binding Handles"),rt(Je,{checked:e.showCloneHandles,onCheckedChange:l},"Clone Handles"),rt(Je,{checked:e.showGrid,onCheckedChange:r,kbd:"#\u21E7G"},"Grid"),rt(Je,{checked:e.isSnapping,onCheckedChange:a},"Always Show Snaps"))}import{createElement as pa}from"react";function ca(){return pa("svg",{width:"24",height:"24",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"},pa("path",{fill:"none",stroke:"currentColor",strokeWidth:2,d:"M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"}))}var Ep=s=>s.document.pageStates[s.appState.currentPageId].selectedIds.length,ha=Lp(function({showSponsorLink:e,readOnly:t}){let n=K(),o=n.useStore(Ep),{onNewProject:i,onOpenProject:r,onSaveProject:d,onSaveProjectAs:a}=Yn(),l=Tt(()=>{var T,C;(C=(T=n.callbacks).onSignIn)==null||C.call(T,n)},[n]),p=Tt(()=>{var T,C;(C=(T=n.callbacks).onSignOut)==null||C.call(T,n)},[n]),c=Tt(()=>{n.cut()},[n]),h=Tt(()=>{n.copy()},[n]),u=Tt(()=>{n.paste()},[n]),f=Tt(()=>{n.copySvg()},[n]),g=Tt(()=>{n.copyJson()},[n]),b=Tt(()=>{n.selectAll()},[n]),P=Tt(()=>{n.selectNone()},[n]),S=n.callbacks.onNewProject||n.callbacks.onOpenProject||n.callbacks.onSaveProject||n.callbacks.onSaveProjectAs,w=n.callbacks.onSignIn||n.callbacks.onSignOut||e,v=o>0;return z(Mp,{dir:"ltr"},z(ia,{isSponsor:e},z(kp,null)),z(it,{variant:"menu"},S&&z(Bn,{label:"File..."},n.callbacks.onNewProject&&z(q,{onClick:i,kbd:"#N"},"New Project"),n.callbacks.onOpenProject&&z(q,{onClick:r,kbd:"#O"},"Open..."),n.callbacks.onSaveProject&&z(q,{onClick:d,kbd:"#S"},"Save"),n.callbacks.onSaveProjectAs&&z(q,{onClick:a,kbd:"#\u21E7S"},"Save As...")),!t&&z(ua,null,z(Bn,{label:"Edit..."},z(q,{onSelect:te,onClick:n.undo,kbd:"#Z"},"Undo"),z(q,{onSelect:te,onClick:n.redo,kbd:"#\u21E7Z"},"Redo"),z(qe,{dir:"ltr"}),z(q,{onSelect:te,disabled:!v,onClick:c,kbd:"#X"},"Cut"),z(q,{onSelect:te,disabled:!v,onClick:h,kbd:"#C"},"Copy"),z(q,{onSelect:te,onClick:u,kbd:"#V"},"Paste"),z(qe,{dir:"ltr"}),z(q,{onSelect:te,disabled:!v,onClick:f,kbd:"#\u21E7C"},"Copy as SVG"),z(q,{onSelect:te,disabled:!v,onClick:g},"Copy as JSON"),z(qe,{dir:"ltr"}),z(q,{onSelect:te,onClick:b,kbd:"#A"},"Select All"),z(q,{onSelect:te,onClick:P},"Select None"))),z("a",{href:"https://tldraw.com/r"},z(q,null,"Create a Multiplayer Room")),z(qe,{dir:"ltr"}),z(la,null),z(qe,{dir:"ltr"}),z("a",{href:"https://github.com/Tldraw/Tldraw",target:"_blank",rel:"nofollow"},z(q,null,"GitHub",z(Ae,null,z(Bp,null)))),z("a",{href:"https://twitter.com/Tldraw",target:"_blank",rel:"nofollow"},z(q,null,"Twitter",z(Ae,null,z(Rp,null)))),z("a",{href:"https://discord.gg/SBBEVCA4PG",target:"_blank",rel:"nofollow"},z(q,null,"Discord",z(Ae,null,z(Xr,null)))),e&&z("a",{href:"https://github.com/sponsors/steveruizok",target:"_blank",rel:"nofollow"},z(q,{isSponsor:!0},"Become a Sponsor"," ",z(Ae,null,z(ca,null)))),w&&z(ua,null,z(qe,{dir:"ltr"})," ",n.callbacks.onSignIn&&z(q,{onSelect:l},"Sign In"),n.callbacks.onSignOut&&z(q,{onSelect:p},"Sign Out",z(Ae,null,z(Dp,null))))))});import{Fragment as ch,createElement as le,useCallback as so,useEffect as oh,useRef as th,useState as nh}from"react";import{Item as lh,ItemIndicator as dh,RadioGroup as rh,RadioItem as ah,Root as sh,Trigger as ih}from"@radix-ui/react-dropdown-menu";import{PlusIcon as _p,CheckIcon as Xp}from"@radix-ui/react-icons";import{createElement as Le,useCallback as Is,useEffect as jp,useRef as zp,useState as Up}from"react";import{Action as Np,Cancel as Kp,Content as Vp,Overlay as Wp,Root as Gp,Trigger as $p}from"@radix-ui/react-alert-dialog";import{MixerVerticalIcon as Hp}from"@radix-ui/react-icons";var oo=D("button",{position:"relative",height:"32px",width:"32px",backgroundColor:"$panel",borderRadius:"4px",padding:"0",margin:"0",outline:"none",border:"none",pointerEvents:"all",fontSize:"$0",color:"$text",cursor:"pointer",display:"grid",alignItems:"center",justifyContent:"center","& > *":{gridRow:1,gridColumn:1},"&:disabled":{opacity:"0.5"},"& > span":{width:"100%",height:"100%",display:"flex",alignItems:"center"},variants:{bp:{mobile:{backgroundColor:"transparent"},small:{"&:hover:not(:disabled)":{backgroundColor:"$hover"}}},size:{small:{height:32,width:32,"& svg:nth-of-type(1)":{height:"16px",width:"16px"}},medium:{height:44,width:44,"& svg:nth-of-type(1)":{height:"18px",width:"18px"}},large:{height:44,width:44,"& svg:nth-of-type(1)":{height:"20px",width:"20px"}}},isActive:{true:{color:"$selected"}}}});var Ap=s=>Object.keys(s.document.pages).length>1;function ma({page:s,onOpen:e,onClose:t}){let n=K(),[o,i]=Up(!1),r=n.useStore(Ap),d=zp(null),a=Is(()=>{n.duplicatePage(s.id),t==null||t()},[n]),l=Is(()=>{window.confirm("Are you sure you want to delete this page?")&&(n.deletePage(s.id),t==null||t())},[n]),p=Is(u=>{if(i(u),u){e==null||e();return}},[n]);function c(u){u.stopPropagation()}function h(){let u=window.prompt("New name:",s.name);n.renamePage(s.id,u||s.name||"Page")}return jp(()=>{o&&requestAnimationFrame(()=>{let u=d.current;u&&(u.focus(),u.select())})},[o]),Le(Gp,{open:o,onOpenChange:p},Le($p,{asChild:!0,"data-shy":"true"},Le(oo,{bp:ye},Le(Ae,null,Le(Hp,null)))),Le(Fp,null),Le(Op,{dir:"ltr",onKeyDown:c,onKeyUp:c},Le(bs,{onSelect:h},"Rename"),Le(bs,{onSelect:a},"Duplicate"),Le(bs,{disabled:!r,onSelect:l},"Delete"),Le(Qe,null),Le(Kp,{asChild:!0},Le(be,null,"Cancel"))))}var Op=D(Vp,{position:"fixed",top:"50%",left:"50%",transform:"translate(-50%, -50%)",minWidth:240,maxWidth:"fit-content",maxHeight:"85vh",marginTop:"-5vh",pointerEvents:"all",backgroundColor:"$panel",padding:"$0",borderRadius:"$2",font:"$ui","&:focus":{outline:"none"}}),Fp=D(Wp,{backgroundColor:"rgba(0, 0, 0, .15)",position:"fixed",top:0,right:0,bottom:0,left:0,width:"100%",height:"100%"});function bs(t){var n=t,{onSelect:s}=n,e=Se(n,["onSelect"]);return Le(Np,{asChild:!0,onClick:s,onSelect:s},Le(be,m({},e)))}var Yp=s=>Object.values(s.document.pages).sort((e,t)=>(e.childIndex||0)-(t.childIndex||0)),Zp=s=>s.document.pages[s.appState.currentPageId].name,Jp=s=>s.document.pages[s.appState.currentPageId].id;function ga(){let s=K(),e=th(!1),[t,n]=nh(!1);oh(()=>{e.current!==t&&(e.current=t)},[t]);let o=so(()=>{n(!1)},[n]),i=so(d=>{e.current!==d&&n(d)},[n]),r=s.useStore(Zp);return le(sh,{dir:"ltr",open:t,onOpenChange:i},le(ih,{dir:"ltr",asChild:!0},le(V,{variant:"text"},r||"Page")),le(it,{variant:"menu",align:"start"},t&&le(qp,{onClose:o})))}function qp({onClose:s}){let e=K(),t=e.useStore(Yp),n=e.useStore(Jp),o=so(()=>{e.createPage()},[e]),i=so(r=>{s(),e.changePage(r)},[e]);return le(ch,null,le(rh,{dir:"ltr",value:n,onValueChange:i},t.map(r=>le(Qp,{key:r.id},le(ah,{title:r.name||"Page",value:r.id,key:r.id,asChild:!0},le(eh,null,le("span",null,r.name||"Page"),le(dh,null,le(Ae,null,le(Xp,null))))),le(ma,{page:r,onClose:s})))),le(qe,null),le(lh,{onSelect:o,asChild:!0},le(be,null,le("span",null,"Create Page"),le(Ae,null,le(_p,null)))))}var Qp=D("div",{display:"grid",gridTemplateColumns:"1fr auto",gridAutoFlow:"column",'& > *[data-shy="true"]':{opacity:0},'&:hover > *[data-shy="true"]':{opacity:1}}),eh=D(be,{minWidth:128});import{createElement as yt,memo as uh}from"react";import{Root as mh,Trigger as gh}from"@radix-ui/react-dropdown-menu";var ph=s=>s.document.pageStates[s.appState.currentPageId].camera.zoom,fa=uh(function(){let e=K(),t=e.useStore(ph);return yt(mh,{dir:"ltr"},yt(gh,{dir:"ltr",asChild:!0},yt(hh,{onDoubleClick:e.resetZoom,variant:"text"},Math.round(t*100),"%")),yt(it,{align:"end"},yt(q,{onSelect:te,onClick:e.zoomIn,kbd:"#+"},"Zoom In"),yt(q,{onSelect:te,onClick:e.zoomOut,kbd:"#\u2212"},"Zoom Out"),yt(q,{onSelect:te,onClick:e.resetZoom,kbd:"\u21E70"},"To 100%"),yt(q,{onSelect:te,onClick:e.zoomToFit,kbd:"\u21E71"},"To Fit"),yt(q,{onSelect:te,onClick:e.zoomToSelection,kbd:"\u21E72"},"To Selection")))}),hh=D(V,{minWidth:56});import{Fragment as Fh,createElement as W,memo as Rh,useCallback as Qt,useEffect as Mh,useRef as Lh,useState as Eh}from"react";import{DropdownMenuRadioGroup as Uh,Item as Oh,Root as Hh,Trigger as Ah}from"@radix-ui/react-dropdown-menu";import{TextAlignCenterIcon as fh,TextAlignJustifyIcon as Sh,TextAlignLeftIcon as Th,TextAlignRightIcon as yh}from"@radix-ui/react-icons";var bh=s=>s.appState.currentStyle,Ih=s=>s.document.pageStates[s.appState.currentPageId].selectedIds,wh=Object.keys($t),Sa={[J.Draw]:W(Lr,null),[J.Solid]:W(Hr,null),[J.Dashed]:W(Br,null),[J.Dotted]:W(Rr,null)},xh={[me.Small]:W(Gr,null),[me.Medium]:W(Kr,null),[me.Large]:W(Wr,null)},Ch={[N.Start]:W(Th,null),[N.Middle]:W(fh,null),[N.End]:W(yh,null),[N.Justify]:W(Sh,null)},Ph=s=>s.settings.isDarkMode?"dark":"light",vh=s=>{let{activeTool:e,currentPageId:t}=s.appState,n=s.document.pages[t];return e==="text"||s.document.pageStates[t].selectedIds.some(o=>"text"in n.shapes[o])},Ta=Rh(function(){let e=K(),t=e.useStore(Ph),n=e.useStore(vh),o=e.useStore(bh),i=e.useStore(Ih),[r,d]=Eh(o),a=Lh(o);Mh(()=>{let{appState:{currentStyle:g},page:b,selectedIds:P}=e,S={};if(P.length<=0)S=g;else{let w=new Set([]);e.selectedIds.map(v=>b.shapes[v]).forEach(v=>{wh.forEach(T=>{if(!w.has(T))if(S[T]===void 0)S[T]=v.style[T];else{if(S[T]===v.style[T])return;S[T]=v.style[T],w.add(T)}})})}JSON.stringify(S)!==JSON.stringify(a.current)&&(a.current=S,d(S))},[o,i]);let l=Qt(g=>{e.style({isFilled:g})},[]),p=Qt(g=>{e.style({dash:g})},[]),c=Qt(g=>{e.style({size:g})},[]),h=Qt(g=>{e.style({font:g})},[]),u=Qt(g=>{e.style({textAlign:g})},[]),f=Qt(g=>{e.setMenuOpen(g)},[e]);return W(Hh,{dir:"ltr",onOpenChange:f},W(Ah,{asChild:!0},W(V,{variant:"text"},"Styles",W(Bh,{style:{color:Gt[t][r.color]}},r.isFilled&&W(fs,{size:16,stroke:"none",fill:An[t][r.color]}),Sa[r.dash]))),W(it,null,W(kn,{variant:"tall"},W("span",null,"Color"),W(Dh,null,Object.keys(Gt.light).map(g=>W(Oh,{key:g,onSelect:te,asChild:!0},W(V,{variant:"icon",isActive:r.color===g,onClick:()=>e.style({color:g})},W(fs,{size:18,strokeWidth:2.5,fill:r.isFilled?An.light[g]:"transparent",stroke:Gt.light[g]})))))),W(Je,{variant:"styleMenu",checked:!!r.isFilled,onCheckedChange:l},"Fill"),W(kn,null,"Dash",W(io,{dir:"ltr",value:r.dash,onValueChange:p},Object.values(J).map(g=>W(Dn,{key:g,isActive:g===r.dash,value:g,onSelect:te,bp:ye},Sa[g])))),W(kn,null,"Size",W(io,{dir:"ltr",value:r.size,onValueChange:c},Object.values(me).map(g=>W(Dn,{key:g,isActive:g===r.size,value:g,onSelect:te,bp:ye},xh[g])))),n&&W(Fh,null,W(Qe,null),W(kn,null,"Font",W(io,{dir:"ltr",value:r.font,onValueChange:h},Object.values(ie).map(g=>W(Dn,{key:g,isActive:g===r.font,value:g,onSelect:te,bp:ye},W(kh,{fontStyle:g},"Aa"))))),W(kn,null,"Align",W(io,{dir:"ltr",value:r.textAlign,onValueChange:u},Object.values(N).map(g=>W(Dn,{key:g,isActive:g===r.textAlign,value:g,onSelect:te,bp:ye},Ch[g])))))))}),Dh=D("div",{display:"grid",gridTemplateColumns:"repeat(4, auto)",gap:0}),kn=D("div",{position:"relative",width:"100%",background:"none",border:"none",cursor:"pointer",minHeight:"32px",outline:"none",color:"$text",fontFamily:"$ui",fontWeight:400,fontSize:"$1",padding:"$2 0 $2 $3",borderRadius:4,userSelect:"none",margin:0,display:"flex",gap:"$3",flexDirection:"row",alignItems:"center",justifyContent:"space-between",variants:{variant:{tall:{alignItems:"flex-start",padding:"0 0 0 $3","& > span":{paddingTop:"$4"}}}}}),io=D(Uh,{display:"flex",flexDirection:"row",gap:"$1"}),Bh=D("div",{display:"grid","& > *":{gridColumn:1,gridRow:1}}),kh=D("div",{width:32,height:32,display:"flex",alignItems:"center",justifyContent:"center",fontSize:"$3",variants:{fontStyle:{[ie.Script]:{fontFamily:"Caveat Brush"},[ie.Sans]:{fontFamily:"Recursive"},[ie.Serif]:{fontFamily:"Georgia"},[ie.Mono]:{fontFamily:"Recursive Mono"}}}});function ws({readOnly:s,showPages:e,showMenu:t,showStyles:n,showZoom:o,showSponsorLink:i}){let r=K();return je(zh,null,(t||e)&&je(Mt,{side:"left"},t&&je(ha,{showSponsorLink:i,readOnly:s}),e&&je(ga,null)),je(jh,null),(n||o)&&je(Mt,{side:"right"},n&&!s&&je(Ta,null),je(Gh,{bp:ye},je(V,null,je(zr,{onClick:r.undo})),je(V,null,je(Or,{onClick:r.redo}))),o&&je(fa,null)))}var zh=D("div",{width:"100%",position:"absolute",top:0,left:0,right:0,display:"flex",flexDirection:"row",pointerEvents:"none","& > *":{pointerEvents:"all"}}),jh=D("div",{flexGrow:2,pointerEvents:"none"}),Gh=D("div",{display:"flex",flexDirection:"row",variants:{bp:{small:{display:"inherit"},large:{display:"none"}}}});import{Fragment as ya,createElement as k,useCallback as Q,useRef as du}from"react";import{Content as ao,ContextMenuArrow as cu,ContextMenuItem as ba,ContextMenuTriggerItem as pu,Root as ro,Trigger as lu}from"@radix-ui/react-context-menu";import{AlignBottomIcon as $h,AlignCenterHorizontallyIcon as Kh,AlignCenterVerticallyIcon as Vh,AlignLeftIcon as Wh,AlignRightIcon as Nh,AlignTopIcon as _h,SpaceEvenlyHorizontallyIcon as Xh,SpaceEvenlyVerticallyIcon as Yh,StretchHorizontallyIcon as Zh,StretchVerticallyIcon as Jh}from"@radix-ui/react-icons";var qh=s=>s.document.pageStates[s.appState.currentPageId].selectedIds.length,Qh=s=>s.settings.isDebugMode,eu=s=>s.document.pageStates[s.appState.currentPageId].selectedIds.some(e=>s.document.pages[s.appState.currentPageId].shapes[e].children!==void 0),tu=s=>s.stopPropagation(),xs=({onBlur:s,children:e})=>{let t=K(),n=t.useStore(qh),o=t.useStore(Qh),i=t.useStore(eu),r=du(null),d=Q(()=>{t.flipHorizontal()},[t]),a=Q(()=>{t.flipVertical()},[t]),l=Q(()=>{t.duplicate()},[t]),p=Q(()=>{t.toggleLocked()},[t]),c=Q(()=>{t.group()},[t]),h=Q(()=>{t.moveToBack()},[t]),u=Q(()=>{t.moveBackward()},[t]),f=Q(()=>{t.moveForward()},[t]),g=Q(()=>{t.moveToFront()},[t]),b=Q(()=>{t.delete()},[t]),P=Q(()=>{t.copyJson()},[t]),S=Q(()=>{t.cut()},[t]),w=Q(()=>{t.copy()},[t]),v=Q(()=>{t.paste()},[t]),T=Q(()=>{t.copySvg()},[t]),C=Q(()=>{t.undo()},[t]),R=Q(()=>{t.redo()},[t]),B=n>0,O=n>1,j=n>2;return k(ro,{dir:"ltr"},k(lu,{dir:"ltr"},e),k(ao,{dir:"ltr",ref:r,onEscapeKeyDown:tu,asChild:!0,tabIndex:-1,onBlur:s},k(Ye,null,B?k(ya,null,k(pe,{onClick:l,kbd:"#D"},"Duplicate"),k(pe,{onClick:d,kbd:"\u21E7H"},"Flip Horizontal"),k(pe,{onClick:a,kbd:"\u21E7V"},"Flip Vertical"),k(pe,{onClick:p,kbd:"#\u21E7L"},"Lock / Unlock"),(O||i)&&k(Qe,null),O&&k(pe,{onClick:c,kbd:"#G"},"Group"),i&&k(pe,{onClick:c,kbd:"#G"},"Ungroup"),k(Qe,null),k(au,{label:"Move"},k(pe,{onClick:g,kbd:"\u21E7]"},"To Front"),k(pe,{onClick:f,kbd:"]"},"Forward"),k(pe,{onClick:u,kbd:"["},"Backward"),k(pe,{onClick:h,kbd:"\u21E7["},"To Back")),k(ru,null),O&&k(nu,{hasTwoOrMore:O,hasThreeOrMore:j}),k(Qe,null),k(pe,{onClick:S,kbd:"#X"},"Cut"),k(pe,{onClick:w,kbd:"#C"},"Copy"),k(pe,{onClick:T,kbd:"#\u21E7C"},"Copy as SVG"),o&&k(pe,{onClick:P},"Copy as JSON"),k(pe,{onClick:v,kbd:"#V"},"Paste"),k(Qe,null),k(pe,{onClick:b,kbd:"\u232B"},"Delete")):k(ya,null,k(pe,{onClick:v,kbd:"#V"},"Paste"),k(pe,{onClick:C,kbd:"#Z"},"Undo"),k(pe,{onClick:R,kbd:"#\u21E7Z"},"Redo")))))};function nu({hasThreeOrMore:s}){let e=K(),t=Q(()=>{e.align(ne.Top)},[e]),n=Q(()=>{e.align(ne.CenterVertical)},[e]),o=Q(()=>{e.align(ne.Bottom)},[e]),i=Q(()=>{e.stretch(Ve.Vertical)},[e]),r=Q(()=>{e.distribute(We.Vertical)},[e]),d=Q(()=>{e.align(ne.Left)},[e]),a=Q(()=>{e.align(ne.CenterHorizontal)},[e]),l=Q(()=>{e.align(ne.Right)},[e]),p=Q(()=>{e.stretch(Ve.Horizontal)},[e]),c=Q(()=>{e.distribute(We.Horizontal)},[e]);return k(ro,{dir:"ltr"},k(Ps,{isSubmenu:!0},"Align / Distribute"),k(ao,{asChild:!0,sideOffset:2,alignOffset:-2},k(ou,{numberOfSelected:s?"threeOrMore":"twoOrMore"},k(at,{onClick:d},k(Wh,null)),k(at,{onClick:a},k(Kh,null)),k(at,{onClick:l},k(Nh,null)),k(at,{onClick:p},k(Zh,null)),s&&k(at,{onClick:c},k(Xh,null)),k(at,{onClick:t},k(_h,null)),k(at,{onClick:n},k(Vh,null)),k(at,{onClick:o},k($h,null)),k(at,{onClick:i},k(Jh,null)),s&&k(at,{onClick:r},k(Yh,null)),k(Cs,{offset:13}))))}var ou=D(Ye,{display:"grid",variants:{numberOfSelected:{threeOrMore:{gridTemplateColumns:"repeat(5, auto)"},twoOrMore:{gridTemplateColumns:"repeat(4, auto)"}}}}),su=s=>s.appState.currentPageId,iu=s=>s.document.pages;function ru(){let s=K(),e=s.useStore(su),t=s.useStore(iu),n=Object.values(t).sort((o,i)=>(o.childIndex||0)-(i.childIndex||0)).filter(o=>o.id!==e);return n.length===0?null:k(ro,{dir:"ltr"},k(Ps,{isSubmenu:!0},"Move To Page"),k(ao,{dir:"ltr",sideOffset:2,alignOffset:-2,asChild:!0},k(Ye,null,n.map(({id:o,name:i},r)=>k(pe,{key:o,disabled:o===e,onClick:()=>s.moveToPage(o)},i||`Page ${r}`)),k(Cs,{offset:13}))))}function au({children:s,label:e}){return k(ro,{dir:"ltr"},k(Ps,{isSubmenu:!0},e),k(ao,{dir:"ltr",sideOffset:2,alignOffset:-2,asChild:!0},k(Ye,null,s,k(Cs,{offset:13}))))}var Cs=D(cu,{fill:"$panel"});function at(t){var n=t,{onSelect:s}=n,e=Se(n,["onSelect"]);return k(ba,{dir:"ltr",onSelect:s,asChild:!0},k(V,m({},e)))}var pe=e=>{var s=Se(e,[]);return k(ba,{asChild:!0},k(be,m({},s)))},Ps=t=>{var n=t,{isSubmenu:s}=n,e=Se(n,["isSubmenu"]);return k(pu,{asChild:!0},k(be,m({hasArrow:s},e)))};import{DotFilledIcon as hu}from"@radix-ui/react-icons";import{createElement as Ds}from"react";function vs({onSelect:s}){return Ds(uu,null,Ds(oo,{onClick:s},Ds(hu,null)))}var uu=D("div",{opacity:1,zIndex:100,backgroundColor:"transparent","& svg":{color:"$text"},"&:hover svg":{color:"$text"}});function kR({id:s,document:e,currentPageId:t,darkMode:n=!1,autofocus:o=!0,showMenu:i=!0,showPages:r=!0,showTools:d=!0,showZoom:a=!0,showStyles:l=!0,showUI:p=!0,readOnly:c=!1,showSponsorLink:h=!1,onMount:u,onChange:f,onChangePresence:g,onNewProject:b,onSaveProject:P,onSaveProjectAs:S,onOpenProject:w,onSignOut:v,onSignIn:T,onUndo:C,onRedo:R,onPersist:B,onPatch:O,onCommand:j,onChangePage:E}){let[De,et]=Ia(s),[fe,Rn]=Ia(()=>new vt(s,{onMount:u,onChange:f,onChangePresence:g,onNewProject:b,onSaveProject:P,onSaveProjectAs:S,onOpenProject:w,onSignOut:v,onSignIn:T,onUndo:C,onRedo:R,onPersist:B,onPatch:O,onCommand:j,onChangePage:E}));return Ht(()=>{if(s===De)return;let lo=new vt(s,{onMount:u,onChange:f,onChangePresence:g,onNewProject:b,onSaveProject:P,onSaveProjectAs:S,onOpenProject:w,onSignOut:v,onSignIn:T,onUndo:C,onRedo:R,onPersist:B,onPatch:O,onCommand:j,onChangePage:E});et(s),Rn(lo)},[De,s]),Ht(()=>{!e||(e.id===fe.document.id?fe.updateDocument(e):fe.loadDocument(e))},[e,fe]),Ht(()=>{!t||fe.changePage(t)},[t,fe]),Ht(()=>{fe.readOnly=c},[fe,c]),Ht(()=>{n&&!fe.settings.isDarkMode},[fe,n]),Ht(()=>{fe.callbacks={onMount:u,onChange:f,onChangePresence:g,onNewProject:b,onSaveProject:P,onSaveProjectAs:S,onOpenProject:w,onSignOut:v,onSignIn:T,onUndo:C,onRedo:R,onPersist:B,onPatch:O,onCommand:j,onChangePage:E}},[u,f,g,b,P,S,w,v,T,C,R,B,O,j,E]),Ge(Zn.Provider,{value:fe},Ge(mu,null,Ge(fu,{key:De||"Tldraw",id:De,autofocus:o,showPages:r,showMenu:i,showStyles:l,showZoom:a,showTools:d,showUI:p,showSponsorLink:h,readOnly:c})))}var fu=wa(function({id:e,autofocus:t,showPages:n,showMenu:o,showZoom:i,showStyles:r,showTools:d,showSponsorLink:a,readOnly:l,showUI:p}){var Rn;let c=K(),h=Iu(null),u=c.useStore(),{document:f,settings:g,appState:b,room:P}=u,S=u.appState.activeTool==="select",w=f.pages[b.currentPageId],v=f.pageStates[w.id],{selectedIds:T}=v,C=T.length===1&&w.shapes[T[0]]&&I.getShapeUtil(w.shapes[T[0]].type).hideBounds,R=T.length===1&&w.shapes[T[0]]&&I.getShapeUtil(w.shapes[T[0]].type).hideResizeHandles,B=c.session!==void 0,O=B&&((Rn=c.session)==null?void 0:Rn.constructor.name)!=="BrushSession"||!S||C||!!v.editingId,j=B||!S,E=B&&u.appState.status!==_.Brushing||!S,De=xa(()=>({isDarkMode:g.isDarkMode}),[g.isDarkMode]),et=xa(()=>g.isDarkMode?{brushFill:"rgba(180, 180, 180, .05)",brushStroke:"rgba(180, 180, 180, .25)",selected:"rgba(38, 150, 255, 1.000)",selectFill:"rgba(38, 150, 255, 0.05)",background:"#212529",foreground:"#49555f"}:{},[g.isDarkMode]),fe=wu(lo=>{let En=h.current;!En||!En.contains(lo.relatedTarget)||(En.dispatchEvent(new Event("pointerdown",{bubbles:!0})),En.dispatchEvent(new Event("pointerup",{bubbles:!0})))},[]);return Ge(Tu,{ref:h,tabIndex:-0,className:g.isDarkMode?po:""},Ge(Su,{focusableRef:h,autofocus:t}),Ge(xs,{onBlur:fe},Ge(gu,{id:e,containerRef:h,shapeUtils:mt,page:w,pageState:v,snapLines:b.snapLines,grid:ct,users:P==null?void 0:P.users,userId:P==null?void 0:P.userId,theme:et,meta:De,hideBounds:O,hideHandles:j,hideResizeHandles:R,hideIndicators:E,hideBindingHandles:!g.showBindingHandles,hideCloneHandles:!g.showCloneHandles,hideRotateHandles:!g.showRotateHandles,hideGrid:!g.showGrid,onPinchStart:c.onPinchStart,onPinchEnd:c.onPinchEnd,onPinch:c.onPinch,onPan:c.onPan,onZoom:c.onZoom,onPointerDown:c.onPointerDown,onPointerMove:c.onPointerMove,onPointerUp:c.onPointerUp,onPointCanvas:c.onPointCanvas,onDoubleClickCanvas:c.onDoubleClickCanvas,onRightPointCanvas:c.onRightPointCanvas,onDragCanvas:c.onDragCanvas,onReleaseCanvas:c.onReleaseCanvas,onPointShape:c.onPointShape,onDoubleClickShape:c.onDoubleClickShape,onRightPointShape:c.onRightPointShape,onDragShape:c.onDragShape,onHoverShape:c.onHoverShape,onUnhoverShape:c.onUnhoverShape,onReleaseShape:c.onReleaseShape,onPointBounds:c.onPointBounds,onDoubleClickBounds:c.onDoubleClickBounds,onRightPointBounds:c.onRightPointBounds,onDragBounds:c.onDragBounds,onHoverBounds:c.onHoverBounds,onUnhoverBounds:c.onUnhoverBounds,onReleaseBounds:c.onReleaseBounds,onPointBoundsHandle:c.onPointBoundsHandle,onDoubleClickBoundsHandle:c.onDoubleClickBoundsHandle,onRightPointBoundsHandle:c.onRightPointBoundsHandle,onDragBoundsHandle:c.onDragBoundsHandle,onHoverBoundsHandle:c.onHoverBoundsHandle,onUnhoverBoundsHandle:c.onUnhoverBoundsHandle,onReleaseBoundsHandle:c.onReleaseBoundsHandle,onPointHandle:c.onPointHandle,onDoubleClickHandle:c.onDoubleClickHandle,onRightPointHandle:c.onRightPointHandle,onDragHandle:c.onDragHandle,onHoverHandle:c.onHoverHandle,onUnhoverHandle:c.onUnhoverHandle,onReleaseHandle:c.onReleaseHandle,onError:c.onError,onRenderCountChange:c.onRenderCountChange,onShapeChange:c.onShapeChange,onShapeBlur:c.onShapeBlur,onShapeClone:c.onShapeClone,onBoundsChange:c.updateBounds,onKeyDown:c.onKeyDown,onKeyUp:c.onKeyUp})),p&&Ge(yu,null,g.isFocusMode?Ge(vs,{onSelect:c.toggleFocusMode}):Ge(xu,null,Ge(ws,{readOnly:l,showPages:n,showMenu:o,showStyles:r,showZoom:i,showSponsorLink:a}),Ge(bu,null),d&&!l&&Ge(ys,{onBlur:fe}))))}),Su=wa(function({focusableRef:e,autofocus:t}){return us(e),gs(),Ht(()=>{var n;t&&((n=e.current)==null||n.focus())},[t]),null}),Tu=D("div",{position:"absolute",height:"100%",width:"100%",minHeight:0,minWidth:0,maxHeight:"100%",maxWidth:"100%",overflow:"hidden",boxSizing:"border-box",outline:"none","& .tl-container":{position:"absolute",top:0,left:0,height:"100%",width:"100%",zIndex:1},"& input, textarea, button, select, label, button":{webkitTouchCallout:"none",webkitUserSelect:"none","-webkit-tap-highlight-color":"transparent","tap-highlight-color":"transparent"}}),yu=D("div",{position:"absolute",top:0,left:0,height:"100%",width:"100%",padding:"8px 8px 0 8px",display:"flex",alignItems:"flex-start",justifyContent:"flex-start",pointerEvents:"none",zIndex:2,"& > *":{pointerEvents:"all"}}),bu=D("div",{flexGrow:2});export{N as AlignStyle,ne as AlignType,ln as Arrow,ee as BINDING_DISTANCE,X as ColorStyle,xs as ContextMenu,J as DashStyle,tt as Decoration,We as DistributeType,Wo as Draw,Vo as Ellipse,bt as FlipType,vs as FocusButton,Ms as FontSize,ie as FontStyle,ge as GHOSTED_OPACITY,ct as GRID_SIZE,sl as Group,il as Image,$e as MoveType,Ko as Rectangle,H as SessionType,me as SizeStyle,Nn as Sticky,Ve as StretchType,ho as TDEventHandler,x as TDShapeType,_ as TDStatus,Ls as TDUserStatus,I as TLDR,ol as Text,Te as TextAreaUtils,kR as Tldraw,vt as TldrawApp,Zn as TldrawContext,ys as ToolsPanel,ws as TopPanel,po as dark,Be as defaultStyle,$t as defaultTextStyle,An as fills,Ut as getBoundsRectangle,On as getFontFace,wo as getFontSize,xo as getFontStyle,oe as getShapeStyle,zi as getShapeUtil,ud as getStickyFontSize,di as getStickyFontStyle,Co as getStickyShapeStyle,hd as getStrokeWidth,mt as shapeUtils,rd as stickyFills,Gt as strokes,D as styled,oi as transformRectangle,ii as transformSingleRectangle,zl as useFileSystem,us as useKeyboardShortcuts,gs as useStylesheet,K as useTldrawApp};
// @license © 2020 Google LLC. Licensed under the Apache License, Version 2.0.
